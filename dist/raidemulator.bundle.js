!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=35)}([function(e,t,a){"use strict";t.a={ABloodyReunion:560,ARelicRebornTheChimera:368,ARelicRebornTheHydra:369,ARequiemForHeroes:830,ASleepDisturbed:914,ASpectacleForTheAges:533,AccrueEnmityFromMultipleTargets:540,AirForceOne:832,AkadaemiaAnyder:841,AkhAfahAmphitheatreExtreme:378,AkhAfahAmphitheatreHard:377,AlaMhigo:689,AlexanderTheArmOfTheFather:444,AlexanderTheArmOfTheFatherSavage:451,AlexanderTheArmOfTheSon:522,AlexanderTheArmOfTheSonSavage:531,AlexanderTheBreathOfTheCreator:581,AlexanderTheBreathOfTheCreatorSavage:585,AlexanderTheBurdenOfTheFather:445,AlexanderTheBurdenOfTheFatherSavage:452,AlexanderTheBurdenOfTheSon:523,AlexanderTheBurdenOfTheSonSavage:532,AlexanderTheCuffOfTheFather:443,AlexanderTheCuffOfTheFatherSavage:450,AlexanderTheCuffOfTheSon:521,AlexanderTheCuffOfTheSonSavage:530,AlexanderTheEyesOfTheCreator:580,AlexanderTheEyesOfTheCreatorSavage:584,AlexanderTheFistOfTheFather:442,AlexanderTheFistOfTheFatherSavage:449,AlexanderTheFistOfTheSon:520,AlexanderTheFistOfTheSonSavage:529,AlexanderTheHeartOfTheCreator:582,AlexanderTheHeartOfTheCreatorSavage:586,AlexanderTheSoulOfTheCreator:583,AlexanderTheSoulOfTheCreatorSavage:587,AllsWellThatEndsInTheWell:220,AllsWellThatStartsWell:796,AlphascapeV10:798,AlphascapeV10Savage:802,AlphascapeV20:799,AlphascapeV20Savage:803,AlphascapeV30:800,AlphascapeV30Savage:804,AlphascapeV40:801,AlphascapeV40Savage:805,Amaurot:838,AmdaporKeep:167,AmdaporKeepHard:189,AmhAraeng:815,AnamnesisAnyder:898,AnnoyTheVoid:222,AsTheHeartBids:894,AssistAlliesInDefeatingATarget:544,Astragalos:729,AvoidAreaOfEffectAttacks:537,AzysLla:402,BaelsarsWall:615,BardamsMettle:623,BasicTrainingEnemyParties:214,BasicTrainingEnemyStrongholds:215,BattleInTheBigKeep:396,BattleOnTheBigBridge:366,BloodOnTheDeck:708,BrayfloxsLongstop:158,BrayfloxsLongstopHard:362,CapeWestwind:332,CastrumAbania:661,CastrumFluminis:778,CastrumMeridianum:217,CentralShroud:148,CentralThanalan:141,ChocoboRaceCostaDelSol:389,ChocoboRaceSagoliiRoad:390,ChocoboRaceTranquilPaths:391,ChocoboRaceTutorial:417,CinderDrift:897,CinderDriftExtreme:912,CoerthasCentralHighlands:155,CoerthasWesternHighlands:397,ComingClean:860,ContainmentBayP1T6:576,ContainmentBayP1T6Extreme:577,ContainmentBayS1T7:517,ContainmentBayS1T7Extreme:524,ContainmentBayZ1T9:637,ContainmentBayZ1T9Extreme:638,CopperbellMines:161,CopperbellMinesHard:349,CuriousGorgeMeetsHisMatch:717,CuttersCry:170,DarkAsTheNightSky:713,DefeatAnOccupiedTarget:545,DeltascapeV10:691,DeltascapeV10Savage:695,DeltascapeV20:692,DeltascapeV20Savage:696,DeltascapeV30:693,DeltascapeV30Savage:697,DeltascapeV40:694,DeltascapeV40Savage:698,DohnMheg:821,DomaCastle:660,DragonSound:714,DunScaith:627,DzemaelDarkhold:171,EastShroud:152,EasternLaNoscea:137,EasternThanalan:145,EdensGateDescent:850,EdensGateDescentSavage:854,EdensGateInundation:851,EdensGateInundationSavage:855,EdensGateResurrection:849,EdensGateResurrectionSavage:853,EdensGateSepulture:852,EdensGateSepultureSavage:856,EdensVerseFulmination:902,EdensVerseFulminationSavage:906,EdensVerseFuror:903,EdensVerseFurorSavage:907,EdensVerseIconoclasm:904,EdensVerseIconoclasmSavage:908,EdensVerseRefulgence:905,EdensVerseRefulgenceSavage:909,Emanation:719,EmanationExtreme:720,EmissaryOfTheDawn:769,EngageMultipleTargets:541,Eulmore:820,ExecuteAComboInBattle:539,ExecuteAComboToIncreaseEnmity:538,ExecuteARangedAttackToIncreaseEnmity:542,FadedMemories:932,FinalExercise:552,FlickingSticksAndTakingNames:219,Foundation:418,FourPlayerMahjongKuitanDisabled:831,Halatali:162,HalataliHard:360,HaukkeManor:166,HaukkeManorHard:350,HealAnAlly:549,HealMultipleAllies:550,HeavenOnHighFloors11_20:771,HeavenOnHighFloors1_10:770,HeavenOnHighFloors21_30:772,HeavenOnHighFloors31_40:782,HeavenOnHighFloors41_50:773,HeavenOnHighFloors51_60:783,HeavenOnHighFloors61_70:774,HeavenOnHighFloors71_80:784,HeavenOnHighFloors81_90:775,HeavenOnHighFloors91_100:785,HellsKier:810,HellsKierExtreme:811,HellsLid:742,HeroOnTheHalfShell:216,HiddenGorge:791,HolminsterSwitch:837,HullbreakerIsle:361,HullbreakerIsleHard:557,Idyllshire:478,IlMheg:816,InThalsName:705,InteractWithTheBattlefield:548,InterdimensionalRift:690,ItsProbablyATrap:665,Kholusia:814,Kugane:628,KuganeCastle:662,KuganeOhashi:806,Lakeland:813,LegendOfTheNotSoHiddenTemple:859,LimsaLominsaLowerDecks:129,LimsaLominsaUpperDecks:128,LongLiveTheQueen:298,LovmMasterTournament:506,LovmPlayerBattleNonRp:591,LovmPlayerBattleRp:589,LovmTournament:590,LowerLaNoscea:135,MalikahsWell:836,MatchAll:null,MatsubaMayhem:710,MemoriaMiseraExtreme:913,MessengerOfTheWinds:834,MiddleLaNoscea:134,Mist:136,MorDhona:156,MoreThanAFeeler:221,MtGulg:822,Naadam:688,Neverreap:420,NewGridania:132,NorthShroud:154,NorthernThanalan:147,NyelbertsLament:876,OceanFishing:900,OldGridania:133,OneLifeForOneWorld:592,OnsalHakairDanshigNaadam:888,OurCompromise:716,OurUnsungHeroes:722,OuterLaNoscea:180,PharosSirius:160,PharosSiriusHard:510,PullingPoisonPosies:191,RaisingTheSword:706,ReturnOfTheBull:403,RhalgrsReach:635,SaintMociannesArboretum:511,SaintMociannesArboretumHard:788,Sastasha:157,SastashaHard:387,SealRockSeize:431,ShadowAndClaw:223,ShisuiOfTheVioletTides:616,SigmascapeV10:748,SigmascapeV10Savage:752,SigmascapeV20:749,SigmascapeV20Savage:753,SigmascapeV30:750,SigmascapeV30Savage:754,SigmascapeV40:751,SigmascapeV40Savage:755,Snowcloak:371,SohmAl:441,SohmAlHard:617,SohrKhai:555,SolemnTrinity:300,SouthShroud:153,SouthernThanalan:146,SpecialEventI:353,SpecialEventIi:354,SpecialEventIii:509,StingingBack:192,SyrcusTower:372,TheAery:435,TheAetherochemicalResearchFacility:438,TheAkhAfahAmphitheatreUnreal:930,TheAntitower:516,TheAquapolis:558,TheAurumVale:172,TheAzimSteppe:622,TheBattleOnBekko:711,TheBindingCoilOfBahamutTurn1:241,TheBindingCoilOfBahamutTurn2:242,TheBindingCoilOfBahamutTurn3:243,TheBindingCoilOfBahamutTurn4:244,TheBindingCoilOfBahamutTurn5:245,TheBorderlandRuinsSecure:376,TheBowlOfEmbers:202,TheBowlOfEmbersExtreme:295,TheBowlOfEmbersHard:292,TheBozjaIncident:911,TheBozjanSouthernFront:920,TheBurn:789,TheCalamityRetold:790,TheCarteneauFlatsHeliodrome:633,TheChrysalis:426,TheChurningMists:400,TheCopiedFactory:882,TheCrownOfTheImmaculate:846,TheCrownOfTheImmaculateExtreme:848,TheCrystarium:819,TheDancingPlague:845,TheDancingPlagueExtreme:858,TheDiadem:929,TheDiadem521:901,TheDiademEasy:512,TheDiademHard:515,TheDiademHuntingGrounds:625,TheDiademHuntingGroundsEasy:624,TheDiademTrialsOfTheFury:630,TheDiademTrialsOfTheMatron:656,TheDomanEnclave:759,TheDragonsNeck:142,TheDravanianForelands:398,TheDravanianHinterlands:399,TheDrownedCityOfSkalla:731,TheDungeonsOfLyheGhiah:879,TheDuskVigil:434,TheDyingGasp:847,TheEpicOfAlexanderUltimate:887,TheFaceOfTrueEvil:709,TheFeastCustomMatchCrystalTower:767,TheFeastCustomMatchFeastingGrounds:619,TheFeastCustomMatchLichenweed:646,TheFeastRanked:765,TheFeastTeamRanked:745,TheFeastTraining:766,TheFieldsOfGloryShatter:554,TheFinalCoilOfBahamutTurn1:193,TheFinalCoilOfBahamutTurn2:194,TheFinalCoilOfBahamutTurn3:195,TheFinalCoilOfBahamutTurn4:196,TheFinalStepsOfFaith:559,TheForbiddenLandEurekaAnemos:732,TheForbiddenLandEurekaHydatos:827,TheForbiddenLandEurekaPagos:763,TheForbiddenLandEurekaPyros:795,TheFractalContinuum:430,TheFractalContinuumHard:743,TheFringes:612,TheGhimlytDark:793,TheGrandCosmos:884,TheGreatGubalLibrary:416,TheGreatGubalLibraryHard:578,TheGreatHunt:761,TheGreatHuntExtreme:762,TheHardenedHeart:873,TheHauntedManor:571,TheHeartOfTheProblem:718,TheHeroesGauntlet:916,TheHiddenCanalsOfUznair:725,TheHowlingEye:208,TheHowlingEyeExtreme:297,TheHowlingEyeHard:294,TheHuntersLegacy:875,TheJadeStoa:746,TheJadeStoaExtreme:758,TheKeeperOfTheLake:150,TheLabyrinthOfTheAncients:174,TheLimitlessBlueExtreme:447,TheLimitlessBlueHard:436,TheLochs:621,TheLostAndTheFound:874,TheLostCanalsOfUznair:712,TheLostCityOfAmdapor:363,TheLostCityOfAmdaporHard:519,TheMinstrelsBalladHadessElegy:885,TheMinstrelsBalladNidhoggsRage:566,TheMinstrelsBalladShinryusDomain:730,TheMinstrelsBalladThordansReign:448,TheMinstrelsBalladTsukuyomisPain:779,TheMinstrelsBalladUltimasBane:348,TheNavel:206,TheNavelExtreme:296,TheNavelHard:293,TheOrbonneMonastery:826,TheOrphansAndTheBrokenBlade:715,ThePalaceOfTheDeadFloors101_110:598,ThePalaceOfTheDeadFloors111_120:599,ThePalaceOfTheDeadFloors11_20:562,ThePalaceOfTheDeadFloors121_130:600,ThePalaceOfTheDeadFloors131_140:601,ThePalaceOfTheDeadFloors141_150:602,ThePalaceOfTheDeadFloors151_160:603,ThePalaceOfTheDeadFloors161_170:604,ThePalaceOfTheDeadFloors171_180:605,ThePalaceOfTheDeadFloors181_190:606,ThePalaceOfTheDeadFloors191_200:607,ThePalaceOfTheDeadFloors1_10:561,ThePalaceOfTheDeadFloors21_30:563,ThePalaceOfTheDeadFloors31_40:564,ThePalaceOfTheDeadFloors41_50:565,ThePalaceOfTheDeadFloors51_60:593,ThePalaceOfTheDeadFloors61_70:594,ThePalaceOfTheDeadFloors71_80:595,ThePalaceOfTheDeadFloors81_90:596,ThePalaceOfTheDeadFloors91_100:597,ThePeaks:620,ThePillars:419,ThePoolOfTribute:674,ThePoolOfTributeExtreme:677,ThePraetorium:224,ThePuppetsBunker:917,TheQitanaRavel:823,TheRaktikaGreatwood:817,TheResonant:684,TheRidoranaLighthouse:776,TheRoyalCityOfRabanastre:734,TheRoyalMenagerie:679,TheRubySea:613,TheSeaOfClouds:401,TheSeatOfSacrifice:922,TheSeatOfSacrificeExtreme:923,TheSecondCoilOfBahamutSavageTurn1:380,TheSecondCoilOfBahamutSavageTurn2:381,TheSecondCoilOfBahamutSavageTurn3:382,TheSecondCoilOfBahamutSavageTurn4:383,TheSecondCoilOfBahamutTurn1:355,TheSecondCoilOfBahamutTurn2:356,TheSecondCoilOfBahamutTurn3:357,TheSecondCoilOfBahamutTurn4:358,TheShiftingAltarsOfUznair:794,TheSingularityReactor:437,TheSirensongSea:626,TheStepsOfFaith:143,TheStoneVigil:168,TheStoneVigilHard:365,TheStrikingTreeExtreme:375,TheStrikingTreeHard:374,TheSunkenTempleOfQarn:163,TheSunkenTempleOfQarnHard:367,TheSwallowsCompass:768,TheTamTaraDeepcroft:164,TheTamTaraDeepcroftHard:373,TheTempest:818,TheTempleOfTheFist:663,TheThousandMawsOfTotoRak:169,TheTripleTriadBattlehall:579,TheTwinning:840,TheUnendingCoilOfBahamutUltimate:733,TheValentionesCeremony:741,TheVault:421,TheVoidArk:508,TheWanderersPalace:159,TheWanderersPalaceHard:188,TheWeaponsRefrainUltimate:777,TheWeepingCityOfMhach:556,TheWhorleaterExtreme:359,TheWhorleaterHard:281,TheWillOfTheMoon:797,TheWorldOfDarkness:151,TheWreathOfSnakes:824,TheWreathOfSnakesExtreme:825,ThokAstThokExtreme:446,ThokAstThokHard:432,ThornmarchExtreme:364,ThornmarchHard:207,UldahStepsOfNald:130,UldahStepsOfThal:131,UnderTheArmor:190,UpperLaNoscea:139,UrthsFount:394,VowsOfVirtueDeedsOfCruelty:893,WardUp:299,WesternLaNoscea:138,WesternThanalan:140,WhenClansCollide:723,WithHeartAndSteel:707,WolvesDenPier:250,Xelphatol:572,Yanxia:614}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));class n{static startsUsing(e){void 0===e&&(e={}),n.validateParams(e,"startsUsing",["timestamp","source","id","ability","target","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 14:"+n.maybeCapture(t,"id",e.id,"\\y{AbilityCode}")+":";return(e.source||e.id||e.target||t)&&(a+=n.maybeCapture(t,"source",e.source,".*?")+" starts using "),(e.ability||e.target||t)&&(a+=n.maybeCapture(t,"ability",e.ability,".*?")+" on "),(e.target||t)&&(a+=n.maybeCapture(t,"target",e.target,".*?")+"\\."),n.parse(a)}static ability(e){void 0===e&&(e={}),n.validateParams(e,"ability",["timestamp","source","sourceId","id","ability","targetId","target","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 1[56]:"+n.maybeCapture(t,"sourceId","\\y{ObjectId}")+":"+n.maybeCapture(t,"source",e.source,"[^:]*?")+":";return(e.id||e.ability||e.target||e.targetId||t)&&(a+=n.maybeCapture(t,"id",e.id,"\\y{AbilityCode}")+":"),(e.ability||e.target||e.targetId||t)&&(a+=n.maybeCapture(t,"ability",e.ability,"[^:]*?")+":"),(e.target||e.targetId||t)&&(a+=n.maybeCapture(t,"targetId","\\y{ObjectId}")+":"),(e.target||t)&&(a+=n.maybeCapture(t,"target",e.target,"[^:]*?")+":"),n.parse(a)}static abilityFull(e){void 0===e&&(e={}),n.validateParams(e,"abilityFull",["timestamp","sourceId","source","id","ability","targetId","target","flags","flag0","flag1","flag2","flag3","flag4","flag5","flag6","flag7","flag8","flag9","flag10","flag11","flag12","flag13","flag14","targetHp","targetMaxHp","targetMp","targetMaxMp","targetX","targetY","targetZ","targetHeading","hp","maxHp","mp","maxMp","x","y","z","heading","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 1[56]:"+n.maybeCapture(t,"sourceId",e.sourceId,"\\y{ObjectId}")+":"+n.maybeCapture(t,"source",e.source,"[^:]*?")+":"+n.maybeCapture(t,"id",e.id,"\\y{AbilityCode}")+":"+n.maybeCapture(t,"ability",e.ability,"[^:]*?")+":"+n.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+n.maybeCapture(t,"target",e.target,"[^:]*?")+":"+n.maybeCapture(t,"flags",e.flags,"[^:]*?")+":"+n.maybeCapture(t,"flag0",e.flag0,"[^:]*?")+":"+n.maybeCapture(t,"flag1",e.flag1,"[^:]*?")+":"+n.maybeCapture(t,"flag2",e.flag2,"[^:]*?")+":"+n.maybeCapture(t,"flag3",e.flag3,"[^:]*?")+":"+n.maybeCapture(t,"flag4",e.flag4,"[^:]*?")+":"+n.maybeCapture(t,"flag5",e.flag5,"[^:]*?")+":"+n.maybeCapture(t,"flag6",e.flag6,"[^:]*?")+":"+n.maybeCapture(t,"flag7",e.flag7,"[^:]*?")+":"+n.maybeCapture(t,"flag8",e.flag8,"[^:]*?")+":"+n.maybeCapture(t,"flag9",e.flag9,"[^:]*?")+":"+n.maybeCapture(t,"flag10",e.flag10,"[^:]*?")+":"+n.maybeCapture(t,"flag11",e.flag11,"[^:]*?")+":"+n.maybeCapture(t,"flag12",e.flag12,"[^:]*?")+":"+n.maybeCapture(t,"flag13",e.flag13,"[^:]*?")+":"+n.maybeCapture(t,"flag14",e.flag13,"[^:]*?")+":"+n.optional(n.maybeCapture(t,"targetHp",e.targetHp,"\\y{Float}"))+":"+n.optional(n.maybeCapture(t,"targetMaxHp",e.targetMaxHp,"\\y{Float}"))+":"+n.optional(n.maybeCapture(t,"targetMp",e.targetMp,"\\y{Float}"))+":"+n.optional(n.maybeCapture(t,"targetMaxMp",e.targetMaxMp,"\\y{Float}"))+":"+n.optional("\\y{Float}")+":"+n.optional("\\y{Float}")+":"+n.optional(n.maybeCapture(t,"targetX",e.targetX,"\\y{Float}"))+":"+n.optional(n.maybeCapture(t,"targetY",e.targetY,"\\y{Float}"))+":"+n.optional(n.maybeCapture(t,"targetZ",e.targetZ,"\\y{Float}"))+":"+n.optional(n.maybeCapture(t,"targetHeading",e.targetHeading,"\\y{Float}"))+":"+n.maybeCapture(t,"hp",e.hp,"\\y{Float}")+":"+n.maybeCapture(t,"maxHp",e.maxHp,"\\y{Float}")+":"+n.maybeCapture(t,"mp",e.mp,"\\y{Float}")+":"+n.maybeCapture(t,"maxMp",e.maxMp,"\\y{Float}")+":\\y{Float}:\\y{Float}:"+n.maybeCapture(t,"x",e.x,"\\y{Float}")+":"+n.maybeCapture(t,"y",e.y,"\\y{Float}")+":"+n.maybeCapture(t,"z",e.z,"\\y{Float}")+":"+n.maybeCapture(t,"heading",e.heading,"\\y{Float}")+":.*?$";return n.parse(a)}static headMarker(e){void 0===e&&(e={}),n.validateParams(e,"headMarker",["timestamp","targetId","target","id","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 1B:"+n.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+n.maybeCapture(t,"target",e.target,"[^:]*?")+":....:....:"+n.maybeCapture(t,"id",e.id,"....")+":";return n.parse(a)}static addedCombatant(e){void 0===e&&(e={}),n.validateParams(e,"addedCombatant",["timestamp","name","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 03:\\y{ObjectId}:Added new combatant "+n.maybeCapture(t,"name",e.name,".*?")+"\\.";return n.parse(a)}static addedCombatantFull(e){void 0===e&&(e={}),n.validateParams(e,"addedCombatantFull",["timestamp","id","name","job","level","hp","x","y","z","npcId","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 03:"+n.maybeCapture(t,"id",e.id,"\\y{ObjectId}")+":Added new combatant "+n.maybeCapture(t,"name",e.name,"[^:]*?")+"\\. {2}Job: "+n.maybeCapture(t,"job",e.job,"[^:]*?")+" Level: "+n.maybeCapture(t,"level",e.level,"[^:]*?")+" Max HP: "+n.maybeCapture(t,"hp",e.hp,"[0-9]+")+"..*?Pos: \\("+n.maybeCapture(t,"x",e.x,"\\y{Float}")+","+n.maybeCapture(t,"y",e.y,"\\y{Float}")+","+n.maybeCapture(t,"z",e.z,"\\y{Float}")+"\\)(?: \\("+n.maybeCapture(t,"npcId",e.npcId,".*?")+"\\))?\\.";return n.parse(a)}static removingCombatant(e){void 0===e&&(e={}),n.validateParams(e,"removingCombatant",["timestamp","id","name","hp","capture","x","y","z"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 04:"+n.maybeCapture(t,"id","\\y{ObjectId}")+":Removing combatant "+n.maybeCapture(t,"name",e.name,".*?")+"\\..*?Max HP: "+n.maybeCapture(t,"hp",e.hp,"[0-9]+")+"."+n.optional(".*?Pos: \\("+n.maybeCapture(t,"x",e.x,"\\y{Float}")+","+n.maybeCapture(t,"y",e.y,"\\y{Float}")+","+n.maybeCapture(t,"z",e.z,"\\y{Float}")+"\\)");return n.parse(a)}static gainsEffect(e){void 0===e&&(e={}),n.validateParams(e,"gainsEffect",["timestamp","targetId","target","effect","source","duration","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 1A:"+n.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+n.maybeCapture(t,"target",e.target,".*?")+" gains the effect of "+n.maybeCapture(t,"effect",e.effect,".*?")+" from "+n.maybeCapture(t,"source",e.source,".*?")+" for "+n.maybeCapture(t,"duration",e.duration,"\\y{Float}")+" Seconds\\.";return n.parse(a)}static statusEffectExplicit(e){void 0===e&&(e={}),n.validateParams(e,"statusEffectExplicit",["timestamp","targetId","target","job","hp","maxHp","mp","maxMp","x","y","z","heading","data0","data1","data2","data3","data4","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 26:"+n.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+n.maybeCapture(t,"target",e.target,"[^:]*?")+":[0-9A-F]{0,6}"+n.maybeCapture(t,"job",e.job,"[0-9A-F]{0,2}")+":"+n.maybeCapture(t,"hp",e.hp,"\\y{Float}")+":"+n.maybeCapture(t,"maxHp",e.maxHp,"\\y{Float}")+":"+n.maybeCapture(t,"mp",e.mp,"\\y{Float}")+":"+n.maybeCapture(t,"maxMp",e.maxMp,"\\y{Float}")+":.*?:.*?:"+n.optional(n.maybeCapture(t,"x",e.x,"\\y{Float}"))+":"+n.optional(n.maybeCapture(t,"y",e.y,"\\y{Float}"))+":"+n.optional(n.maybeCapture(t,"z",e.z,"\\y{Float}"))+":"+n.optional(n.maybeCapture(t,"heading",e.heading,"\\y{Float}"))+":"+n.maybeCapture(t,"data0",e.data0,"[^:]*?")+":"+n.maybeCapture(t,"data1",e.data1,"[^:]*?")+":"+n.optional(n.maybeCapture(t,"data2",e.data2,"[^:]*?")+":")+n.optional(n.maybeCapture(t,"data3",e.data3,"[^:]*?")+":")+n.optional(n.maybeCapture(t,"data4",e.data4,"[^:]*?")+":");return n.parse(a)}static losesEffect(e){void 0===e&&(e={}),n.validateParams(e,"losesEffect",["timestamp","targetId","target","effect","source","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 1E:"+n.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+n.maybeCapture(t,"target",e.target,".*?")+" loses the effect of "+n.maybeCapture(t,"effect",e.effect,".*?")+" from "+n.maybeCapture(t,"source",e.source,".*?")+"\\.";return n.parse(a)}static tether(e){void 0===e&&(e={}),n.validateParams(e,"tether",["timestamp","source","sourceId","target","targetId","id","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 23:"+n.maybeCapture(t,"sourceId",e.sourceId,"\\y{ObjectId}")+":"+n.maybeCapture(t,"source",e.source,"[^:]*?")+":"+n.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+n.maybeCapture(t,"target",e.target,"[^:]*?")+":....:....:"+n.maybeCapture(t,"id",e.id,"....")+":";return n.parse(a)}static wasDefeated(e){void 0===e&&(e={}),n.validateParams(e,"wasDefeated",["timestamp","target","source","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 19:"+n.maybeCapture(t,"target",e.target,".*?")+" was defeated by "+n.maybeCapture(t,"source",e.source,".*?")+"\\.";return n.parse(a)}static hasHP(e){void 0===e&&(e={}),n.validateParams(e,"hasHP",["timestamp","name","hp","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 0D:"+n.maybeCapture(t,"name",e.name,".*?")+" HP at "+n.maybeCapture(t,"hp",e.hp,"\\d+")+"%";return n.parse(a)}static echo(e){return void 0===e&&(e={}),n.validateParams(e,"echo",["timestamp","code","line","capture"]),n.gameLog({line:e.line,capture:e.capture,code:"0038"})}static dialog(e){void 0===e&&(e={}),n.validateParams(e,"dialog",["timestamp","code","line","name","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 00:"+n.maybeCapture(t,"code","0044")+":"+n.maybeCapture(t,"name",e.name,".*?")+":"+n.maybeCapture(t,"line",e.line,".*")+"$";return n.parse(a)}static message(e){return void 0===e&&(e={}),n.validateParams(e,"message",["timestamp","code","line","capture"]),n.gameLog({line:e.line,capture:e.capture,code:"0839"})}static gameLog(e){void 0===e&&(e={}),n.validateParams(e,"gameLog",["timestamp","code","line","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 00:"+n.maybeCapture(t,"code",e.code,"....")+":"+n.maybeCapture(t,"line",e.line,".*")+"$";return n.parse(a)}static gameNameLog(e){void 0===e&&(e={}),n.validateParams(e,"gameNameLog",["timestamp","code","name","line","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 00:"+n.maybeCapture(t,"code",e.code,"....")+":"+n.maybeCapture(t,"name",e.name,"[^:]*")+":"+n.maybeCapture(t,"line",e.line,".*")+"$";return n.parse(a)}static statChange(e){void 0===e&&(e={}),n.validateParams(e,"statChange",["timestamp","job","strength","dexterity","vitality","intelligence","mind","piety","attackPower","directHit","criticalHit","attackMagicPotency","healMagicPotency","determination","skillSpeed","spellSpeed","tenacity","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 0C:Player Stats: "+n.maybeCapture(t,"job",e.job,"\\d+")+":"+n.maybeCapture(t,"strength",e.strength,"\\d+")+":"+n.maybeCapture(t,"dexterity",e.dexterity,"\\d+")+":"+n.maybeCapture(t,"vitality",e.vitality,"\\d+")+":"+n.maybeCapture(t,"intelligence",e.intelligence,"\\d+")+":"+n.maybeCapture(t,"mind",e.mind,"\\d+")+":"+n.maybeCapture(t,"piety",e.piety,"\\d+")+":"+n.maybeCapture(t,"attackPower",e.attackPower,"\\d+")+":"+n.maybeCapture(t,"directHit",e.directHit,"\\d+")+":"+n.maybeCapture(t,"criticalHit",e.criticalHit,"\\d+")+":"+n.maybeCapture(t,"attackMagicPotency",e.attackMagicPotency,"\\d+")+":"+n.maybeCapture(t,"healMagicPotency",e.healMagicPotency,"\\d+")+":"+n.maybeCapture(t,"determination",e.determination,"\\d+")+":"+n.maybeCapture(t,"skillSpeed",e.skillSpeed,"\\d+")+":"+n.maybeCapture(t,"spellSpeed",e.spellSpeed,"\\d+")+":0:"+n.maybeCapture(t,"tenacity",e.tenacity,"\\d+");return n.parse(a)}static changeZone(e){void 0===e&&(e={}),n.validateParams(e,"statChange",["timestamp","name","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 01:Changed Zone to "+n.maybeCapture(t,"name",e.name,".*?")+"\\.";return n.parse(a)}static network6d(e){void 0===e&&(e={}),n.validateParams(e,"network6d",["timestamp","instance","command","data0","data1","data2","data3","capture"]);let t=n.trueIfUndefined(e.capture),a=n.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 21:"+n.maybeCapture(t,"instance",e.instance,".*?")+":"+n.maybeCapture(t,"command",e.command,".*?")+":"+n.maybeCapture(t,"data0",e.data0,".*?")+":"+n.maybeCapture(t,"data1",e.data1,".*?")+":"+n.maybeCapture(t,"data2",e.data2,".*?")+":"+n.maybeCapture(t,"data3",e.data3,".*?")+"$";return n.parse(a)}static maybeCapture(e,t,a,r){return a||(a=r),a=n.anyOf(a),e?n.namedCapture(t,a):a}static optional(e){return`(?:${e})?`}static namedCapture(e,t){return e.includes(">")&&console.error('"'+e+'" contains ">".'),e.includes("<")&&console.error('"'+e+'" contains ">".'),"(?<"+e+">"+t+")"}static anyOf(...e){let t;if(1===e.length){if(!Array.isArray(e[0]))return e[0];t=e[0]}else t=e;let a="(?:"+(t[0]instanceof RegExp?t[0].source:t[0]);for(let e=1;e<t.length;++e)a+="|"+(t[e]instanceof RegExp?t[e].source:t[e]);return a+=")",a}static parse(e){let t={Timestamp:"^.{14}",NetTimestamp:".{33}",NetField:"(?:[^|]*\\|)",LogType:"[0-9A-Fa-f]{2}",AbilityCode:"[0-9A-Fa-f]{1,8}",ObjectId:"[0-9A-F]{8}",Name:"(?:[^\\s:|]+(?: [^\\s:|]+)?|)",Float:"-?[0-9]+(?:[.,][0-9]+)?(?:E-?[0-9]+)?"},a="i";return e instanceof RegExp&&(a+=(e.global?"g":"")+(e.multiline?"m":""),e=e.source),e=e.replace(/\\y\{(.*?)\}/g,(e,a)=>t[a]||e),new RegExp(e,a)}static parseGlobal(e){let t=n.parse(e),a="gi";return a+=e.multiline?"m":"",new RegExp(t.source,a)}static trueIfUndefined(e){return void 0===e||!!e}static validateParams(e,t,a){if(null===e)return;if("object"!=typeof e)return;let n=Object.keys(e);for(let e=0;e<n.length;++e){let r=n[e];if(!a.includes(r))throw new Error(`${t}: invalid parameter '${r}'.  Valid params: `+JSON.stringify(a))}}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n=(()=>{const e=["GLA","PLD","MRD","WAR","DRK","GNB"],t=["CNJ","WHM","SCH","AST"],a=["PGL","MNK","LNC","DRG","ROG","NIN","SAM"],n=["ARC","BRD","DNC","MCH"],r=["BLU","RDM","BLM","SMN","ACN","THM"],i=[...a,...n,...r],s=["CRP","BSM","ARM","GSM","LTW","WVR","ALC","CUL"],o=["MIN","BTN","FSH"],l=["BLU",...e,...a],d=["BLU",...e,...n],c=["BLM","BLU",...t],u=[...a],h=[...r],p=["BLU","BRD",...t],m=["tank","healer","dps","crafter","gatherer","none"],g={0:"NONE",1:"GLA",2:"PGL",3:"MRD",4:"LNC",5:"ARC",6:"CNJ",7:"THM",8:"CRP",9:"BSM",10:"ARM",11:"GSM",12:"LTW",13:"WVR",14:"ALC",15:"CUL",16:"MIN",17:"BTN",18:"FSH",19:"PLD",20:"MNK",21:"WAR",22:"DRG",23:"BRD",24:"WHM",25:"BLM",26:"ACN",27:"SMN",28:"SCH",29:"ROG",30:"NIN",31:"MCH",32:"DRK",33:"AST",34:"SAM",35:"RDM",36:"BLU",37:"GNB",38:"DNC"},f=(()=>{const a=(e,t,a)=>t.forEach(t=>e.set(t,a)),n=new Map([["NONE","none"]]);return a(n,e,"tank"),a(n,t,"healer"),a(n,i,"dps"),a(n,s,"crafter"),a(n,o,"gatherer"),new Proxy(n,{get:function(e,t){return e.has(t)?e.get(t):(console.log("Unknown job role "+t),"")}})})();return{jobEnumToJob:e=>g[e],jobToJobEnum:e=>Object.keys(g).find(t=>g[t]===e),jobToRole:e=>f[e],getAllRoles:()=>m,isTankJob:t=>e.includes(t),isHealerJob:e=>t.includes(e),isMeleeDpsJob:e=>a.includes(e),isRangedDpsJob:e=>n.includes(e),isCasterDpsJob:e=>r.includes(e),isDpsJob:e=>i.includes(e),isCraftingJob:e=>s.includes(e),isGatheringJob:e=>o.includes(e),isCombatJob:function(e){return!this.isCraftingJob(e)&&!this.isGatheringJob(e)},canStun:e=>l.includes(e),canSilence:e=>d.includes(e),canSleep:e=>c.includes(e),canCleanse:e=>p.includes(e),canFeint:e=>u.includes(e),canAddle:e=>h.includes(e)}})();!function(){if("undefined"==typeof location)return;let e=/[\?&]OVERLAY_WS=([^&]+)/.exec(location.href),t=null,a=[],n=0,r={},i={},s=null;if(e){s=e=>{a?a.push(e):t.send(JSON.stringify(e))};let n=function(){t=new WebSocket(e[1]),t.addEventListener("error",e=>{console.error(e)}),t.addEventListener("open",()=>{console.log("Connected!");let e=a;a=null,s({call:"subscribe",events:Object.keys(i)});for(let t of e)s(t)}),t.addEventListener("message",e=>{try{e=JSON.parse(e.data)}catch(t){return void console.error("Invalid message received: ",e)}void 0!==e.rseq&&r[e.rseq]?(r[e.rseq](e),delete r[e.rseq]):o(e)}),t.addEventListener("close",()=>{a=[],console.log("Trying to reconnect..."),setTimeout(()=>{n()},300)})};n()}else{s=(e,t)=>{a?a.push([e,t]):OverlayPluginApi.callHandler(JSON.stringify(e),t)};let e=function(){if(!window.OverlayPluginApi||!window.OverlayPluginApi.ready)return void setTimeout(e,300);let t=a;a=null,window.__OverlayCallback=o,s({call:"subscribe",events:Object.keys(i)},null);for(let[e,a]of t)s(e,a)};e()}function o(e){if(i[e.type])for(let t of i[e.type])t(e)}window.dispatchOverlayEvent=o,window.addOverlayListener=(e,t)=>{i[e]||(i[e]=[],a||s({call:"subscribe",events:[e]})),i[e].push(t)},window.removeOverlayListener=(e,t)=>{if(i[e]){let a=i[e],n=a.indexOf(t);n>-1&&a.splice(n,1)}},window.callOverlayHandler=e=>{let a;return t?(e.rseq=n++,a=new Promise((t,a)=>{r[e.rseq]=t}),s(e)):a=new Promise(t=>{s(e,e=>{t(null===e?null:JSON.parse(e))})}),a}}()},function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(1);let r=(e,t,a)=>{void 0===e&&(e={});let r=[];for(let e of Object.values(a))"object"==typeof e&&r.push(e.field);n.a.validateParams(e,t,["capture",...r]);let i,s=n.a.trueIfUndefined(e.capture),o=Object.keys(a);if(s)i=o[o.length-1];else{i=0;for(let t of o){"object"==typeof a[t]&&(a[t].field in e&&(i=t))}}let l="^",d=-1;for(let r in a){r=parseInt(r);let o=r-d-1;1===o?l+="\\y{NetField}":o>1&&(l+="\\y{NetField}{"+o+"}"),d=r;let c=a[r];if("object"!=typeof c)throw new Error(`${t}: invalid value: ${JSON.stringify(c)}`);const u=a[r].field,h="value"in a[r]?a[r].value.toString():"[^|]*";if(l+=u?n.a.maybeCapture(s,u,e[u],h)+"\\|":h+"\\|",r>=i)break}return n.a.parse(l)};class i{static startsUsing(e){return r(e,"startsUsing",{0:{field:"type",value:"20"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"id"},5:{field:"ability"},6:{field:"targetId"},7:{field:"target"},8:{field:"castTime"}})}static ability(e){return r(e,"ability",{0:{field:"type",value:"2[12]"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"id"},5:{field:"ability"},6:{field:"targetId"},7:{field:"target"}})}static abilityFull(e){return r(e,"abilityFull",{0:{field:"type",value:"2[12]"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"id"},5:{field:"ability"},6:{field:"targetId"},7:{field:"target"},8:{field:"flags"},9:{field:"damage"},24:{field:"targetCurrentHp"},25:{field:"targetMaxHp"},40:{field:"x"},41:{field:"y"},42:{field:"z"},43:{field:"heading"}})}static headMarker(e){return r(e,"headMarker",{0:{field:"type",value:"27"},1:{field:"timestamp"},2:{field:"targetId"},3:{field:"target"},6:{field:"id"}})}static addedCombatant(e){return r(e,"addedCombatant",{0:{field:"type",value:"03"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"}})}static addedCombatantFull(e){return r(e,"addedCombatantFull",{0:{field:"type",value:"03"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"},4:{field:"job"},5:{field:"level"},6:{field:"ownerId"},8:{field:"world"},9:{field:"npcNameId"},10:{field:"npcBaseId"},11:{field:"currentHp"},12:{field:"hp"},17:{field:"x"},18:{field:"y"},19:{field:"z"},20:{field:"heading"}})}static removingCombatant(e){return r(e,"removingCombatant",{0:{field:"type",value:"04"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"},12:{field:"hp"}})}static gainsEffect(e){return r(e,"gainsEffect",{0:{field:"type",value:"26"},1:{field:"timestamp"},2:{field:"effectId"},3:{field:"effect"},4:{field:"duration"},5:{field:"sourceId"},6:{field:"source"},7:{field:"targetId"},8:{field:"target"},9:{field:"count"}})}static statusEffectExplicit(e){return r(e,"statusEffectExplicit",{0:{field:"type",value:"38"},1:{field:"timestamp"},2:{field:"targetId"},3:{field:"target"},5:{field:"hp"},6:{field:"maxHp"},11:{field:"x"},12:{field:"y"},13:{field:"z"},14:{field:"heading"},15:{field:"data0"},16:{field:"data1"},17:{field:"data2"},18:{field:"data3"},19:{field:"data4"}})}static losesEffect(e){return r(e,"losesEffect",{0:{field:"type",value:"30"},1:{field:"timestamp"},2:{field:"effectId"},3:{field:"effect"},5:{field:"sourceId"},6:{field:"source"},7:{field:"targetId"},8:{field:"target"},9:{field:"count"}})}static tether(e){return r(e,"tether",{0:{field:"type",value:"35"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"targetId"},5:{field:"target"},8:{field:"id"}})}static wasDefeated(e){return r(e,"wasDefeated",{0:{field:"type",value:"25"},1:{field:"timestamp"},2:{field:"targetId"},3:{field:"target"},4:{field:"sourceId"},5:{field:"source"}})}static echo(e){return void 0===e&&(e={}),n.a.validateParams(e,"echo",["type","timestamp","code","name","line","capture"]),e.code="0038",i.gameLog(e)}static dialog(e){return void 0===e&&(e={}),n.a.validateParams(e,"dialog",["type","timestamp","code","name","line","capture"]),e.code="0044",i.gameLog(e)}static message(e){return void 0===e&&(e={}),n.a.validateParams(e,"message",["type","timestamp","code","name","line","capture"]),e.code="0839",i.gameLog(e)}static gameLog(e){return r(e,"gameLog",{0:{field:"type",value:"00"},1:{field:"timestamp"},2:{field:"code"},3:{field:"name"},4:{field:"line"}})}static gameNameLog(e){return i.gameLog(e)}static statChange(e){return r(e,"statChange",{0:{field:"type",value:"12"},1:{field:"timestamp"},2:{field:"job"},3:{field:"strength"},4:{field:"dexterity"},5:{field:"vitality"},6:{field:"intelligence"},7:{field:"mind"},8:{field:"piety"},9:{field:"attackPower"},10:{field:"directHit"},11:{field:"criticalHit"},12:{field:"attackMagicPotency"},13:{field:"healMagicPotency"},14:{field:"determination"},15:{field:"skillSpeed"},16:{field:"spellSpeed"},18:{field:"tenacity"}})}static changeZone(e){return r(e,"changeZone",{0:{field:"type",value:"01"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"}})}static network6d(e){return r(e,"network6d",{0:{field:"type",value:"33"},1:{field:"timestamp"},2:{field:"instance"},3:{field:"command"},4:{field:"data0"},5:{field:"data1"},6:{field:"data2"},7:{field:"data3"}})}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var _conditions_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),_netregexes_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_regexes_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_responses_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(6),_zone_id_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(0);const Conditions=_conditions_js__WEBPACK_IMPORTED_MODULE_0__.a,NetRegexes=_netregexes_js__WEBPACK_IMPORTED_MODULE_1__.a,Regexes=_regexes_js__WEBPACK_IMPORTED_MODULE_2__.a,Responses=_responses_js__WEBPACK_IMPORTED_MODULE_3__.a,ZoneId=_zone_id_js__WEBPACK_IMPORTED_MODULE_4__.a;class UserConfig{constructor(){this.optionTemplates={},this.savedConfig=null,this.userFileCallbacks={}}registerOptions(e,t,a){this.optionTemplates[e]=t,a&&(this.userFileCallbacks[e]=a)}getUserConfigLocation(overlayName,options,callback){let currentlyReloading=!1,reloadOnce=()=>{currentlyReloading||(currentlyReloading=!0,window.location.reload())};window.addOverlayListener("onUserFileChanged",()=>{reloadOnce()}),window.addOverlayListener("onForceReload",()=>{reloadOnce()});let readOptions=callOverlayHandler({call:"cactbotLoadData",overlay:"options"});const loadUser=async e=>{let localFiles=e.detail.localUserFiles,basePath=e.detail.userLocation,jsFile=overlayName+".js",cssFile=overlayName+".css";e.detail.language&&(options.ParserLanguage=e.detail.language,options.ShortLocale=e.detail.language,options.DisplayLanguage=e.detail.language),e.detail.parserLanguage&&(options.ParserLanguage=e.detail.parserLanguage,options.Language=e.detail.parserLanguage);const supportedLanguage=["en","de","fr","ja","cn","ko"];e.detail.systemLocale&&(options.SystemLocale=e.detail.systemLocale,options.ShortLocale=e.detail.systemLocale.substring(0,2),"zh"===options.ShortLocale&&(options.ShortLocale="cn"),supportedLanguage.includes(options.ShortLocale)||(options.ShortLocale=options.ParserLanguage)),options.DisplayLanguage=e.detail.displayLanguage,supportedLanguage.includes(options.DisplayLanguage)||(options.DisplayLanguage=options.ParserLanguage||"en"),document.body.classList.add("lang-"+options.DisplayLanguage),this.addUnlockText(options.DisplayLanguage);let userOptions=await readOptions||{};this.savedConfig=userOptions.data||{},this.processOptions(options,this.savedConfig[overlayName]||{},this.optionTemplates[overlayName]);let printUserFile=options.Debug?e=>console.log(e):e=>{};if(localFiles){if(jsFile in localFiles)try{if(printUserFile("local user file: "+basePath+"\\"+jsFile),this.userFileCallbacks[overlayName])this.userFileCallbacks[overlayName](jsFile,localFiles,options);else{let Options=options;eval(localFiles[jsFile])}}catch(e){console.log("*** ERROR IN USER FILE ***"),console.log(e.stack)}if(this.handleSkin(options.Skin),cssFile in localFiles){printUserFile("local user file: "+basePath+"\\"+cssFile);let e=document.createElement("style");e.innerText=localFiles[cssFile],document.getElementsByTagName("head")[0].appendChild(e)}}else if(basePath){"/"!==basePath.slice(-1)&&(basePath+="/");let e=basePath+jsFile;printUserFile("remote user file: "+e),this.appendJSLink(e),this.handleSkin(options.Skin);let t=basePath+cssFile;printUserFile("remote user file: "+t),this.appendCSSLink(t)}callback&&callback(),callOverlayHandler({call:"cactbotRequestState"})};callOverlayHandler({call:"cactbotLoadUser",source:location.href}).then(e=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{loadUser(e)}):loadUser(e)})}handleSkin(e){if(!e||"default"===e)return;let t=document.location.toString(),a=t.lastIndexOf("/");-1!==a&&(t=t.substr(0,a)),"/"!==t.slice(-1)&&(t+="/");let n=t+"skins/"+e+"/"+e+".css";this.appendCSSLink(n)}appendJSLink(e){let t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src",e),t.setAttribute("async",!1),document.getElementsByTagName("head")[0].appendChild(t)}appendCSSLink(e){let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(t)}processOptions(e,t,a){if(Array.isArray(a)){for(let n=0;n<a.length;++n)this.processOptions(e,t,a[n]);return}if(!a)return;let n=a.options||[];for(let a=0;a<n.length;++a){let r=n[a],i=r.id in t?t[r.id]:r.default;r.setterFunc?r.setterFunc(e,i):"integer"===r.type?e[r.id]=parseInt(i):"float"===r.type?e[r.id]=parseFloat(i):e[r.id]=i}a.processExtraOptions&&a.processExtraOptions(e,t)}addUnlockText(e){const t={en:"🔓 Unlocked (lock overlay before using)",de:"🔓 Entsperrt (Sperre das Overlay vor der Nutzung)",fr:"🔓 Débloqué (Bloquez l'overlay avant utilisation)",ja:"🔓 ロック解除 (オーバーレイを使用する前にロックしてください)",cn:"🔓 已解除锁定 (你需要将此悬浮窗锁定后方可使用)",ko:"🔓 위치 잠금 해제됨 (사용하기 전에 위치 잠금을 설정하세요)"},a="cactbot-unlocked-text";let n=document.getElementById(a);n||(n=document.createElement("div"),n.id=a,n.classList.add("text"),n.style.display="none",document.body.append(n)),n.innerHTML=t[e]||t.en}}__webpack_exports__.a=new UserConfig,document.addEventListener("onOverlayStateUpdate",e=>{let t=document.documentElement.classList;e.detail.isLocked?t.remove("resizeHandle","unlocked"):t.add("resizeHandle","unlocked")})},function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return s}));var n=a(1),r=a(3);let i={},s={};(()=>{const e={countdownStart:{en:"Battle commencing in (?<time>\\y{Float}) seconds! \\((?<player>.*?)\\)",de:"Noch (?<time>\\y{Float}) Sekunden bis Kampfbeginn! \\((?<player>.*?)\\)",fr:"Début du combat dans (?<time>\\y{Float}) secondes[ ]?! \\((?<player>.*?)\\)",ja:"戦闘開始まで(?<time>\\y{Float})秒！ \\((?<player>.*?)\\)",cn:"距离战斗开始还有(?<time>\\y{Float})秒！ （(?<player>.*?)）",ko:"전투 시작 (?<time>\\y{Float})초 전! \\((?<player>.*?)\\)"},countdownEngage:{en:"Engage!",de:"Start!",fr:"À l'attaque[ ]?!",ja:"戦闘開始！",cn:"战斗开始！",ko:"전투 시작!"},countdownCancel:{en:"Countdown canceled by (?<player>\\y{Name})",de:"(?<player>\\y{Name}) hat den Countdown abgebrochen",fr:"Le compte à rebours a été interrompu par (?<player>\\y{Name})[ ]?\\.",ja:"(?<player>\\y{Name})により、戦闘開始カウントがキャンセルされました。",cn:"(?<player>\\y{Name})取消了战斗开始倒计时。",ko:"(?<player>\\y{Name}) 님이 초읽기를 취소했습니다\\."},areaSeal:{en:"(?<area>.*?) will be sealed off in (?<time>\\y{Float}) seconds!",de:"Noch (?<time>\\y{Float}) Sekunden, bis sich (?<area>.*?) schließt",fr:"Fermeture (?<area>.*?) dans (?<time>\\y{Float}) secondes[ ]?\\.",ja:"(?<area>.*?)の封鎖まであと(?<time>\\y{Float})秒",cn:"距(?<area>.*?)被封锁还有(?<time>\\y{Float})秒",ko:"(?<time>\\y{Float})초 후에 (?<area>.*?)(이|가) 봉쇄됩니다\\."},areaUnseal:{en:"(?<area>.*?) is no longer sealed.",de:"(?<area>.*?) öffnet sich erneut.",fr:"Ouverture (?<area>.*?)[ ]?!",ja:"(?<area>.*?)の封鎖が解かれた……",cn:"(?<area>.*?)的封锁解除了",ko:"(?<area>.*?)의 봉쇄가 해제되었습니다\\."},craftingStart:{en:"You begin synthesizing (?<count>(an?|\\d+) )?(?<recipe>.*)\\.",de:"Du hast begonnen, durch Synthese (?<count>(ein(e|es|em|er)?|\\d+) )?(?<recipe>.*) herzustellen\\.",fr:"Vous commencez à fabriquer (?<count>(une?|\\d+) )?(?<recipe>.*)\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)(×(?<count>\\d+))?の製作を開始した。",cn:"(?<player>\\y{Name})开始制作“(?<recipe>.*)”(×(?<count>\\d+))?。",ko:"(?<recipe>.*)(×(?<count>\\d+)개)? 제작을 시작합니다\\."},trialCraftingStart:{en:"You begin trial synthesis of (?<recipe>.*)\\.",de:"Du hast mit der Testsynthese von (?<recipe>.*) begonnen\\.",fr:"Vous commencez une synthèse d'essai pour une? (?<recipe>.*)\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習を開始した。"},craftingFinish:{en:"You synthesize (?<count>(an?|\\d+) )?(?<recipe>.*)()?\\.",de:"Du hast erfolgreich (?<count>(ein(e|es|em|er)?|\\d+) )?(?<recipe>.*)()? hergestellt\\.",fr:"Vous fabriquez (?<count>(une?|\\d+) )?(?<recipe>.*)()?\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)()?(×(?<count>\\d+))?を完成させた！",cn:"(?<player>\\y{Name})制作“(?<recipe>.*)()?”(×(?<count>\\d+))?成功！",ko:"(?<player>\\y{Name}) 님이 (?<recipe>.*)()?(×(?<count>\\d+)개)?(을|를) 완성했습니다!"},trialCraftingFinish:{en:"Your trial synthesis of (?<recipe>.*) proved a success!",de:"Die Testsynthese von (?<recipe>.*) war erfolgreich!",fr:"Votre synthèse d'essai pour fabriquer (?<recipe>.*) a été couronnée de succès!",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習に成功した！"},craftingFail:{en:"Your synthesis fails!",de:"Deine Synthese ist fehlgeschlagen!",fr:"La synthèse échoue\\.{3}",ja:"(?<player>\\y{Name})は製作に失敗した……",cn:"(?<player>\\y{Name})制作失败了……",ko:"제작에 실패했습니다……\\."},trialCraftingFail:{en:"Your trial synthesis of (?<recipe>.*) failed\\.{3}",de:"Die Testsynthese von (?<recipe>.*) ist fehlgeschlagen\\.{3}",fr:"Votre synthèse d'essai pour fabriquer (?<recipe>.*) s'est soldée par un échec\\.{3}",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習に失敗した……"},craftingCancel:{en:"You cancel the synthesis\\.",de:"Du hast die Synthese abgebrochen\\.",fr:"La synthèse est annulée\\.",ja:"(?<player>\\y{Name})は製作を中止した。",cn:"(?<player>\\y{Name})中止了制作作业。",ko:"제작을 중지했습니다\\."},trialCraftingCancel:{en:"You abandoned trial synthesis\\.",de:"Testsynthese abgebrochen\\.",fr:"Vous avez interrompu la synthèse d'essai\\.",ja:"(?<player>\\y{Name})は製作練習を中止した。"}};for(const[t,a]of Object.entries(e)){i[t]={},s[t]={};for(const[e,o]of Object.entries(a))i[t][e]=n.a.gameLog({line:o+".*?"}),s[t][e]=r.a.gameLog({line:o+"[^|]*?"})}})()},function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return m}));const n=["alarmText","alertText","infoText","groupTTS","response","tts"],r={info:"infoText",alert:"alertText",alarm:"alarmText"},i=e=>{if(!(e in r))throw new Error(`Invalid severity: ${e}.`);return r[e]},s=e=>e?i(e):"infoText",o=e=>e?i(e):"alertText",l=e=>e?i(e):"alarmText",d=e=>e&&e.target!==e.source?e.target||e[1]:null,c=e=>e.source||e[0],u=function(e,t,a,n){let r={};return e!==a?(r[e]=t,r[a]=n):r[e]=(e,a,r)=>{t(e,a,r)||n(e,a,r)},r},h=e=>"4"!==e[0],p=(e,t)=>(a,n,r)=>(r.responseOutputStrings={text:t},{[e]:(e,t,a)=>a.text()}),m={tankBuster:(e,t)=>{const a={noTarget:{en:"Tank Buster",de:"Tank buster",fr:"Tank buster",ja:"タンクバスター",cn:"坦克死刑",ko:"탱버"},busterOnYou:{en:"Tank Buster on YOU",de:"Tank buster auf DIR",fr:"Tank buster sur VOUS",ja:"自分にタンクバスター",cn:"死刑点名",ko:"탱버 대상자"},busterOnTarget:{en:"Tank Buster on ${player}",de:"Tank buster auf ${player}",fr:"Tank buster sur ${player}",ja:"${player}にタンクバスター",cn:"死刑 点 ${player}",ko:'"${player}" 탱버'}},n=u(o(e),(e,t,a)=>{const n=d(t);if(!n){if("tank"!==e.role&&"healer"!==e.role)return;return a.noTarget()}if(n===e.me)return a.busterOnYou()},s(t),(e,t,a)=>{const n=d(t);if(!n){if("tank"===e.role||"healer"===e.role)return;return a.noTarget()}if(n!==e.me)return a.busterOnTarget({player:e.ShortName(n)})});return(e,t,r)=>(r.responseOutputStrings=a,n)},tankBusterSwap:(e,t)=>{const a={tankSwap:{en:"Tank Swap!",de:"Tankwechsel!",fr:"Tank swap !",ja:"タンクスイッチ",cn:"换T！",ko:"탱 교대"},busterOnYou:{en:"Tank Buster on YOU",de:"Tank buster auf DIR",fr:"Tank buster sur VOUS",ja:"自分にタンクバスター",cn:"死刑点名",ko:"탱버 대상자"},busterOnTarget:{en:"Tank Buster on ${player}",de:"Tank buster auf ${player}",fr:"Tank buster sur ${player}",ja:"${player}にタンクバスター",cn:"死刑 点 ${player}",ko:'"${player}" 탱버'}},n=u(l(t),(e,t,a)=>{const n=d(t);if("tank"===e.role&&n!==e.me)return a.tankSwap()},o(e),(e,t,a)=>{const n=d(t);if("tank"!==e.role||n===e.me)return n===e.me?a.busterOnYou():a.busterOnTarget({player:e.ShortName(n)})});return(e,t,r)=>(r.responseOutputStrings=a,n)},tankCleave:e=>(t,a,n)=>(n.responseOutputStrings={cleaveOnYou:{en:"Tank cleave on YOU",de:"Tank Cleave aud DIR",fr:"Tank cleave sur VOUS",ja:"自分に前方範囲攻撃",cn:"顺劈点名",ko:"나에게 광역 탱버"},cleaveNoTarget:{en:"Tank cleave",de:"Tank Cleave",fr:"Tank cleave",ja:"前方範囲攻撃",cn:"顺劈",ko:"광역 탱버"},avoidCleave:{en:"Avoid tank cleave",de:"Tank Cleave ausweichen",fr:"Évitez le tank cleave",ja:"前方範囲攻撃を避け",cn:"远离顺劈",ko:"광역 탱버 피하기"}},{[s(e)]:(e,t,a)=>{if("tank"===e.role){return d(t)===e.me?a.cleaveOnYou():a.cleaveNoTarget()}return a.avoidCleave()}}),miniBuster:e=>p(s(e),{en:"Mini Buster",de:"Kleiner Tankbuster",fr:"Mini Buster",ja:"ミニバスター",cn:"小死刑",ko:"약한 탱버"}),aoe:e=>p(s(e),{en:"aoe",de:"AoE",fr:"AoE",ja:"AoE",cn:"AoE",ko:"전체 공격"}),bigAoe:e=>p(s(e),{en:"big aoe!",de:"Große AoE!",fr:"Grosse AoE !",ja:"大ダメージAoE",cn:"大AoE伤害！",ko:"강한 전체 공격!"}),spread:e=>p(s(e),{en:"Spread",de:"Verteilen",fr:"Dispersez-vous",ja:"散開",cn:"分散",ko:"산개"}),stackMarker:e=>p(o(e),{en:"Stack",de:"Sammeln",fr:"Packez-vous",ja:"頭割り",cn:"分摊",ko:"쉐어뎀"}),getTogether:e=>p(o(e),{en:"Stack",de:"Sammeln",fr:"Packez-vous",ja:"頭割り",cn:"分摊",ko:"쉐어뎀"}),stackMarkerOn:e=>(t,a,n)=>(n.responseOutputStrings={stackOnYou:{en:"Stack on YOU",de:"Auf DIR sammeln",fr:"Package sur VOUS",ja:"自分にスタック",cn:"集合点名",ko:"쉐어징 대상자"},stackOnTarget:{en:"Stack on ${player}",de:"Auf ${player} sammeln",fr:"Packez-vous sur ${player}",ja:"${player}にスタック",cn:"靠近 ${player}集合",ko:'"${player}" 쉐어징'}},{[o(e)]:(e,t,a)=>{const n=d(t);return n===e.me?a.stackOnYou():a.stackOnTarget({player:e.ShortName(n)})}}),stackMiddle:e=>p(s(e),{en:"Stack in middle",fr:"Packez-vous au milieu",de:"In der Mitte sammeln",ja:"中央でスタック",cn:"中间集合",ko:"중앙에서 모이기"}),doritoStack:e=>p(o(e),{en:"Dorito Stack",de:"Mit Marker sammeln",fr:"Packez les marquages",ja:"マーカー付けた人とスタック",cn:"点名集合",ko:"징끼리 모이기"}),spreadThenStack:e=>p(o(e),{en:"Spread => Stack",de:"Verteilen => Sammeln",fr:"Dispersion => Package",ja:"散開 => スタック",cn:"分散 => 集合",ko:"산개 => 집합"}),stackThenSpread:e=>p(o(e),{en:"Stack => Spread",de:"Sammeln => Verteilen",fr:"Package => Dispersion",ja:"スタック => 散開",cn:"集合 => 分散",ko:"집합 => 산개"}),knockback:e=>p(o(e),{en:"Knockback",de:"Rückstoß",fr:"Poussée",ja:"ノックバック",cn:"击退",ko:"넉백"}),knockbackOn:(e,t)=>{const a={knockbackOnYou:{en:"Knockback on YOU",de:"Rückstoß auf DIR",fr:"Poussée sur VOUS",ja:"自分にノックバック",cn:"击退点名",ko:"넉백징 대상자"},knockbackOnTarget:{en:"Knockback on ${player}",de:"Rückstoß auf ${player}",fr:"Poussée sur ${player}",ja:"${player}にノックバック",cn:"击退点名${player}",ko:'"${player}" 넉백징'}},n=u(s(e),(e,t,a)=>{if(d(t)===e.me)return a.knockbackOnYou()},s(t),(e,t,a)=>{const n=d(t);if(n!==e.me)return a.knockbackOnTarget({player:e.ShortName(n)})});return(e,t,r)=>(r.responseOutputStrings=a,n)},lookTowards:e=>p(s(e),{en:"Look Towards Boss",de:"Anschauen Boss",fr:"Regardez le boss",ja:"見る",cn:"背对",ko:"쳐다보기"}),lookAway:e=>p(s(e),{en:"Look Away",de:"Wegschauen",fr:"Regardez ailleurs",ja:"見ない",cn:"背对",ko:"뒤돌기"}),lookAwayFromTarget:e=>(t,a,n)=>(n.responseOutputStrings={lookAwayFrom:{en:"Look Away from ${name}",de:"Schau weg von ${name}",fr:"Ne regardez pas ${name}",ja:"${name}を見ない",cn:"背对${name}",ko:"${name}에게서 뒤돌기"}},{[o(e)]:(e,t,a)=>{const n=d(t);if(n===e.me)return;const r=h(t.targetId)?e.ShortName(n):n;return a.lookAwayFrom({name:r})}}),lookAwayFromSource:e=>(t,a,n)=>(n.responseOutputStrings={lookAwayFrom:{en:"Look Away from ${name}",de:"Schau weg von ${name}",fr:"Ne regardez pas ${name}",ja:"${name}を見ない",cn:"背对${name}",ko:"${name}에게서 뒤돌기"}},{[o(e)]:(e,t,a)=>{const n=c(t);if(n===e.me)return;const r=h(t.sourceId)?e.ShortName(n):n;return a.lookAwayFrom({name:r})}}),getBehind:e=>p(o(e),{en:"Get Behind",de:"Hinter ihn",fr:"Passez derrière",ja:"背面へ",cn:"去背后",ko:"보스 뒤로"}),goFrontOrSides:e=>p(o(e),{en:"Go Front / Sides",de:"Gehe nach Vorne/ zu den Seiten",fr:"Allez Devant / Côtés",ja:"前／横へ",cn:"去前侧方",ko:"보스 후방 피하기"}),getUnder:e=>p(s(e),{en:"Get Under",de:"Unter ihn",fr:"En dessous",ja:"ボスと貼り付く",cn:"去脚下",ko:"보스 아래로"}),getIn:e=>p(o(e),{en:"In",de:"Rein",fr:"Intérieur",ja:"中へ",cn:"靠近",ko:"안으로"}),getOut:e=>p(o(e),{en:"Out",de:"Raus",ja:"外へ",fr:"Exterieur",cn:"远离",ko:"밖으로"}),outOfMelee:e=>p(s(e),{en:"Out of melee",de:"Raus aus Nahkampf",fr:"Hors de la mêlée",ja:"近接最大レンジ",cn:"近战最远距离回避",ko:"근접범위 밖으로"}),getInThenOut:e=>p(s(e),{en:"In, then out",de:"Rein, dann raus",fr:"Intérieur, puis extérieur",ja:"中 => 外",cn:"先靠近，再远离",ko:"안으로 => 밖으로"}),getOutThenIn:e=>p(s(e),{en:"Out, then in",de:"Raus, dann rein",fr:"Extérieur, puis intérieur",ja:"外 => 中",cn:"先远离，再靠近",ko:"밖으로 => 안으로"}),getBackThenFront:e=>p(s(e),{en:"Back Then Front",de:"Nach Hinten, danach nach Vorne",fr:"Derrière puis devant",ja:"後ろ => 前",cn:"后 => 前",ko:"뒤로 => 앞으로"}),getFrontThenBack:e=>p(s(e),{en:"Front Then Back",de:"Nach Vorne, danach nach Hinten",fr:"Devant puis derrière",ja:"前 => 後ろ",cn:"前 => 后",ko:"앞으로 => 뒤로"}),goMiddle:e=>p(o(e),{en:"go into middle",fr:"Allez au milieu",de:"in die Mitte gehen",ja:"中へ",cn:"去中间",ko:"중앙으로"}),goRight:e=>p(o(e),{en:"Right",de:"Rechts",fr:"Droite ",ja:"右へ",cn:"右",ko:"오른쪽"}),goLeft:e=>p(o(e),{en:"Left",de:"Links",fr:"Gauche",ja:"左へ",cn:"左",ko:"왼쪽"}),goWest:e=>p(o(e),{en:"<= Get Left/West",de:"<= Nach Links/Westen",fr:"<= Allez à Gauche/Ouest",ja:"<= 左/西へ",cn:"<= 去左/西边",ko:"<= 왼쪽으로"}),goEast:e=>p(o(e),{en:"Get Right/East =>",de:"Nach Rechts/Osten =>",fr:"Allez à Droite/Est =>",ja:"右/東へ =>",cn:"去右/东边 =>",ko:"오른쪽으로 =>"}),goFrontBack:e=>p(o(e),{en:"Go Front/Back",de:"Geh nach Vorne/Hinten",fr:"Allez Devant/Derrière",ja:"縦へ",cn:"去前后",ko:"앞/뒤로"}),goSides:e=>p(o(e),{en:"Sides",de:"Seiten",fr:"Côtés",ja:"横へ",ko:"양옆으로",cn:"去侧面"}),killAdds:e=>p(s(e),{en:"Kill adds",de:"Adds besiegen",fr:"Tuez les adds",ja:"雑魚を処理",ko:"쫄 잡기",cn:"击杀小怪"}),killExtraAdd:e=>p(s(e),{en:"Kill Extra Add",de:"Add besiegen",ja:"雑魚を倒す",fr:"Tuez l'add",cn:"击杀小怪",ko:"쫄 잡기"}),awayFromFront:e=>p(o(e),{en:"Away From Front",de:"Weg von Vorne",fr:"Éloignez-vous du devant",ja:"前方から離れ",cn:"远离正面",ko:"보스 전방 피하기"}),sleep:e=>(t,a,n)=>(n.responseOutputStrings={sleep:{en:"Sleep ${name}",de:"Schlaf auf ${name}",fr:"Sommeil sur ${name}",ja:"${name} にスリプル",cn:"催眠 ${name}",ko:"${name} 슬리플"}},{[o(e)]:(e,t,a)=>{const n=c(t);return a.sleep({name:n})}}),stun:e=>(t,a,n)=>(n.responseOutputStrings={stun:{en:"Stun ${name}",de:"Betäubung auf ${name}",fr:"Étourdissement sur ${name}",ja:"${name} にスタン",cn:"眩晕 ${name}",ko:"${name}기절"}},{[o(e)]:(e,t,a)=>{const n=c(t);return a.stun({name:n})}}),interrupt:e=>(t,a,n)=>(n.responseOutputStrings={interrupt:{en:"interrupt ${name}",de:"unterbreche ${name}",fr:"Interrompez ${name}",ja:"${name} に沈黙",cn:"打断${name}",ko:"${name}기술 시전 끊기"}},{[o(e)]:(e,t,a)=>{const n=c(t);return a.interrupt({name:n})}}),preyOn:(e,t)=>{const a={preyOnYou:{en:"Prey on YOU",de:"Marker auf DIR",fr:"Marquage sur VOUS",ja:"自分に捕食",cn:"掠食点名",ko:"홍옥징 대상자"},preyOnTarget:{en:"Prey on ${player}",de:"Marker auf ${player}",fr:"Marquage sur ${player}",ja:"${player}に捕食",cn:"掠食点名${player}",ko:'"${player}" 홍옥징'}},n=u(o(e),(e,t,a)=>{const n=d(t);if(e.me===n)return a.preyOnYou()},s(t),(e,t,a)=>{const n=d(t);if(n!==e.me)return a.preyOnTarget({player:e.ShortName(n)})});return(e,t,r)=>(r.responseOutputStrings=a,n)},awayFrom:e=>(t,a,n)=>(n.responseOutputStrings={awayFromGroup:{en:"Away from Group",de:"Weg von der Gruppe",fr:"Éloignez-vous du groupe",ja:"外へ",cn:"远离人群",ko:"다른 사람들이랑 떨어지기"},awayFromTarget:{en:"Away from ${player}",de:"Weg von ${player}",fr:"Éloignez-vous de ${player}",ja:"${player}から離れ",cn:"远离${player}",ko:'"${player}"에서 멀어지기'}},{[o(e)]:(e,t,a)=>{const n=d(t);return e.me===n?a.awayFromGroup():a.awayFromTarget({player:e.ShortName(n)})}}),meteorOnYou:e=>p(l(e),{en:"Meteor on YOU",de:"Meteor auf DIR",fr:"Météore sur VOUS",ja:"自分にメテオ",cn:"陨石点名",ko:"나에게 메테오징"}),stopMoving:e=>p(l(e),{en:"Stop Moving!",de:"Bewegung stoppen!",fr:"Ne bougez pas !",ja:"移動禁止！",cn:"停止移动！",ko:"이동 멈추기!"}),stopEverything:e=>p(l(e),{en:"Stop Everything!",de:"Stoppe Alles!",fr:"Arrêtez TOUT !",ja:"行動禁止！",cn:"停止行动！",ko:"행동 멈추기!"}),moveAway:e=>p(s(e),{en:"Move!",de:"Bewegen!",fr:"Bougez !",ja:"避けて！",cn:"快躲开！",ko:"이동하기!"}),moveAround:e=>p(s(e),{en:"Move!",de:"Bewegen!",fr:"Bougez !",ja:"動く！",cn:"快动！",ko:"움직이기!"}),breakChains:e=>p(s(e),{en:"Break chains",de:"Kette zerbrechen",fr:"Cassez les chaines",ja:"線を切る",cn:"切断连线",ko:"선 끊기"}),moveChainsTogether:e=>p(s(e),{en:"Move chains together",de:"Ketten zusammen bewegen",fr:"Bougez les chaines ensemble",ja:"線同士一緒に移動",cn:"连线一起移动",ko:"선 붙어서 같이 움직이기"}),earthshaker:e=>(t,a,n)=>(n.responseOutputStrings={earthshaker:{en:"Earth Shaker on YOU",de:"Erdstoß auf DIR",fr:"Marque de terre sur VOUS",ja:"自分にアースシェイカー",cn:"大地摇动点名",ko:"어스징 대상자"}},{[o(e)]:(e,t,a)=>{if(d(t)===e.me)return a.earthshaker()}}),wakeUp:e=>p(l(e),{en:"WAKE UP",de:"AUFWACHEN",fr:"RÉVEILLES-TOI",ja:"目を覚めて！",cn:"醒醒！动一动！！",ko:"강제 퇴장 7분 전"})}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));class n{static targetIsYou(){return(e,t)=>e.me===t.target}static targetIsNotYou(){return(e,t)=>e.me!==t.target}static caresAboutAOE(){return e=>"tank"===e.role||"healer"===e.role||e.CanAddle()||"BLU"===e.job}static caresAboutMagical(){return e=>"tank"===e.role||"healer"===e.role||e.CanAddle()||"BLU"===e.job}static caresAboutPhysical(){return e=>"tank"===e.role||"healer"===e.role||e.CanFeint()||"BLU"===e.job}}},,,function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(2);class r{constructor(){this.onPartyChanged({party:[]})}onPartyChanged(e){if(e&&e.party){this.details=e.party,this.partyNames_=[],this.partyIds_=[],this.allianceNames_=[],this.allianceIds_=[],this.nameToRole_={},this.idToName_={},this.roleToPartyNames_={};for(const e of n.a.getAllRoles())this.roleToPartyNames_[e]=[];for(const t of e.party){this.allianceIds_.push(t.id),this.allianceNames_.push(t.name);const e=n.a.jobEnumToJob(t.job),a=n.a.jobToRole(e);this.idToName_[t.id]=t.name,this.nameToRole_[t.name]=a,t.inParty&&(this.partyIds_.push(t.id),this.partyNames_.push(t.name),this.roleToPartyNames_[a].push(t.name))}}}get partyNames(){return this.partyNames_}get partyIds(){return this.partyIds_}get allianceNames(){return this.allianceNames_}get tankNames(){return this.roleToPartyNames_.tank}get healerNames(){return this.roleToPartyNames_.healer}get dpsNames(){return this.roleToPartyNames_.dps}isRole(e,t){return this.nameToRole_[e]===t}isTank(e){return this.isRole(e,"tank")}isHealer(e){return this.isRole(e,"healer")}isDPS(e){return this.isRole(e,"dps")}inParty(e){return this.partyNames.includes(e)}inAlliance(e){return this.allianceNames.includes(e)}otherTank(e){let t=this.tankNames;return 2!==t.length?null:t[0]===e?t[1]:t[1]===e?t[0]:null}otherHealer(e){let t=this.roleToPartyNames.healer;return 2!==t.length?null:t[0]===e?t[1]:t[1]===e?t[0]:null}jobName(e){let t=this.partyNames.indexOf(e);return t>=0?n.a.jobEnumToJob(this.details[t].job):null}nameFromId(e){return this.idToName_[e]}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return S})),a.d(t,"d",(function(){return x})),a.d(t,"b",(function(){return _})),a.d(t,"c",(function(){return v}));const n="(?<=00:0839:)(.*) will be sealed off(?: in (?:[0-9]+ seconds)?)?",r="(?<= \\(|\\/)E(?=\\)|\\/)",i="(?<= \\(|\\/)N(?=\\)|\\/)",s="(?<= \\(|\\/)S(?=\\)|\\/)",o="(?<= \\(|\\/)W(?=\\)|\\/)",l="(?<= \\(|\\/)NE(?=\\)|\\/)",d="(?<= \\(|\\/)NW(?=\\)|\\/)",c="(?<= \\(|\\/)SE(?=\\)|\\/)",u="(?<= \\(|\\/)SW(?=\\)|\\/)",h="(?<= \\(|\\/)Tanks?(?=\\)|\\/)",p="(?<= \\(|\\/)Healers?(?=\\)|\\/)",m="(?<= \\(|\\/)DPS(?=\\)|\\/)",g={replaceSync:{[n]:{en:"$1 will be sealed off",de:"Noch 15 Sekunden, bis sich (?:(?:der|die|das) )?(?:Zugang zu(?:[rm]| den)? )?$1 schließt",fr:"Fermeture d(?:e|u|es) $1 dans",ja:"$1の封鎖まであと",cn:"距$1被封锁还有",ko:"15초 후에 $1(?:이|가) 봉쇄됩니다"},["is no longer sealed"]:{en:"is no longer sealed",de:"öffnet sich (?:wieder|erneut)",fr:"Ouverture ",ja:"の封鎖が解かれた",cn:"的封锁解除了",ko:"의 봉쇄가 해제되었습니다"},["Engage!"]:{en:"Engage!",de:"Start!",fr:"À l'attaque",ja:"戦闘開始！",cn:"战斗开始！",ko:"전투 시작!"}},replaceText:{"--adds spawn--":{de:"--adds spawn--",fr:"--apparition d'adds--",ja:"--雑魚出現--",cn:"--小怪出现--",ko:"--쫄 소환--"},"--adds targetable--":{de:"--adds anvisierbar--",fr:"--adds ciblables--",ja:"--雑魚ターゲット可能--",cn:"--小怪可选中--",ko:"--쫄 타겟 가능--"},"--center--":{de:"--mitte--",fr:"--centre--",ja:"--センター--",cn:"--中央--",ko:"--중앙--"},"--clones appear--":{de:"--klone erscheinen--",fr:"--apparition des clones--",ja:"--幻影出現--",cn:"--克隆 体 出现--",ko:"--분신 소환--"},"--corner--":{de:"--ecke--",fr:"--coin--",ja:"--コーナー--",cn:"--角落--",ko:"--구석--"},"--dps burn--":{de:"--dps burn--",fr:"--burn dps--",ja:"--火力出せ--",cn:"--转火--",ko:"--딜 체크--"},"--east--":{de:"--osten--",fr:"--est--",ja:"--東--",cn:"--东--",ko:"--동쪽--"},Enrage:{de:"Finalangriff",fr:"Enrage",ja:"時間切れ",cn:"狂暴",ko:"전멸기"},"--jump--":{de:"--sprung--",fr:"--saut--",ja:"--ジャンプ--",cn:"--跳--",ko:"--점프--"},"--knockback--":{fr:"--poussée--",ja:"--ノックバック--",cn:"--击退--",ko:"--넉백--"},"--middle--":{de:"--mitte--",fr:"--milieu--",ja:"--中央--",cn:"--中间--",ko:"--중앙--"},"--north--":{de:"--norden--",fr:"--nord--",ja:"--北--",cn:"--北--",ko:"--북쪽--"},"--northeast--":{de:"--nordosten--",fr:"--nord-est--",ja:"--北東--",cn:"--东北--",ko:"--북동--"},"--northwest--":{de:"--nordwesten--",fr:"--nord-ouest--",ja:"--北西--",cn:"--西北--",ko:"--북서--"},"--rotate--":{de:"--rotieren--",fr:"--rotation--",ja:"--回転--",cn:"--龙回转--",ko:"--회전--"},"--south--":{de:"--süden--",fr:"--sud--",ja:"--南--",cn:"--南面--",ko:"--남쪽--"},"--southeast--":{de:"--südosten--",fr:"--sud-est--",ja:"--南東--",cn:"--东南--",ko:"--남동--"},"--southwest--":{de:"--südwesten--",fr:"--sud-ouest--",ja:"--南西--",cn:"--西南--",ko:"--남서--"},"--split--":{de:"--teilen--",fr:"--division--",ja:"--分裂--",cn:"--分裂--",ko:"--분열--"},"--stun--":{de:"--Betäubung--",fr:"--étourdissement--",ja:"--スタン--",cn:"--击晕--",ko:"--기절--"},"--sync--":{de:"--synchronisation--",fr:"--synchronisation--",ja:"--シンク--",cn:"--同步化--",ko:"--동기화--"},"--([0-9]+x )?targetable--":{de:"--$1anvisierbar--",fr:"--$1ciblable--",ja:"--$1ターゲット可能--",cn:"--$1可选中--",ko:"--$1타겟 가능--"},"--teleport--":{de:"--teleportation--",fr:"--téléportation--",ja:"--テレポート--",cn:"--傳送--",ko:"--순간 이동--"},"--untargetable--":{de:"--nich anvisierbar--",fr:"--non ciblable--",ja:"--ターゲット不可--",cn:"--无法选中--",ko:"--타겟 불가능--"},[r]:{de:"O",fr:"E",ja:"東",cn:"东",ko:"동"},[i]:{de:"N",fr:"N",ja:"北",cn:"北",ko:"북"},[s]:{de:"S",fr:"S",ja:"南",cn:"南面",ko:"남"},[o]:{de:"W",fr:"O",ja:"西",cn:"西",ko:"서"},[l]:{de:"NO",fr:"NE",ja:"北東",cn:"东北",ko:"북동"},[d]:{de:"NW",fr:"NO",ja:"北西",cn:"西北",ko:"북서"},[c]:{de:"SO",fr:"SE",ja:"南東",cn:"东南",ko:"남동"},[u]:{de:"SW",fr:"SO",ja:"南西",cn:"西南",ko:"남서"},[h]:{de:"Tank",fr:"Tank",ja:"タンク",cn:"坦克",ko:"탱커"},[p]:{de:"Heiler",fr:"Healer",ja:"ヒーラー",cn:"治疗",ko:"힐러"},[m]:{de:"DPS",fr:"DPS",ja:"DPS",cn:"DPS",ko:"딜러"}}};var f=a(1),T=a(5);const y={en:["These lines are","debug timeline entries.","If you lock the overlay,","they will disappear!","Real timelines automatically","appear when supported."],de:["Diese Zeilen sind","Timeline Debug-Einträge.","Wenn du das Overlay sperrst,","werden sie verschwinden!","Echte Timelines erscheinen automatisch,","wenn sie unterstützt werden."],fr:["Ces lignes sont","des timelines de test.","Si vous bloquez l'overlay,","elles disparaîtront !","Les vraies Timelines","apparaîtront automatiquement."],ja:["こちらはデバッグ用の","タイムラインです。","オーバーレイをロックすれば、","デバッグ用テキストも消える","サポートするゾーンにはタイム","ラインを動的にロードする。"],cn:["显示在此处的是","调试用时间轴。","将此悬浮窗锁定","则会立刻消失","真实的时间轴会根据","当前区域动态加载并显示"],ko:["이 막대바는 디버그용","타임라인 입니다.","오버레이를 위치잠금하면,","이 막대바도 사라집니다.","지원되는 구역에서 타임라인이","자동으로 표시됩니다."]};function b(e,t){let a=document.createElement("div"),n=t.split(".");for(let e=0;e<n.length;++e)a.classList.add(n[e]);e.appendChild(a);let r=window.getComputedStyle(a).backgroundColor;return e.removeChild(a),r}class S{constructor(e,t,a,n,r){this.options=r,this.replacements=t,this.ignores={},this.events=[],this.texts=[],this.syncStarts=[],this.syncEnds=[],this.activeSyncs=[],this.activeEvents=[],this.errors=[],this.LoadFile(e,a,n),this.Stop()}GetReplacedHelper(e,t,a,n){if(!this.replacements)return e;for(let n of this.replacements){if(n.locale&&n.locale!==a)continue;if(!n[t])continue;let r=Object.keys(n[t]);for(let a of r)e=e.replace(f.a.parse(a),n[t][a])}for(let r in g[t]){let i=g[t][r][a];if(!i)continue;let s=n?f.a.parseGlobal(r):f.a.parse(r);e=e.replace(s,i)}return e}GetReplacedText(e){if(!this.replacements)return e;const t=this.options.TimelineLanguage||this.options.ParserLanguage||"en";return this.GetReplacedHelper(e,"replaceText",t,!1)}GetReplacedSync(e){if(!this.replacements)return e;const t=this.options.ParserLanguage||"en";return this.GetReplacedHelper(e,"replaceSync",t,!0)}GetMissingTranslationsToIgnore(){return["--Reset--","--sync--","Start","^ ?21:","^(\\(\\?\\<timestamp\\>\\^\\.\\{14\\}\\)) (1B|21|23):","^(\\^\\.\\{14\\})? ?(1B|21|23):","^::\\y{AbilityCode}:$","^\\.\\*$"].map(e=>f.a.parse(e))}LoadFile(e,t,a){this.events=[],this.syncStarts=[],this.syncEnds=[];let n=1,r={};const i={comment:/^\s*#/,commentLine:/#.*$/,durationCommand:/(?:[^#]*?\s)?(duration\s+([0-9]+(?:\.[0-9]+)?))(\s.*)?$/,ignore:/^hideall\s+\"([^"]+)\"$/,jumpCommand:/(?:[^#]*?\s)?(jump\s+([0-9]+(?:\.[0-9]+)?))(?:\s.*)?$/,line:/^(([0-9]+(?:\.[0-9]+)?)\s+"(.*?)")(\s+(.*))?/,popupText:/^(info|alert|alarm)text\s+\"([^"]+)\"\s+before\s+(-?[0-9]+(?:\.[0-9]+)?)(?:\s+\"([^"]+)\")?$/,soundAlert:/^define\s+soundalert\s+"[^"]*"\s+"[^"]*"$/,speaker:/define speaker "[^"]*"(\s+"[^"]*")?\s+(-?[0-9]+(?:\.[0-9]+)?)\s+(-?[0-9]+(?:\.[0-9]+)?)/,syncCommand:/(?:[^#]*?\s)?(sync\s*\/(.*)\/)(\s.*)?$/,tts:/^alertall\s+"([^"]*)"\s+before\s+(-?[0-9]+(?:\.[0-9]+)?)\s+(sound|speak\s+"[^"]*")\s+"([^"]*)"$/,windowCommand:/(?:[^#]*?\s)?(window\s+(?:([0-9]+(?:\.[0-9]+)?),)?([0-9]+(?:\.[0-9]+)?))(?:\s.*)?$/};if(t)for(const e of t)e.regex&&(e.regex=f.a.parse(e.regex));let s=e.split("\n");for(let e=0;e<s.length;++e){let t=e+1,a=s[e];if(a=a.trim(),!a||i.comment.test(a))continue;let o=a,l=a.match(i.ignore);if(l){this.ignores[l[1]]=!0;continue}if(l=a.match(i.tts),l){if("sound"===l[3])continue;r[l[1]]=r[l[1]]||[],r[l[1]].push({type:"tts",secondsBefore:parseFloat(l[2]),text:l[4]?l[4]:l[1]});continue}if(l=a.match(i.soundAlert),l)continue;if(l=a.match(i.speaker),l)continue;if(l=a.match(i.popupText),l){r[l[2]]=r[l[2]]||[],r[l[2]].push({type:l[1],secondsBefore:parseFloat(l[3]),text:l[4]?l[4]:l[2]});continue}if(l=a.match(i.line),!l){this.errors.push({lineNumber:t,line:o,error:"Invalid format"}),console.log("Unknown timeline: "+o);continue}a=a.replace(l[1],"").trim(),a=a.replace(i.commentLine,"").trim();let d=parseFloat(l[2]),c={id:n++,time:d,name:l[3],text:this.GetReplacedText(l[3]),activeTime:0,lineNumber:t};if(a){let e=a.match(i.durationCommand);if(e&&(a=a.replace(e[1],"").trim(),c.duration=parseFloat(e[2])),e=a.match(i.syncCommand),e){a=a.replace(e[1],"").trim();let r={id:n,regex:f.a.parse(this.GetReplacedSync(e[2])),start:d-2.5,end:d+2.5,time:d,lineNumber:t};if(e[3]){let t=e[3].match(i.windowCommand);t&&(a=a.replace(t[1],"").trim(),t[2]?(r.start=d-parseFloat(t[2]),r.end=d+parseFloat(t[3])):(r.start=d-parseFloat(t[3])/2,r.end=d+parseFloat(t[3])/2)),t=e[3].match(i.jumpCommand),t&&(a=a.replace(t[1],"").trim(),r.jump=parseFloat(t[2]))}this.syncStarts.push(r),this.syncEnds.push(r)}}a&&!a.match(i.comment)?(console.log("Unknown content '"+a+"' in timeline: "+o),this.errors.push({lineNumber:t,line:o,error:"Extra text"})):this.events.push(c)}if(t)for(const e of t){let t=!1;for(const a of this.events)if(e.regex&&e.regex.test(a.name)){t=!0;break}if(!t){const t=`No match for timeline trigger ${e.regex} in ${e.id}`;this.errors.push({error:t}),console.error("*** ERROR: "+t)}}for(const e of this.events){if(e.name in r)for(const t of r[e.name]){let a={type:t.type,time:e.time-t.secondsBefore,text:t.text};this.texts.push(a)}if(t)for(const a of t){let t=e.name.match(a.regex);t&&this.texts.push({type:"trigger",time:e.time-(a.beforeSeconds||0),trigger:a,matches:t})}if(a)for(const t of a)t.regex.test(e.name)&&Object.assign(e,{style:t.style})}this.events.sort((e,t)=>e.time===t.time?e.id-t.id:e.time-t.time);for(let e=0;e<this.events.length;++e)this.events[e].sortKey=e;this.texts.sort((e,t)=>e.time-t.time),this.syncStarts.sort((e,t)=>e.start-t.start),this.syncEnds.sort((e,t)=>e.end-t.end)}Stop(){this.timebase=null,this.nextEvent=0,this.nextText=0,this.nextSyncStart=0,this.nextSyncEnd=0;this._AdvanceTimeTo(0),this._CollectActiveSyncs(0),this._ClearTimers(),this._CancelUpdate(),this.syncTimeCallback&&this.syncTimeCallback(0,!1)}SyncTo(e){let t=new Date(new Date-1e3*e);Math.abs(t-this.timebase)<=2||(this.timebase=t,this.nextEvent=0,this.nextText=0,this.nextSyncStart=0,this.nextSyncEnd=0,this._AdvanceTimeTo(e),this._CollectActiveSyncs(e),this._AddDurationTimers(e),this._ClearExceptRunningDurationTimers(e),this._AddUpcomingTimers(e),this._CancelUpdate(),this._ScheduleUpdate(e),this.syncTimeCallback&&this.syncTimeCallback(e,!0))}_CollectActiveSyncs(e){this.activeSyncs=[];for(let t=this.nextSyncEnd;t<this.syncEnds.length;++t)this.syncEnds[t].start<=e&&this.activeSyncs.push(this.syncEnds[t])}OnLogLine(e){for(let t=0;t<this.activeSyncs.length;++t){let a=this.activeSyncs[t];if(e.search(a.regex)>=0){"jump"in a?a.jump?this.SyncTo(a.jump):this.Stop():this.SyncTo(a.time);break}}}_AdvanceTimeTo(e){for(;this.nextEvent<this.events.length&&this.events[this.nextEvent].time<=e;)++this.nextEvent;for(;this.nextText<this.texts.length&&this.texts[this.nextText].time<=e;)++this.nextText;for(;this.nextSyncStart<this.syncStarts.length&&this.syncStarts[this.nextSyncStart].start<=e;)++this.nextSyncStart;for(;this.nextSyncEnd<this.syncEnds.length&&this.syncEnds[this.nextSyncEnd].end<=e;)++this.nextSyncEnd}_ClearTimers(){if(this.removeTimerCallback)for(let e=0;e<this.activeEvents.length;++e)this.removeTimerCallback(this.activeEvents[e],!1);this.activeEvents=[]}_ClearExceptRunningDurationTimers(e){let t=[];for(let a=0;a<this.activeEvents.length;++a)this.activeEvents[a].isDur&&this.activeEvents[a].time>e?t.push(this.activeEvents[a]):this.removeTimerCallback&&this.removeTimerCallback(this.activeEvents[a],!1);this.activeEvents=t}_RemoveExpiredTimers(e){for(;this.activeEvents.length&&this.activeEvents[0].time<=e;)this.removeTimerCallback&&this.removeTimerCallback(this.activeEvents[0],!0),this.activeEvents.splice(0,1)}_AddDurationTimers(e){let t=!1,a=[];for(let n=0;n<this.activeEvents.length;++n){let r=this.activeEvents[n];if(r.time<=e&&r.duration){let i={id:r.id,time:r.time+r.duration,sortKey:r.sortKey,name:r.name,text:"Active: "+r.text,isDur:!0};a.push(i),this.activeEvents.splice(n,1),this.addTimerCallback&&this.addTimerCallback(e,i,!0),t=!0,--n}}a.length&&Array.prototype.push.apply(this.activeEvents,a),this.activeEvents.sort((e,t)=>e.time-t.time)}_AddUpcomingTimers(e){for(;this.nextEvent<this.events.length&&this.activeEvents.length<this.options.MaxNumberOfTimerBars;){let t=this.events[this.nextEvent];if(t.time-e>this.options.ShowTimerBarsAtSeconds)break;e<t.time&&!(t.name in this.ignores)&&(this.activeEvents.push(t),this.addTimerCallback&&this.addTimerCallback(e,t,!1)),++this.nextEvent}}_AddPassedTexts(e){for(;this.nextText<this.texts.length;){let t=this.texts[this.nextText];if(t.time>e)break;"info"===t.type?this.showInfoTextCallback&&this.showInfoTextCallback(t.text):"alert"===t.type?this.showAlertTextCallback&&this.showAlertTextCallback(t.text):"alarm"===t.type?this.showAlarmTextCallback&&this.showAlarmTextCallback(t.text):"tts"===t.type?this.speakTTSCallback&&this.speakTTSCallback(t.text):"trigger"===t.type&&this.triggerCallback&&this.triggerCallback(t.trigger,t.matches),++this.nextText}}_CancelUpdate(){this.updateTimer&&(window.clearTimeout(this.updateTimer),this.updateTimer=null)}_ScheduleUpdate(e){console.assert(this.timebase,"_ScheduleUpdate called while stopped");let t=1e9,a=t,n=t,r=t,i=t,s=t;if(this.nextEvent<this.events.length){let t=this.events[this.nextEvent].time;console.assert(a>e,"nextEvent wasn't updated before calling _ScheduleUpdate");let n=t-this.options.ShowTimerBarsAtSeconds;n>e&&(a=n)}this.nextText<this.texts.length&&(n=this.texts[this.nextText].time,console.assert(n>e,"nextText wasn't updated before calling _ScheduleUpdate")),this.activeEvents.length>0&&(r=this.activeEvents[0].time,console.assert(r>e,"Expired activeEvents weren't pruned before calling _ScheduleUpdate")),this.nextSyncStart<this.syncStarts.length&&(i=this.syncStarts[this.nextSyncStart].start,console.assert(i>e,"nextSyncStart wasn't updated before calling _ScheduleUpdate")),this.nextSyncEnd<this.syncEnds.length&&(s=this.syncEnds[this.nextSyncEnd].end,console.assert(s>e,"nextSyncEnd wasn't updated before calling _ScheduleUpdate"));let o=Math.min(a,Math.min(r,Math.min(n,Math.min(i,s))));o!==t&&(console.assert(o>e,"nextTime is in the past"),this.updateTimer=window.setTimeout(this._OnUpdateTimer.bind(this),1e3*(o-e)))}_OnUpdateTimer(){console.assert(this.timebase,"_OnTimerUpdate called while stopped");let e=(new Date-this.timebase)/1e3;this._AddPassedTexts(e,!0),this._AdvanceTimeTo(e),this._CollectActiveSyncs(e),this._AddDurationTimers(e),this._RemoveExpiredTimers(e),this._AddUpcomingTimers(e),this._ScheduleUpdate(e)}SetAddTimer(e){this.addTimerCallback=e}SetRemoveTimer(e){this.removeTimerCallback=e}SetShowInfoText(e){this.showInfoTextCallback=e}SetShowAlertText(e){this.showAlertTextCallback=e}SetShowAlarmText(e){this.showAlarmTextCallback=e}SetSpeakTTS(e){this.speakTTSCallback=e}SetTrigger(e){this.triggerCallback=e}SetSyncTime(e){this.syncTimeCallback=e}}class x{constructor(e){this.options=e,this.init=!1,this.lang=this.options.TimelineLanguage||this.options.ParserLanguage||"en",this.AddDebugInstructions()}Init(){this.init||(this.init=!0,this.root=document.getElementById("timeline-container"),this.root.classList.add("lang-"+this.lang),this.options.Skin&&this.root.classList.add("skin-"+this.options.Skin),this.barColor=b(this.root,"timeline-bar-color"),this.barExpiresSoonColor=b(this.root,"timeline-bar-color.soon"),this.timerlist=document.getElementById("timeline"),this.timerlist.style.gridTemplateRows="repeat("+this.options.MaxNumberOfTimerBars+", 1fr)",this.activeBars={},this.expireTimers={})}AddDebugInstructions(){const e=this.lang in y?this.lang:"en",t=y[e];let a=document.getElementById("timeline-resize-helper");const n=Math.max(6,this.options.MaxNumberOfTimerBars);a.style.gridTemplateRows="repeat("+n+", 1fr)";for(let e=0;e<this.options.MaxNumberOfTimerBars;++e){let n=document.createElement("div");n.classList.add("text"),n.classList.add("resize-helper-bar"),n.classList.add("timeline-bar-color"),e<1&&n.classList.add("soon"),e<t.length?n.innerText=t[e]:n.innerText=e+1,a.appendChild(n)}this.debugElement=document.getElementById("timeline-debug"),this.debugElement||(this.debugElement=document.createElement("div"))}SetPopupTextInterface(e){this.popupText=e}SetTimeline(e){if(this.Init(),this.timeline){for(this.timeline.SetAddTimer(null),this.timeline.SetRemoveTimer(null),this.timeline.SetShowInfoText(null),this.timeline.SetShowAlertText(null),this.timeline.SetShowAlarmText(null),this.timeline.SetSpeakTTS(null),this.timeline.SetTrigger(null),this.timeline.SetSyncTime(null);this.timerlist.lastChild;)this.timerlist.removeChild(this.timerlist.lastChild);this.debugElement.innerHTML="",this.debugFightTimer=null,this.activeBars={}}this.timeline=e,this.timeline&&(this.timeline.SetAddTimer(this.OnAddTimer.bind(this)),this.timeline.SetRemoveTimer(this.OnRemoveTimer.bind(this)),this.timeline.SetShowInfoText(this.OnShowInfoText.bind(this)),this.timeline.SetShowAlertText(this.OnShowAlertText.bind(this)),this.timeline.SetShowAlarmText(this.OnShowAlarmText.bind(this)),this.timeline.SetSpeakTTS(this.OnSpeakTTS.bind(this)),this.timeline.SetTrigger(this.OnTrigger.bind(this)),this.timeline.SetSyncTime(this.OnSyncTime.bind(this)))}OnAddTimer(e,t,a){let n=document.createElement("div"),r=document.createElement("timer-bar");if(n.classList.add("timer-bar"),n.appendChild(r),r.duration=a?t.time-e:this.options.ShowTimerBarsAtSeconds,r.value=t.time-e,r.righttext="remain",r.lefttext=t.text,r.toward="right",r.style=a?"empty":"fill",t.style&&r.applyStyles(t.style),!a&&t.time-e>this.options.BarExpiresSoonSeconds?(r.fg=this.barColor,window.setTimeout(this.OnTimerExpiresSoon.bind(this,t.id),1e3*(t.time-e-this.options.BarExpiresSoonSeconds))):r.fg=this.barExpiresSoonColor,this.activeBars[t.id]){let e=this.activeBars[t.id].parentNode;e.parentNode.removeChild(e)}n.style.order=t.sortKey,n.id=t.id,this.timerlist.appendChild(n),this.activeBars[t.id]=r,t.id in this.expireTimers&&(window.clearTimeout(this.expireTimers[t.id]),delete this.expireTimers[t.id])}OnTimerExpiresSoon(e){e in this.activeBars&&(this.activeBars[e].fg=this.barExpiresSoonColor)}OnRemoveTimer(e,t){if(t&&this.options.KeepExpiredTimerBarsForSeconds)return void(this.expireTimers[e.id]=window.setTimeout(this.OnRemoveTimer.bind(this,e,!1),1e3*this.options.KeepExpiredTimerBarsForSeconds));e.id in this.expireTimers&&(window.clearTimeout(this.expireTimers[e.id]),delete this.expireTimers[e.id]);let a=this.activeBars[e.id].parentNode;a.parentNode.removeChild(a),delete this.activeBars[e.id]}OnShowInfoText(e){this.popupText&&this.popupText.Info(e)}OnShowAlertText(e){this.popupText&&this.popupText.Alert(e)}OnShowAlarmText(e){this.popupText&&this.popupText.Alarm(e)}OnSpeakTTS(e){this.popupText&&this.popupText.TTS(e)}OnTrigger(e,t){this.popupText&&this.popupText.Trigger(e,t)}OnSyncTime(e,t){if(this.options.Debug){if(!t)return this.debugFightTimer&&this.debugElement.removeChild(this.debugFightTimer),void delete this.debugFightTimer;this.debugFightTimer||(this.debugFightTimer=document.createElement("timer-bar"),this.debugFightTimer.width="100px",this.debugFightTimer.height="17px",this.debugFightTimer.duration=1e4,this.debugFightTimer.lefttext="elapsed",this.debugFightTimer.toward="right",this.debugFightTimer.style="fill",this.debugFightTimer.bg="transparent",this.debugFightTimer.fg="transparent",this.debugElement.appendChild(this.debugFightTimer)),this.debugFightTimer.elapsed=0,this.debugFightTimer.elapsed=e}}}class _{constructor(e,t){this.options=e,this.ui=t,this.dataFiles={},this.timelines=null,this.suppressNextEngage=!1,this.wipeRegex=f.a.network6d({command:"40000010"})}SetPopupTextInterface(e){this.ui.SetPopupTextInterface(e)}SetInCombat(e){e||(this.suppressNextEngage=!0),!e&&this.activeTimeline&&this.activeTimeline.Stop()}OnLogEvent(e){if(this.activeTimeline)for(const t of e.detail.logs){if(T.b.countdownStart[this.options.ParserLanguage].test(t))this.suppressNextEngage=!1;else if(T.b.countdownEngage[this.options.ParserLanguage].test(t)){if(this.suppressNextEngage)continue}else this.wipeRegex.test(t)&&(this.suppressNextEngage=!0);this.activeTimeline.OnLogLine(t)}}SetActiveTimeline(e,t,a,n,r){this.activeTimeline=null;let i="";for(let t=0;t<e.length;++t){let a=e[t];a in this.timelines?i=i+"\n"+this.timelines[a]:console.log("Timeline file not found: "+a)}for(let e=0;e<t.length;++e)i=i+"\n"+t[e];i&&(this.activeTimeline=new S(i,a,n,r,this.options)),this.ui.SetTimeline(this.activeTimeline)}IsReady(){return null!==this.timelines}SetDataFiles(e){this.timelines={};for(let t in e)t.endsWith(".txt")&&(this.timelines[t]=e[t])}}class v{constructor(e){this.timelineController=e}SetTimelines(e,t,a,n,r){this.timelineController.SetActiveTimeline(e,t,a,n,r)}IsReady(){return this.timelineController.IsReady()}StopCombat(){this.timelineController.SetInCombat(!1)}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return PopupText})),__webpack_require__.d(__webpack_exports__,"b",(function(){return PopupTextGenerator})),__webpack_require__.d(__webpack_exports__,"c",(function(){return gPopupText}));var _resources_conditions_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),_resources_netregexes_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_resources_responses_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6),_autoplay_helper_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(17),_browser_tts_engine_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(18),_resources_player_override_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(14),_resources_party_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(10),_resources_regexes_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(1),_resources_common_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(2),_resources_zone_id_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(0);const Conditions=_resources_conditions_js__WEBPACK_IMPORTED_MODULE_0__.a,NetRegexes=_resources_netregexes_js__WEBPACK_IMPORTED_MODULE_1__.a,Responses=_resources_responses_js__WEBPACK_IMPORTED_MODULE_2__.a,Regexes=_resources_regexes_js__WEBPACK_IMPORTED_MODULE_7__.a,ZoneId=_resources_zone_id_js__WEBPACK_IMPORTED_MODULE_9__.a,raidbossInstructions={en:["Instructions as follows:","This is debug text for resizing.","It goes away when you lock the overlay","along with the blue background.","Timelines and triggers will show up in supported zones.","Test raidboss with a /countdown in Summerford Farms."],de:["Anweisungen wie folgt:","Dies ist ein Debug-Text zur Größenänderung.","Er verschwindet, wenn du das Overlay sperrst,","zusammen mit dem blauen Hintergrund.","Timeline und Trigger werden in den unterstützten Zonen angezeigt.","Testen Sie Raidboss mit einem /countdown in Sommerfurt-Höfe."],ja:["操作手順：","デバッグ用のテキストです。","青色のオーバーレイを","ロックすれば消える。","サポートするゾーンにタイムラインとトリガーテキストが表示できる。","サマーフォード庄に/countdownコマンドを実行し、raidbossをテストできる。"],cn:["请按以下步骤操作：","这是供用户调整悬浮窗大小的调试用文本","当你锁定此蓝色背景的悬浮窗","该文本即会消失。","在支持的区域中会自动加载时间轴和触发器。","可在盛夏农庄使用/countdown命令测试该raidboss模块。"],ko:["<조작 설명>","크기 조정을 위한 디버그 창입니다","파란 배경과 이 텍스트는","오버레이를 위치잠금하면 사라집니다","지원되는 구역에서 타임라인과 트리거가 표시됩니다","여름여울 농장에서 초읽기를 실행하여 테스트 해볼 수 있습니다"]};function triggerUpperCase(e){return e?"number"==typeof e?e:e.replace(/[^αβγδ]/g,e=>e.toUpperCase()):e}function onTriggerException(e,t){let a="Error in trigger: "+(e.id?e.id:"[unknown trigger id]");e.filename&&(a+=" ("+e.filename+")"),console.error(a);let n=t.stack.split("\n");for(let e=0;e<n.length;++e)console.error(n[e])}class OrderedTriggerList{constructor(){this.idToIndex={},this.triggers=[]}push(e){if(e.id&&e.id in this.idToIndex){const t=this.idToIndex[e.id],a=e=>e.filename?`'${e.filename}'`:"user override",n=a(this.triggers[t]),r=a(e);return console.log(`Overriding '${e.id}' from ${n} with ${r}.`),void(this.triggers[t]=e)}e.id&&(this.idToIndex[e.id]=this.triggers.length),this.triggers.push(e)}asList(){return this.triggers}}class TriggerOutputProxy{constructor(e,t,a){return this.trigger=e,this.outputStrings=e.outputStrings||{},this.responseOutputStrings={},this.displayLang=t,this.unknownValue="???",this.overrideStrings={},this.trigger.id&&a&&a[e.id]&&(this.overrideStrings=a[e.id].OutputStrings||{}),new Proxy(this,{set(e,t,a){if("responseOutputStrings"===t)return e[t]=a,!0;console.error(`Invalid property '${t}' on output.`)},get:(e,t)=>"toJSON"===t?"{}":a=>{let n=e.getReplacement(e.overrideStrings[t],a);return null===n&&(n=e.getReplacement(e.responseOutputStrings[t],a)),null===n&&(n=e.getReplacement(e.outputStrings[t],a)),null===n?(console.error(`Trigger ${e.trigger.id} has missing outputString ${t}.`),e.unknownValue):n}})}getReplacement(e,t){return e?("object"==typeof e&&(e=this.displayLang in e?e[this.displayLang]:e.en),"string"!=typeof e?(console.error(`Trigger ${this.trigger.id} has invalid outputString ${name}.`),null):e.replace(/\${\s*([^}\s]+)\s*}/g,(a,n)=>t&&n in t?t[n]:(console.error(`Trigger ${this.trigger.id} can't replace ${n} in ${e}.`),this.unknownValue))):null}}class PopupText{constructor(e){this.options=e,this.triggers=[],this.netTriggers=[],this.timers={},this.currentTriggerID=0,this.inCombat=!1,this.resetWhenOutOfCombat=!0,this.infoText=document.getElementById("popup-text-info"),this.alertText=document.getElementById("popup-text-alert"),this.alarmText=document.getElementById("popup-text-alarm"),this.parserLang=this.options.ParserLanguage||"en",this.displayLang=this.options.AlertsLanguage||this.options.DisplayLanguage||this.options.ParserLanguage||"en",this.options.IsRemoteRaidboss||this.options.BrowserTTS?(this.ttsEngine=new _browser_tts_engine_js__WEBPACK_IMPORTED_MODULE_4__.a(this.displayLang),this.ttsSay=function(e){this.ttsEngine.play(e)}):this.ttsSay=function(e){let t={call:"cactbotSay",text:e};window.callOverlayHandler(t)},this.options.AudioAllowed&&_autoplay_helper_js__WEBPACK_IMPORTED_MODULE_3__.a.CheckAndPrompt(),this.partyTracker=new _resources_party_js__WEBPACK_IMPORTED_MODULE_6__.a,this.kMaxRowsOfText=2,this.Reset(),this.AddDebugInstructions(),this.HookOverlays()}AddDebugInstructions(){const e=this.displayLang in raidbossInstructions?this.displayLang:"en",t=raidbossInstructions[e];for(let e=0;e<t.length;++e){const a=document.getElementById("instructions-"+e);if(!a)return;a.innerHTML=t[e]}}HookOverlays(){addOverlayListener("PartyChanged",e=>{this.partyTracker.onPartyChanged(e)}),Object(_resources_player_override_js__WEBPACK_IMPORTED_MODULE_5__.a)(this.options.PlayerNameOverride,e=>{this.OnPlayerChange(e)}),addOverlayListener("ChangeZone",e=>{this.OnChangeZone(e)}),addOverlayListener("onInCombatChangedEvent",e=>{this.OnInCombatChange(e.detail.inGameCombat)}),addOverlayListener("onLogEvent",e=>{this.OnLog(e)}),addOverlayListener("LogLine",e=>{this.OnNetLog(e)})}SetTimelineLoader(e){this.timelineLoader=e}OnPlayerChange(e){this.job===e.detail.job&&this.me===e.detail.name||this.OnJobChange(e),this.data.currentHP=e.detail.currentHP}OnDataFilesRead(e){this.triggerSets=[];for(let filename in e.detail.files){if(!filename.endsWith(".js"))continue;let text=e.detail.files[filename],json;try{json=eval(text)}catch(e){console.log("Error parsing JSON from "+filename+": "+e);continue}if("object"==typeof json&&json.length>=0){for(let e=0;e<json.length;++e)"triggers"in json[e]?"object"==typeof json[e].triggers&&json[e].triggers.length>=0?json[e].filename=filename:console.log("Unexpected JSON from "+filename+", expected triggers to be an array"):console.log("Unexpected JSON from "+filename+", expected a triggers");Array.prototype.push.apply(this.triggerSets,json)}else console.log("Unexpected JSON from "+filename+", expected an array")}Array.prototype.push.apply(this.triggerSets,this.options.Triggers)}OnChangeZone(e){this.zoneName!==e.zoneName&&(this.zoneName=e.zoneName,this.zoneId=e.zoneID,this.ReloadTimelines())}ReloadTimelines(){if(!(this.triggerSets&&this.me&&this.zoneName&&this.timelineLoader.IsReady()))return;this.Reset(),this.triggers=[],this.netTriggers=[];let e=[],t=[],a=[],n=[];this.resetWhenOutOfCombat=!0;const r=new OrderedTriggerList,i=new OrderedTriggerList,s=new OrderedTriggerList;let o=function(e){if(Array.isArray(e))for(let t=0;t<e.length;++t)o(e[t]);else"function"==typeof e?o(e(this.data)):e&&t.push(e)}.bind(this),l=this.parserLang.charAt(0).toUpperCase()+this.parserLang.slice(1),d="regex"+l,c="netRegex"+l;for(const l of this.triggerSets){const u="zoneRegex"in l,h="zoneId"in l;if(!u&&!h||u&&h)console.error("Trigger set must include exactly one of zoneRegex or zoneId property");else if(h&&void 0===l.zoneId){const e=l.filename?`'${l.filename}'`:"(user file)";console.error(`Trigger set has zoneId, but with nothing specified in ${e}.  Did you misspell the ZoneId.ZoneName?`)}else{if(l.zoneId){if(l.zoneId!==ZoneId.MatchAll&&l.zoneId!==this.zoneId&&("object"!=typeof l.zoneId||!l.zoneId.includes(this.zoneId)))continue}else if(l.zoneRegex){let e=l.zoneRegex;if("object"!=typeof e){console.error("zoneRegex must be translatable object or regexp: "+JSON.stringify(l.zoneRegex));continue}if(!(e instanceof RegExp)){if(this.parserLang in e)e=e[this.parserLang];else{if(!("en"in e)){console.error("unknown zoneRegex parser language: "+JSON.stringify(l.zoneRegex));continue}e=e.en}if(!(e instanceof RegExp)){console.error("zoneRegex must be regexp: "+JSON.stringify(l.zoneRegex));continue}}if(this.zoneName.search(Regexes.parse(e))<0)continue}if(this.options.Debug&&(l.filename?console.log("Loading "+l.filename):console.log("Loading user triggers for zone")),l.triggers&&this.options.AlertsEnabled){let e=l.triggers.filter(e=>!("disabled"in e&&e.disabled));for(let t of e){if(t.filename=l.filename,!t.regex&&!t.netRegex){console.error("Trigger "+t.id+": has no regex property specified");continue}this.ProcessTrigger(t);let e=t[d]||t.regex;e&&(t.localRegex=Regexes.parse(e),r.push(t));let a=t[c]||t.netRegex;a&&(t.localNetRegex=Regexes.parse(a),i.push(t)),e||a||console.error("Trigger "+t.id+": missing regex and netRegex")}}if(l.overrideTimelineFile){const a=l.filename?`'${l.filename}'`:"(user file)";console.log(`Overriding timeline from ${a}.`),e=[],t=[]}if(l.timelineFile)if(l.filename){let t=l.filename.substring(0,l.filename.lastIndexOf("/"));e.push(t+"/"+l.timelineFile)}else console.error("Can't specify timelineFile in non-manifest file:"+l.timelineFile);if(l.timeline&&o(l.timeline),l.timelineReplace&&a.push(...l.timelineReplace),l.timelineTriggers)for(const e of l.timelineTriggers)this.ProcessTrigger(e),s.push(e);l.timelineStyles&&n.push(...l.timelineStyles),void 0!==l.resetWhenOutOfCombat&&(this.resetWhenOutOfCombat&=l.resetWhenOutOfCombat)}}this.triggers=r.asList(),this.netTriggers=i.asList(),this.timelineLoader.SetTimelines(e,t,a,s.asList(),n)}ProcessTrigger(e){e.output=new TriggerOutputProxy(e,this.options.DisplayLanguage,this.options.PerTriggerAutoConfig)}OnJobChange(e){this.me=e.detail.name,this.job=e.detail.job,this.role=_resources_common_js__WEBPACK_IMPORTED_MODULE_8__.a.jobToRole(this.job),this.ReloadTimelines()}OnInCombatChange(e){this.inCombat!==e&&(e||this.resetWhenOutOfCombat)&&this.SetInCombat(e)}SetInCombat(e){this.inCombat!==e&&(this.inCombat=e,this.inCombat||(this.StopTimers(),this.timelineLoader.StopCombat()),this.inCombat&&this.Reset())}ShortNamify(e){if("string"!=typeof e)return console.error("called ShortNamify with non-string"),"???";if(e in this.options.PlayerNicks)return this.options.PlayerNicks[e];let t=e.indexOf(" ");return t<0?e:e.substr(0,t)}Reset(){let e=0;this.data&&this.data.currentHP&&(e=this.data.currentHP),this.data={me:this.me,job:this.job,role:this.role,party:this.partyTracker,lang:this.parserLang,parserLang:this.parserLang,displayLang:this.displayLang,currentHP:e,options:this.options,ShortName:this.ShortNamify,StopCombat:()=>this.SetInCombat(!1),ParseLocaleFloat:parseFloat,CanStun:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_8__.a.canStun(this.job),CanSilence:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_8__.a.canSilence(this.job),CanSleep:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_8__.a.canSleep(this.job),CanCleanse:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_8__.a.canCleanse(this.job),CanFeint:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_8__.a.canFeint(this.job),CanAddle:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_8__.a.canAddle(this.job)},this.StopTimers(),this.triggerSuppress={}}StopTimers(){this.timers={}}OnLog(e){for(let t of e.detail.logs){t.includes("00:0038:cactbot wipe")&&this.SetInCombat(!1);for(let e of this.triggers){let a=t.match(e.localRegex);a&&this.OnTrigger(e,a)}}}OnNetLog(e){let t=e.rawLine;for(let e of this.netTriggers){let a=t.match(e.localNetRegex);a&&this.OnTrigger(e,a)}}OnTrigger(e,t){try{this.OnTriggerInternal(e,t)}catch(t){onTriggerException(e,t)}}OnTriggerInternal(e,t){let a=+new Date;if(this._onTriggerInternalCheckSuppressed(e,a))return;t&&t.groups&&(t=t.groups);let n=this._onTriggerInternalGetHelper(e,t,a);if(!this._onTriggerInternalCondition(n))return;this._onTriggerInternalPreRun(n);let r=this._onTriggerInternalDelaySeconds(n);this._onTriggerInternalDurationSeconds(n),this._onTriggerInternalSuppressSeconds(n);let i=()=>{let e=this._onTriggerInternalPromise(n),t=()=>{this._onTriggerInternalSound(n),this._onTriggerInternalSoundVolume(n),this._onTriggerInternalResponse(n),this._onTriggerInternalAlarmText(n),this._onTriggerInternalAlertText(n),this._onTriggerInternalInfoText(n),this._onTriggerInternalGroupTTS(n),this._onTriggerInternalTTS(n),this._onTriggerInternalPlayAudio(n),this._onTriggerInternalRun(n)};e?e.then(t,()=>{}):t()};r?r.then(i,()=>{}):i()}_onTriggerInternalGetHelper(e,t,a){let n;return n={trigger:e,now:a,valueOrFunction:t=>{let a=t;return"function"==typeof a&&(a=a(this.data,n.matches,e.output)),"object"!=typeof a||null===a?a:n.valueOrFunction(a[this.displayLang]||a.en)},triggerOptions:e.id&&this.options.PerTriggerOptions[e.id]||{},triggerAutoConfig:e.id&&this.options.PerTriggerAutoConfig[e.id]||{},userSuppressedOutput:e.id&&this.options.DisabledTriggers[e.id],matches:t,response:void 0,soundUrl:void 0,soundVol:void 0,triggerSoundVol:void 0,defaultTTSText:void 0,textAlertsEnabled:this.options.TextAlertsEnabled,soundAlertsEnabled:this.options.SoundAlertsEnabled,spokenAlertsEnabled:this.options.SpokenAlertsEnabled,GroupSpokenAlertsEnabled:this.options.GroupSpokenAlertsEnabled,duration:void 0,ttsText:void 0},this._onTriggerInternalHelperDefaults(n),n}_onTriggerInternalCheckSuppressed(e,t){if(e.id&&e.id in this.triggerSuppress){if(this.triggerSuppress[e.id]>t)return!0;delete this.triggerSuppress[e.id]}return!1}_onTriggerInternalCondition(e){let t=e.triggerOptions.Condition||e.trigger.condition;return!(t&&!t(this.data,e.matches))}_onTriggerInternalHelperDefaults(e){e.triggerAutoConfig&&("TextAlertsEnabled"in e.triggerAutoConfig&&(e.textAlertsEnabled=e.triggerAutoConfig.TextAlertsEnabled),"SoundAlertsEnabled"in e.triggerAutoConfig&&(e.soundAlertsEnabled=e.triggerAutoConfig.SoundAlertsEnabled),"SpokenAlertsEnabled"in e.triggerAutoConfig&&(e.spokenAlertsEnabled=e.triggerAutoConfig.SpokenAlertsEnabled)),e.triggerOptions&&("TextAlert"in e.triggerOptions&&(e.textAlertsEnabled=e.triggerOptions.TextAlert),"SoundAlert"in e.triggerOptions&&(e.soundAlertsEnabled=e.triggerOptions.SoundAlert),"SpeechAlert"in e.triggerOptions&&(e.spokenAlertsEnabled=e.triggerOptions.SpeechAlert),"GroupSpeechAlert"in e.triggerOptions&&(e.groupSpokenAlertsEnabled=e.triggerOptions.GroupSpeechAlert)),e.userSuppressedOutput&&(e.textAlertsEnabled=!1,e.soundAlertsEnabled=!1,e.spokenAlertsEnabled=!1,e.groupSpokenAlertsEnabled=!1),this.options.AudioAllowed||(e.soundAlertsEnabled=!1,e.spokenAlertsEnabled=!1,e.groupSpokenAlertsEnabled=!1)}_onTriggerInternalPreRun(e){"preRun"in e.trigger&&e.trigger.preRun(this.data,e.matches,e.trigger.output)}_onTriggerInternalDelaySeconds(e){let t="delaySeconds"in e.trigger?e.valueOrFunction(e.trigger.delaySeconds):0;if(!t||t<=0)return null;let a=this.currentTriggerID++;return this.timers[a]=!0,new Promise((e,n)=>{window.setTimeout(()=>{this.timers[a]?e():n&&n(),delete this.timers[a]},1e3*t)})}_onTriggerInternalDurationSeconds(e){e.duration={fromConfig:e.triggerAutoConfig.Duration,fromTrigger:e.valueOrFunction(e.trigger.durationSeconds),alarmText:this.options.DisplayAlarmTextForSeconds,alertText:this.options.DisplayAlertTextForSeconds,infoText:this.options.DisplayInfoTextForSeconds}}_onTriggerInternalSuppressSeconds(e){let t="suppressSeconds"in e.trigger?e.valueOrFunction(e.trigger.suppressSeconds):0;e.trigger.id&&t>0&&(this.triggerSuppress[e.trigger.id]=e.now+1e3*t)}_onTriggerInternalPromise(e){let t=null;return"promise"in e.trigger&&("function"==typeof e.trigger.promise?(t=e.trigger.promise(this.data,e.matches,e.trigger.output),Promise.resolve(t)!==t&&(console.error("Trigger "+e.trigger.id+": promise function did not return a promise"),t=null)):console.error("Trigger "+e.trigger.id+": promise defined but not a function")),t}_onTriggerInternalSound(e){e.soundUrl=e.valueOrFunction(e.trigger.sound)}_onTriggerInternalSoundVolume(e){e.triggerSoundVol=e.valueOrFunction(e.trigger.soundVolume)}_onTriggerInternalResponse(e){let t={};const a=e.trigger;if(a.response){for(t=a.response;"function"==typeof t;)t=t(this.data,e.matches,a.output);t||(t={})}e.response=t}_onTriggerInternalAlarmText(e){this._addTextFor("alarm",e)}_onTriggerInternalAlertText(e){this._addTextFor("alert",e)}_onTriggerInternalInfoText(e){this._addTextFor("info",e)}_onTriggerInternalGroupTTS(e){e.groupSpokenAlertsEnabled&&("GroupTTSText"in e.triggerOptions?e.ttsText=e.valueOrFunction(e.triggerOptions.GroupTTSText):"groupTTS"in e.trigger?e.ttsText=e.valueOrFunction(e.trigger.groupTTS):"groupTTS"in e.response&&(e.ttsText=e.valueOrFunction(e.response.groupTTS)))}_onTriggerInternalTTS(e){e.groupSpokenAlertsEnabled&&void 0!==e.ttsText||("TTSText"in e.triggerOptions?e.ttsText=e.valueOrFunction(e.triggerOptions.TTSText):"tts"in e.trigger?e.ttsText=e.valueOrFunction(e.trigger.tts):"tts"in e.response?e.ttsText=e.valueOrFunction(e.response.TTSText):e.ttsText=e.defaultTTSText)}_onTriggerInternalPlayAudio(e){if(e.trigger.sound&&e.soundUrl){let t=e.soundUrl+"Sound",a=e.soundUrl+"SoundVolume";t in this.options&&(e.soundUrl=this.options[t],a in this.options&&(e.soundVol=this.options[a]))}if(e.soundUrl=e.triggerOptions.SoundOverride||e.soundUrl,e.soundVol=e.triggerOptions.VolumeOverride||e.triggerSoundVol||e.soundVol,e.ttsText&&e.spokenAlertsEnabled){e.ttsText=e.ttsText.toString(),e.ttsText=e.ttsText.replace(/[#!]/g,""),e.ttsText=e.ttsText.replace("/"," "),e.ttsText=e.ttsText.replace(/~+$/,""),e.ttsText=e.ttsText.replace(/[↖-↙]/g,""),e.ttsText=e.ttsText.replace("1번째","첫번째"),e.ttsText=e.ttsText.replace(/[-=]>\s*$/g,""),e.ttsText=e.ttsText.replace(/^\s*<[-=]/g,"");const t={en:" then ",cn:"然后",de:" dann ",fr:" puis ",ja:"や",ko:" 그리고 "};e.ttsText=e.ttsText.replace(/\s*(<[-=]|[=-]>)\s*/g,t[this.displayLang]),this.ttsSay(e.ttsText)}else e.soundUrl&&e.soundAlertsEnabled&&this._playAudioFile(e.soundUrl,e.soundVol)}_onTriggerInternalRun(e){"run"in e.trigger&&e.trigger.run(this.data,e.matches,e.trigger.output)}_createTextFor(e,t,a,n){let r=t+"-text";"info"!==t&&(e=triggerUpperCase(e));let i=this[a].getElementsByClassName("holder")[0],s=this._makeTextElement(e,r);i.appendChild(s),i.children.length>this.kMaxRowsOfText&&i.removeChild(i.children[0]),window.setTimeout(()=>{i.contains(s)&&i.removeChild(s)},1e3*n)}_addTextFor(e,t){let a=e[0].toUpperCase()+e.slice(1),n=e+"Text",r=a+"Text",i=t.triggerOptions[r]||t.trigger[n]||t.response[n];if(i){let r=t.valueOrFunction(i);if(t.defaultTTSText=t.defaultTTSText||r,r&&t.textAlertsEnabled){const i=t.duration.fromConfig||t.duration.fromTrigger||t.duration[n];this._createTextFor(r,e,n,i),t.soundUrl||(t.soundUrl=this.options[a+"Sound"],t.soundVol=this.options[a+"SoundVolume"])}}}_makeTextElement(e,t){let a=document.createElement("div");return a.classList.add(t),a.classList.add("animate-text"),a.innerText=e,a}_playAudioFile(e,t){let a=new Audio(e);a.volume=t||1,a.play()}Test(e,t){this.OnPlayerChange({detail:{name:"ME"}}),this.OnChangeZone({zoneName:e}),this.OnLog({detail:{logs:["abcdefgh",t,"hgfedcba"]}})}}class PopupTextGenerator{constructor(e){this.popupText=e}Info(e){this.popupText.OnTrigger({infoText:e,tts:e})}Alert(e){this.popupText.OnTrigger({alertText:e,tts:e})}Alarm(e){this.popupText.OnTrigger({alarmText:e,tts:e})}TTS(e){this.popupText.OnTrigger({infoText:e,tts:e})}Trigger(e,t){this.popupText.OnTrigger(e,t)}}let gPopupText},,function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return i}));var n=a(2);const r=function(e,t){if(!t)return;let a=null,r=null;const i=n=>{e&&(n.detail.name=e,r&&(n.detail.job=r)),a=n,t(n)};window.addOverlayListener("onPlayerChangedEvent",i),e&&window.addOverlayListener("PartyChanged",t=>{const s=t.party.find(t=>t.name===e);if(!s)return;const o=n.a.jobEnumToJob(s.job);o!==r&&(r=o,a&&i(a))})},i=function(e){const t={en:"Select a Player\n(the list will update when in an instance)",de:"Wähle einen Spieler\n(Diese Liste aktualisiert sich, sobald eine Instance betretten wird)",fr:"Sélectionner un joueur\n (la liste se mettra à jour dans une instance)",ja:"プレーヤー名を選択してください\n(インスタンスに入るとリストが更新する)",cn:"请选择玩家名称\n(此列表将会在进入副本后更新)",ko:"플레이어를 선택하세요\n(인스턴스에 있으면 리스트가 업데이트됩니다.)"},a={en:"Force Enable Text To Speech",de:"Erzwinge Text in Sprache (TTS)",fr:"Forcer l'activation de la synthèse vocale (TTS)",ja:"TTSを強制的に有効化する",cn:"强制启用TTS",ko:"TTS 기능을 활성화하기"},n={en:"Start Overlay",de:"Start Overlay",fr:"Démarrer l'Overlay",ja:"オーバーレイを起動",cn:"启用悬浮窗",ko:"오버레이 시작"},r={en:"(no override)",de:"(kein überschreiben)",fr:"(pas de dérogation)",ja:"(既定値)",cn:"(默认值)",ko:"(플레이어 지정 안함)"};let i=document.createElement("div");i.id="player-select",document.body.appendChild(i);let s=document.createElement("div");s.id="player-select-instructions",s.innerHTML=t[e]||t.en,i.appendChild(s);let o=document.createElement("div");o.id="player-select-list",i.appendChild(o);let l=document.createElement("input");l.type="checkbox",l.id="player-select-tts",l.name="player-select-tts",i.appendChild(l);let d=document.createElement("label");d.id="player-select-tts-label",d.htmlFor="player-select-tts",d.innerHTML=a[e]||a.en,i.appendChild(d);let c=document.createElement("button");c.id="player-select-button",c.name="player-select-button",c.innerHTML=n[e]||n.en,i.appendChild(c),c.addEventListener("click",e=>{const t=document.getElementById("player-select-tts").checked;let a="",n=0;for(;;){n++;const e=document.getElementById("player-radio-"+n);if(!e)break;if(e.checked){a=e.value;break}}a&&(e=>{window.localStorage.setItem("cactbot-last-selected-player",e)})(a);const r=new URLSearchParams(window.location.search);let i={};r.forEach((e,t)=>i[t]=decodeURIComponent(e)),i.player=a,i.forceTTS=t?1:0;let s="?";for(const[e,t]of Object.entries(i))s+=e+"="+t+"&";window.location.search=s});const u=window.localStorage.getItem("cactbot-last-selected-player"),h=t=>{for(;o.firstChild;)o.removeChild(o.lastChild);let a=0;const n=(e,t,n)=>{a++;const r="player-radio-"+a,i=document.createElement("input");i.type="radio",i.value=t,i.id=r,i.name="player-radio",i.classList.add("player-radio",n),o.appendChild(i);const s=document.createElement("label");return s.htmlFor=r,s.innerHTML=e,o.appendChild(s),i};if(n(r[e]||r.en,"","player-radio-default").checked=!0,u){n(u,u,"player-radio-last").checked=!0}const i=t.filter(e=>e.inParty&&e.name!==u).map(e=>e.name).sort();for(const e of i)n(e,e,"player-radio-party");const s=t.filter(e=>!e.inParty&&e.name!==u).map(e=>e.name).sort();for(const e of s)n(e,e,"player-radio-alliance")};window.addOverlayListener("PartyChanged",e=>{h(e.party)}),h([])}},,function(module,__webpack_exports__,__webpack_require__){"use strict";var _resources_party_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10),_resources_regexes_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),_resources_user_config_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_resources_common_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2),_resources_conditions_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7),_resources_netregexes_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(3),_resources_responses_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(6),_resources_zone_id_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(0);const Regexes=_resources_regexes_js__WEBPACK_IMPORTED_MODULE_1__.a,Conditions=_resources_conditions_js__WEBPACK_IMPORTED_MODULE_4__.a,NetRegexes=_resources_netregexes_js__WEBPACK_IMPORTED_MODULE_5__.a,Responses=_resources_responses_js__WEBPACK_IMPORTED_MODULE_6__.a,ZoneId=_resources_zone_id_js__WEBPACK_IMPORTED_MODULE_7__.a,kOptionKeys={output:"Output",duration:"Duration",outputStrings:"OutputStrings"};let kTriggerOptions={default:{label:{en:"✔ Defaults",de:"✔ Standards",fr:"✔ Défauts",ja:"✔ 初期設定",cn:"✔ 默认设置",ko:"✔ 기본"}},textAndSound:{label:{en:"🆙🔊 Text and Sound",de:"🆙🔊 Text und Ton",fr:"🆙🔊 Texte et son",ja:"🆙🔊 テキストと音声",cn:"🆙🔊 文字显示与提示音",ko:"🆙🔊 텍스트와 소리"}},ttsAndText:{label:{en:"🆙💬 Text and TTS",de:"🆙💬 Text und TTS",fr:"🆙💬 Texte et TTS",ja:"🆙💬 テキストとTTS",cn:"🆙💬 文字显示与TTS",ko:"🆙💬 텍스트와 TTS"}},ttsOnly:{label:{en:"💬 TTS Only",de:"💬 Nur TTS",fr:"💬 TTS Seulement",ja:"💬 TTSのみ",cn:"💬 只使用TTS",ko:"💬 TTS만"}},textOnly:{label:{en:"🆙 Text Only",de:"🆙 Nur Text",fr:"🆙 Texte seulement",ja:"🆙 テキストのみ",cn:"🆙 只使用文字显示",ko:"🆙 텍스트만"}},disabled:{label:{en:"❌ Disabled",de:"❌ Deaktiviert",fr:"❌ Désactivé",ja:"❌ 無効",cn:"❌ 禁用",ko:"❌ 비활성화"}}},kDetailKeys={triggerRegex:{label:{en:"regex",de:"regex",fr:"regex",ja:"正規表現",cn:"正则表达式",ko:"정규식"},cls:"regex-text",debugOnly:!0},triggerNetRegex:{label:{en:"netregex",de:"netregex",fr:"netregex",ja:"ネット正規表現",cn:"网络日志正则表达式"},cls:"regex-text",debugOnly:!0},timelineRegex:{label:{en:"timeline",de:"timeline",fr:"timeline",ja:"タイムライン",cn:"时间轴",ko:"타임라인"},cls:"regex-text",debugOnly:!0},condition:{label:{en:"condition",de:"condition",fr:"condition",ja:"条件",cn:"条件",ko:"조건"},cls:"condition-text",debugOnly:!0},duration:{label:{en:"duration (sec)",de:"Dauer (Sekunden)",fr:"Durée (secondes)",ja:"存続時間 (秒)",cn:"持续时间 (秒)",ko:"지속 시간 (초)"},cls:"duration-text",generatedManually:!0},preRun:{label:{en:"preRun",de:"preRun",fr:"preRun",ja:"プレ実行",cn:"预运行",ko:"사전 실행"},cls:"prerun-text",debugOnly:!0},alarmText:{label:{en:"alarm",de:"alarm",fr:"alarme",ja:"警報",cn:"警报文本",ko:"경고"},cls:"alarm-text"},alertText:{label:{en:"alert",de:"alert",fr:"alerte",ja:"警告",cn:"警告文本",ko:"주의"},cls:"alert-text"},infoText:{label:{en:"info",de:"info",fr:"info",ja:"情報",cn:"信息文本",ko:"안내"},cls:"info-text"},tts:{label:{en:"tts",de:"tts",fr:"tts",ja:"TTS",cn:"TTS",ko:"tts"},cls:"tts-text"},sound:{label:{en:"sound",de:"sound",fr:"son",ja:"音声",cn:"提示音",ko:"소리"},cls:"sound-text"},run:{label:{en:"run",de:"run",fr:"run",ja:"実行",cn:"运行",ko:"실행"},cls:"run-text",debugOnly:!0}};const kMiscTranslations={valueDefault:{en:"(default)",de:"(Standard)",fr:"(Défaut)",ja:"(初期値)",cn:"(默认值)",ko:"(기본값)"}},validDurationOrUndefined=e=>{if(e=parseFloat(e),!isNaN(e)&&e>=0)return e};function setOptionsFromOutputValue(e,t){"default"===t||("textAndSound"===t?(e.TextAlertsEnabled=!0,e.SoundAlertsEnabled=!0,e.SpokenAlertsEnabled=!1):"ttsAndText"===t?(e.TextAlertsEnabled=!0,e.SoundAlertsEnabled=!0,e.SpokenAlertsEnabled=!0):"ttsOnly"===t?(e.TextAlertsEnabled=!1,e.SoundAlertsEnabled=!0,e.SpokenAlertsEnabled=!0):"textOnly"===t?(e.TextAlertsEnabled=!0,e.SoundAlertsEnabled=!1,e.SpokenAlertsEnabled=!1):"disabled"===t?(e.TextAlertsEnabled=!1,e.SoundAlertsEnabled=!1,e.SpokenAlertsEnabled=!1):console.error("unknown output type: "+t))}class DoNothingFuncProxy{constructor(e){return new Proxy(this,{set(t,a,n){if("responseOutputStrings"===a)return e(n),!0},get:(e,t)=>()=>{}})}}class RaidbossConfigurator{constructor(e){this.base=e,this.alertsLang=this.base.getOption("raidboss","AlertsLanguage",this.base.lang),this.timelineLang=this.base.getOption("raidboss","TimelineLanguage",this.base.lang)}buildUI(e,t){const a=this.processRaidbossFiles(t);let n={};for(const t in a){const r=a[t],i=r.prefix;if(0===Object.keys(r.triggers).length)continue;if(!n[i]){let t=document.createElement("div");t.classList.add("trigger-expansion-container","collapsed"),e.appendChild(t);let a=document.createElement("div");a.classList.add("trigger-expansion-header"),a.onclick=()=>{t.classList.toggle("collapsed")},a.innerText=i,t.appendChild(a),n[i]=t}let s=document.createElement("div");s.classList.add("trigger-file-container","collapsed"),n[i].appendChild(s);let o=document.createElement("div");o.classList.add("trigger-file-header"),o.onclick=()=>{s.classList.toggle("collapsed")};let l=[r.title,r.type,i];for(let e=0;e<l.length;++e){if(!l[e])continue;let t=document.createElement("div");t.classList.add("trigger-file-header-part"),t.innerText=l[e],o.appendChild(t)}s.appendChild(o);let d=document.createElement("div");d.classList.add("trigger-file-options"),s.appendChild(d);for(let e in r.triggers){let t=r.triggers[e],a=0;for(let e in kDetailKeys)!this.base.developerOptions&&kDetailKeys[e].debugOnly||(t[e]||t.output[e])&&a++;if(0===a)continue;let n=document.createElement("div");n.innerHTML=t.id,n.classList.add("trigger"),d.appendChild(n);let i=document.createElement("div");i.classList.add("trigger-details"),d.appendChild(i),i.appendChild(this.buildTriggerOptions(t,n));for(const e in kDetailKeys){if(kDetailKeys[e].generatedManually)continue;if(!this.base.developerOptions&&kDetailKeys[e].debugOnly)continue;if(!t[e]&&!t.output[e])continue;let a=document.createElement("div");a.innerText=this.base.translate(kDetailKeys[e].label),a.classList.add("trigger-label"),i.appendChild(a);let n=document.createElement("div");n.classList.add("trigger-detail");t.output[e];n.classList.add(kDetailKeys[e].cls),t.output[e]?n.innerText=t.output[e]:"function"==typeof t[e]?(n.innerText="(function)",n.classList.add("function-text")):n.innerText=t[e],i.appendChild(n)}let s=!1;for(const e of _resources_responses_js__WEBPACK_IMPORTED_MODULE_6__.b)if(t[e]){s=!0;break}if(s){const e="duration",a=kOptionKeys.duration;let n=document.createElement("div");n.innerText=this.base.translate(kDetailKeys[e].label),n.classList.add("trigger-label"),i.appendChild(n);let r=document.createElement("div");r.classList.add("option-input-container","trigger-duration");let s=document.createElement("input");r.appendChild(s),s.type="text",s.step="any",s.placeholder=this.base.translate(kMiscTranslations.valueDefault),s.value=this.base.getOption("raidboss","triggers",t.id,a,"");let o=()=>{let e=validDurationOrUndefined(s.value)||"";this.base.setOption("raidboss","triggers",t.id,a,e)};s.onchange=o,s.oninput=o,i.appendChild(r)}const o=t.outputStrings||{};for(const e in o){const a=kOptionKeys.outputStrings;let n=this.base.translate(o[e]),r=document.createElement("div");r.innerText=e,r.classList.add("trigger-outputstring-label"),i.appendChild(r);let s=document.createElement("div");s.classList.add("option-input-container","trigger-outputstring");let l=document.createElement("input");s.appendChild(l),l.type="text",l.placeholder=n,l.value=this.base.getOption("raidboss","triggers",t.id,a,e,"");let d=()=>this.base.setOption("raidboss","triggers",t.id,a,e,l.value);l.onchange=d,l.oninput=d,i.appendChild(s)}}}}valueOrFunction(e,t,a,n){let r="function"==typeof e?e(t,a,n):e;return r!==Object(r)?r:r[this.alertsLang]?this.valueOrFunction(r[this.alertsLang]):r[this.timelineLang]?this.valueOrFunction(r[this.timelineLang]):this.valueOrFunction(r.en)}processTrigger(e){e.output=new DoNothingFuncProxy(t=>{e.outputStrings=e.outputStrings||{},Object.assign(e.outputStrings,t)});let t={party:new _resources_party_js__WEBPACK_IMPORTED_MODULE_0__.a,lang:this.base.lang,currentHP:1e3,options:this.base.configOptions,ShortName:e=>e,StopCombat:()=>{},ParseLocaleFloat:parseFloat,CanStun:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_3__.a.canStun(this.job),CanSilence:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_3__.a.canSilence(this.job),CanSleep:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_3__.a.canSleep(this.job),CanCleanse:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_3__.a.canCleanse(this.job),CanFeint:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_3__.a.canFeint(this.job),CanAddle:()=>_resources_common_js__WEBPACK_IMPORTED_MODULE_3__.a.canAddle(this.job)},a=[{me:"Tini Poutini",job:"GNB",role:"tank"},{me:"Potato Chippy",job:"WHM",role:"healer"},{me:"Tater Tot",job:"BLM",role:"dps"},{me:"Hash Brown",job:"DRG",role:"dps"},{me:"Aloo Gobi",job:"BLU",role:"dps"}];for(let e=0;e<a.length;++e)a[e]=Object.assign({},a[e],t);let n={1:a[0].me,sourceId:"41234567",source:"Enemy",id:"1234",ability:"Ability",targetId:"1234567",target:a[0].me,flags:"",x:100,y:100,z:0,heading:0,npcId:void 0,effect:"Effect",duration:30,code:"00",line:"",name:"Name",capture:!0},r={},i=["alarmText","alertText","infoText","tts","sound"],s=(e,t,i)=>{try{let s=this.valueOrFunction(e[t],a[i],n,e.output);return!!s&&(!s.includes("undefined")&&!s.includes("NaN")&&(r[t]=s,!0))}catch(e){return!1}};if(e.response){let t=e.response;for(let r=0;r<a.length;++r)try{let o=t;for(;"function"==typeof o;)o=o(a[r],n,e.output);if(!o)continue;if(!e.outputStrings)for(const e of i)s(o,e,r);break}catch(e){continue}}if(!e.outputStrings)for(const t of i)if(e[t])for(let n=0;n<a.length&&!s(e,t,n);++n);e.output=r;let o=this.base.lang,l=t=>{let a=o.charAt(0).toUpperCase()+o.slice(1),n=e[t+a]||e[t];if(!n)return;let r=Regexes.parse(n);return r?Regexes.parse(r):void 0};return e.isTimelineTrigger?e.timelineRegex=l("regex"):(e.triggerRegex=l("regex"),e.triggerNetRegex=l("netRegex")),e}processRaidbossFiles(e){let t=this.base.processFiles(e);for(let[e,a]of Object.entries(t)){let e={trigger:[],timeline:[]};for(const t of a.json)t.triggers&&e.trigger.push(...t.triggers),t.timelineTriggers&&e.timeline.push(...t.timelineTriggers);a.triggers={};for(const t in e)for(const n of e[t])n.id&&(n.isTimelineTrigger="timeline"===t,a.triggers[n.id]=this.processTrigger(n))}return t}buildTriggerOptions(e,t){let a=kOptionKeys.output,n=document.createElement("div");n.classList.add("trigger-options");let r=e=>{"hidden"===e.value||"disabled"===e.value?t.classList.add("disabled"):t.classList.remove("disabled")},i=document.createElement("select");n.appendChild(i);let s=this.base.getOption("raidboss","triggers",e.id,a,"default");for(let t in kTriggerOptions){if(!this.base.developerOptions&&kTriggerOptions[t].debugOnly&&t!==s)continue;let n=document.createElement("option");n.innerHTML=this.base.translate(kTriggerOptions[t].label),n.value=t,n.selected=t===s,i.appendChild(n),r(i),i.onchange=()=>{r(i);let t=i.value;t.includes("default")&&(t="default"),this.base.setOption("raidboss","triggers",e.id,a,i.value)}}return n}}const userFileHandler=(name,files,options)=>{let Options=options;if(eval(files[name]),options.Triggers)for(const e of options.Triggers)if(e.filename="user/"+name,e.timelineFile){let t=name.substring(0,name.lastIndexOf("/"));t=t?"$(dir)/":"";const a=`${t}${e.timelineFile}`;if(delete e.timelineFile,!(a in files)){console.log(`ERROR: '${name}' specifies non-existent timeline file '${a}'.`);continue}e.timeline=[e.timeline,files[a]]}},templateOptions={buildExtraUI:(e,t)=>{let a=new URL("../raidboss/raidboss.html",location.href);callOverlayHandler({call:"cactbotReadDataFiles",source:a}).then(a=>{let n=a.detail.files;new RaidbossConfigurator(e).buildUI(t,n)})},processExtraOptions:(e,t)=>{const a="PerTriggerAutoConfig";e[a]=e[a]||{};const n=t.triggers;if(!n)return;const r=e[a],i={},s=Object.keys(kTriggerOptions);for(const e of s)i[e]={},setOptionsFromOutputValue(i[e],e);for(const e in n){const t={},a=n[e][kOptionKeys.output];a&&Object.assign(t,i[a]);const s=validDurationOrUndefined(n[e][kOptionKeys.duration]);s&&(t[kOptionKeys.duration]=s);const o=n[e][kOptionKeys.outputStrings];o&&(t[kOptionKeys.outputStrings]=o),(a||s||o)&&(r[e]=t)}},options:[{id:"Debug",name:{en:"Enable debug mode",de:"Aktiviere Debugmodus",fr:"Activer le mode debug",ja:"デバッグモードを有効にする",cn:"启用调试模式",ko:"디버그 모드 활성화"},type:"checkbox",debugOnly:!0},{id:"DefaultAlertOutput",name:{en:"Default alert output",de:"Standard Alert Ausgabe",fr:"Alerte par défaut",ja:"警告情報出力既定値",cn:"默认警报提示信息输出方式",ko:"기본 알람 출력 방식"},type:"select",options:{en:{"🆙🔊 Text and Sound":"textAndSound","🆙💬 Text and TTS":"ttsAndText","💬 TTS Only":"ttsOnly","🆙 Text Only":"textOnly","❌ Disabled":"disabled"},de:{"🆙🔊 Text und Ton":"textAndSound","🆙💬 Text und TTS":"ttsAndText","💬 Nur TTS":"ttsOnly","🆙 Nur Text":"textOnly","❌ Deaktiviert":"disabled"},fr:{"🆙🔊 Texte et son":"textAndSound","🆙💬 Texte et TTS":"ttsAndText","💬 TTS seulement":"ttsOnly","🆙 Texte seulement":"textOnly","❌ Désactivé":"disabled"},ja:{"🆙🔊 テキストと音声":"textAndSound","🆙💬 テキストとTTS":"ttsAndText","💬 TTSのみ":"ttsOnly","🆙 テキストのみ":"textOnly","❌ 無効":"disabled"},cn:{"🆙🔊 文字显示与提示音":"textAndSound","🆙💬 文字显示与TTS":"ttsAndText","💬 只使用TTS":"ttsOnly","🆙 只使用文字显示":"textOnly","❌ 禁用":"disabled"},ko:{"🆙🔊 텍스트와 소리":"textAndSound","🆙💬 텍스트와 TTS":"ttsAndText","💬 TTS만":"ttsOnly","🆙 텍스트만":"textOnly","❌ 비활성화":"disabled"}},default:"textAndSound",setterFunc:setOptionsFromOutputValue},{id:"AlertsLanguage",name:{en:"Alerts language",de:"Alert Sprache",fr:"Langue des alertes",ja:"警告情報の言語",cn:"警报提示文字的语言",ko:"알람 언어"},type:"select",options:{en:{"Use Display Language":"default","English (en)":"en","Chinese (cn)":"cn","German (de)":"de","French (fr)":"fr","Japanese (ja)":"ja","Korean (ko)":"ko"},fr:{"Utiliser la langue d'affichage":"default","Anglais (en)":"en","Chinois (cn)":"cn","Allemand (de)":"de","Français (fr)":"fr","Japonais (ja)":"ja","Coréen (ko)":"ko"},ja:{"表示言語既定値":"default","英語 (en)":"en","中国語 (cn)":"cn","ドイツ語 (de)":"de","フランス語 (fr)":"fr","日本語 (ja)":"ja","韓国語 (ko)":"ko"},cn:{"使用显示语言":"default","英语 (en)":"en","汉语 (cn)":"cn","德语 (de)":"de","法语 (fr)":"fr","日语 (ja)":"ja","韩语 (ko)":"ko"},ko:{"주 사용 언어 사용":"default","영어 (en)":"en","중국어 (cn)":"cn","독일어 (de)":"de","프랑스어 (fr)":"fr","일본어 (ja)":"ja","한국어 (ko)":"ko"}},default:"default",debug:!0,setterFunc:(e,t)=>{"default"!==t&&(e.AlertsLanguage=t)}},{id:"TimelineLanguage",name:{en:"Timeline language",de:"Timeline Sprache",fr:"Langue de la timeline",ja:"タイムラインの言語",cn:"时间轴文本的语言",ko:"타임라인 언어"},type:"select",options:{en:{"Use FFXIV Plugin Language":"default","English (en)":"en","Chinese (cn)":"cn","German (de)":"de","French (fr)":"fr","Japanese (ja)":"ja","Korean (ko)":"ko"},de:{"Benutze FFXIV Plugin Sprache":"default","Englisch (en)":"en","Chinesisch (cn)":"cn","Deutsch (de)":"de","Französisch (fr)":"fr","Japanisch (ja)":"ja","Koreanisch (ko)":"ko"},fr:{"Utiliser la langue du Plugin FFXIV":"default","Anglais (en)":"en","Chinois (cn)":"cn","Allemand (de)":"de","Français (fr)":"fr","Japonais (ja)":"ja","Coréen (ko)":"ko"},ja:{"FFXIV Pluginの言語設定":"default","英語 (en)":"en","中国語 (cn)":"cn","ドイツ語 (de)":"de","フランス語 (fr)":"fr","日本語 (ja)":"ja","韓国語 (ko)":"ko"},cn:{"使用最终幻想XIV解析插件设置的语言":"default","英语 (en)":"en","汉语 (cn)":"cn","德语 (de)":"de","法语 (fr)":"fr","日语 (ja)":"ja","韩语 (ko)":"ko"},ko:{"FFXIV Plugin 언어 사용":"default","영어 (en)":"en","중국어 (cn)":"cn","독일어 (de)":"de","프랑스어 (fr)":"fr","일본어 (ja)":"ja","한국어 (ko)":"ko"}},default:"default",debug:!0,setterFunc:(e,t)=>{"default"!==t&&(e.TimelineLanguage=t)}},{id:"Skin",name:{en:"Raidboss Skin",de:"Raidboss Skin",fr:"Raidboss Skin",ja:"Raidbossのスキン",cn:"Raidboss皮肤",ko:"Raidboss 스킨"},type:"select",options:{en:{Default:"default",lippe:"lippe"},de:{Default:"default",lippe:"lippe"},fr:{"Défaut":"default",lippe:"lippe"},ja:{"初期設定":"default",lippe:"lippe"},cn:{"默认":"default",lippe:"lippe"},ko:{"기본":"default",lippe:"lippe"}},default:"default"},{id:"TimelineEnabled",name:{en:"Timeline enabled",de:"Timeline aktiviert",fr:"Timeline activée",ja:"タイムラインを有効にする",cn:"启用时间轴",ko:"타임라인 활성화"},type:"checkbox",default:!0},{id:"AlertsEnabled",name:{en:"Alerts enabled",de:"Alerts aktiviert",fr:"Alertes activées",ja:"警告情報を有効にする",cn:"启用提示文本显示",ko:"알람 활성화"},type:"checkbox",default:!0},{id:"ShowTimerBarsAtSeconds",name:{en:"Timer bar show window (seconds)",de:"Timer-Bar Anzeigedauer (in Sekunden)",fr:"Fenêtre d'affichage de la barre de temps (secondes)",ja:"タイムバーに時間表示 (秒)",cn:"计时条显示时长 (秒)",ko:"타임라인을 표시할 기준 시간 (초 이하)"},type:"float",default:30},{id:"KeepExpiredTimerBarsForSeconds",name:{en:"Keep expired timer bar (seconds)",de:"Behalte abgelaufene Timer-Bar (in Sekunden)",fr:"Garder la barre de temps expirée (secondes)",ja:"終了したタイムバーが消えるまでの待ち時間 (秒)",cn:"已失效的计时条的淡出时间 (秒)",ko:"만료된 타임라인이 사라지기까지의 시간 (초)"},type:"float",default:.7},{id:"BarExpiresSoonSeconds",name:{en:"Time to recolor timer as expiring soon (seconds)",de:"Zeit bis ein bald auslaufender Timer umgefärbt wird (in Sekunden)",fr:"Recolorisation de la barre de temps avant expiration (secondes)",ja:"タイムバーが終了前に再度色付けの残り時間 (秒)",cn:"倒计时小于该值时当前计时条变色 (秒)",ko:"타임라인의 색상을 바꿀 기준 시간 (초 이하)"},type:"integer",default:6},{id:"MaxNumberOfTimerBars",name:{en:"Max number of timer bars",de:"Max Anzahl an Timer-Bars",fr:"Nombre max de barres de temps",ja:"タイムバーの最大数",cn:"计时条最大数量",ko:"표시할 타임라인의 최대 개수"},type:"integer",default:6},{id:"DisplayAlarmTextForSeconds",name:{en:"Alarm text display duration (seconds)",de:"Alarm-Text Anzeigedauer (in Sekunden)",fr:"Durée d'affichage du texte d'alarme (secondes)",ja:"警報テキスト表示時間の長さ (秒)",cn:"警报文字显示持续时间 (秒)",ko:"경고 텍스트를 표시할 시간 (초)"},type:"float",default:3},{id:"DisplayAlertTextForSeconds",name:{en:"Alert text display duration (seconds)",de:"Alert-Text Anzeigedauer (in Sekunden)",fr:"Durée d'affichage du texte d'alerte (secondes)",ja:"警告テキスト表示時間の長さ (秒)",cn:"警告文字显示持续时间 (秒)",ko:"주의 텍스트를 표시할 시간 (초)"},type:"float",default:3},{id:"DisplayInfoTextForSeconds",name:{en:"Info text display duration (seconds)",de:"Info-Text Anzeigedauer (in Sekunden)",fr:"Durée d'affichage du texte d'information (secondes)",ja:"情報テキスト表示時間の長さ (秒)",cn:"信息文字显示持续时间 (秒)",ko:"안내 텍스트를 표시할 시간 (초)"},type:"float",default:3},{id:"AlarmSoundVolume",name:{en:"Alarm sound volume (0-1)",de:"Alarm Lautstärke (0-1)",fr:"Volume de l'alarme (0-1)",ja:"警報音声の音量 (0-1)",cn:"警报提示音的音量 (0-1)",ko:"경고 소리 크기 (0-1)"},type:"float",default:1},{id:"AlertSoundVolume",name:{en:"Alert sound volume (0-1)",de:"Alert Lautstärke (0-1)",fr:"Volume de l'alerte (0-1)",ja:"警告音声の音量 (0-1)",cn:"警告提示音的音量 (0-1)",ko:"주의 소리 크기 (0-1)"},type:"float",default:1},{id:"InfoSoundVolume",name:{en:"Info sound volume (0-1)",de:"Info Lautstärke (0-1)",fr:"Volume de l'info (0-1)",ja:"情報音声の音量 (0-1)",cn:"信息提示音的音量 (0-1)",ko:"안내 소리 크기 (0-1)"},type:"float",default:1},{id:"LongSoundVolume",name:{en:"Long sound volume (0-1)",de:"Langer Ton Lautstärke (0-1)",fr:"Volume du son long (0-1)",ja:"長い音声の音量 (0-1)",cn:"长提示音的音量 (0-1)",ko:"긴 소리 크기 (0-1)"},type:"float",default:1},{id:"PullSoundVolume",name:{en:"Pull sound volume (0-1)",de:"Pull Lautstärke (0-1)",fr:"Volume du son de pull (0-1)",ja:"タゲ取る効果音の音量 (0-1)",cn:"开怪提示音的音量 (0-1)",ko:"풀링 소리 크기 (0-1)"},type:"float",default:1},{id:"BrowserTTS",name:{en:"Use Browser for Text to Speech",de:"Verwenden Sie den Browser für Text zu Sprache",fr:"Utiliser le navigateur pour la synthèse vocale",ko:"웹브라우저를 이용해서 TTS 작동시키기",ja:"ブラウザでTTS",cn:"忽略ACT的设置，使用Cactbot自带的Google TTS功能（需联网）"},type:"checkbox",default:!1},{id:"cactbotWormholeStrat",name:{en:"Alex Ultimate: enable cactbot Wormhole strat",de:"Alex Ultimate: aktiviere cactbot Wormhole Strategie",fr:"Alex fatal : activer cactbot pour Wormhole strat",ko:"절 알렉: cactbot 웜홀 공략방식 활성화",ja:"絶アレキサンダー討滅戦：cactbot「次元断絶のマーチ」ギミック",cn:"亚历山大绝境战：cactbot灵泉辅助功能"},type:"checkbox",default:!1},{id:"cactbote8sUptimeKnockbackStrat",name:{en:"e8s: enable cactbot Uptime Knockback strat",de:"e8s: aktiviere cactbot Uptime Knockback Strategie",fr:"e8s : activer cactbot pour Uptime Knockback strat",ja:"エデン零式共鳴編４層：cactbot「ヘヴンリーストライク (ノックバック)」ギミック",cn:"E8S: 启用cactbot的击退提示功能",ko:"공명 영웅 4층: cactbot 정확한 타이밍 넉백방지 공략 활성화"},type:"checkbox",default:!1}]};_resources_user_config_js__WEBPACK_IMPORTED_MODULE_2__.a.registerOptions("raidboss",templateOptions,userFileHandler)},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));class n{static Check(){return"suspended"===(new AudioContext).state}static Prompt(){let e=document.createElement("button");e.innerText="Click to enable audio",e.classList.add("autoplay-helper-button"),e.onclick=function(){e.remove()},document.body.appendChild(e)}static CheckAndPrompt(){n.Check()&&n.Prompt()}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));const n=0,r=1;class i{play(){}}class s extends i{constructor(e,t,a){super(),this.text=e,this.item=new SpeechSynthesisUtterance(e),this.item.lang=t,this.item.voice=a}play(){window.speechSynthesis.speak(this.item)}}class o extends i{constructor(e,t){super(),this.lang=t,this.text=e;let a=document.createElement("iframe");a.removeAttribute("sandbox"),a.style.display="none",document.body.appendChild(a);let n=encodeURIComponent(e);a.contentDocument.body.innerHTML='<audio src="https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl='+t+"&q="+n+'" id="TTS">',this.item=a.contentDocument.body.firstElementChild}play(){this.item.play()}}class l{constructor(e){this.googleTTSLang="cn"===e?"zh":e;const t={en:"en-US",de:"de-DE",fr:"fr-FR",ja:"ja-JP",cn:"zh-CN",ko:"ko-KR"};void 0!==window.speechSynthesis&&(window.speechSynthesis.onvoiceschanged=()=>{const a=t[e],r=window.speechSynthesis.getVoices().find(e=>e.lang===a);r&&(this.speechLang=a,this.speechVoice=r,window.speechSynthesis.onvoiceschanged=null,this.engineType=n)}),this.engineType=r,this.ttsItems={}}play(e){try{void 0!==this.ttsItems[e]?this.ttsItems[e].play():this.playTTS(e)}catch(e){console.log("Exception performing TTS",e)}}playTTS(e){switch(this.engineType){case n:this.playSpeechTTS(e);break;case r:this.playGoogleTTS(e)}}playSpeechTTS(e){this.ttsItems[e]=new s(e,this.speechLang,this.speechVoice),this.ttsItems[e].play()}playGoogleTTS(e){this.ttsItems[e]=new o(e,this.googleTTSLang),this.ttsItems[e].play()}}},,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t);var n=a(2);a(16);class r{constructor(e){}}var i=a(5),s=a(3);class o{static cloneData(e,t=["options","party"]){let a;a=Array.isArray(e)?[]:{};for(let n in e)t.includes(n)||("object"==typeof e[n]?a[n]=o._cloneData(e[n]):a[n]=e[n]);return a}static _cloneData(e){if("object"==typeof e){if(Array.isArray(e)){let t=[];for(let a=0;a<e.length;++a)t[a]=o._cloneData(e[a]);return t}if(null===e)return null;if(e instanceof RegExp)return new RegExp(e);let t={};for(let a in e)t[a]=o._cloneData(e[a]);return t}return e}static timeToString(e,t=!0){let a=e<0?"-":"",n=("00"+(e=Math.abs(e))%1e3).substr(-3),r=("0"+(e%6e4-n)/1e3).substr(-2);return a+("0"+((e%36e5-n)/1e3-r)/60).substr(-2)+":"+r+(t?"."+n:"")}static timeToDateString(e){let t=new Date(e);return t.getFullYear()+"-"+o.zeroPad(t.getMonth()+1)+"-"+o.zeroPad(t.getDate())}static timeToTimeString(e,t=!1){let a=new Date(e),n=o.zeroPad(a.getHours())+":"+o.zeroPad(a.getMinutes())+":"+o.zeroPad(a.getSeconds());return t&&(n=n+"."+o.zeroPad(a.getMilliseconds(),3)),n}static msToDuration(e){return o.timeToString(e,!1).replace(":","m")+"s"}static dateTimeToString(e,t=!1){let a=new Date(e),n=a.getFullYear()+"-"+o.zeroPad(a.getMonth()+1)+"-"+o.zeroPad(a.getDate());return n=n+" "+o.zeroPad(a.getHours())+":"+o.zeroPad(a.getMinutes())+":"+o.zeroPad(a.getSeconds()),t&&(n=n+"."+a.getMilliseconds()),n}static zeroPad(e,t=2){return(""+e).padStart(t,"0")}static properCase(e){return e.replace(/([^\W_]+[^\s-]*) */g,e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())}static spacePadLeft(e,t){return e.padStart(t," ")}}o.sealRegexes={},o.engageRegexes={},o.countdownRegexes={},o.unsealRegexes={};for(let e in i.a.areaSeal)o.sealRegexes[e]=i.a.areaSeal[e],o.engageRegexes[e]=i.a.countdownEngage[e],o.countdownRegexes[e]=i.a.countdownStart[e],o.unsealRegexes[e]=i.a.areaUnseal[e];o.wipeRegex=s.a.network6d({command:"40000010"}),o.winRegex=s.a.network6d({command:"40000003"}),o.cactbotWipeRegex=s.a.echo({line:"cactbot wipe.*?"});class l{constructor(){this.listeners={}}on(e,t,a){let n=e.split(" "),r={};a=void 0!==a?a:window;for(let e of n)this.listeners[e]=this.listeners[e]||[],void 0!==t?this.listeners[e].push({scope:a,callback:t}):r[e]=this.listeners[e];return 1===n.length&&r[e]?r[e]:void 0!==t?r:void 0}async dispatch(e,...t){if(void 0!==this.listeners[e])for(let a=0;a<this.listeners[e].length;++a){let n=this.listeners[e][a],r=n.callback.apply(n.scope,t);Promise.resolve(r)===r&&await r}}}class d{constructor(e,t,a,n=!0,r=!0){if(!d.validDirections.includes(t))throw new Error("Invalid direction for tooltip: "+t);"string"==typeof e&&(e=document.querySelector(e)),this.offset={x:0,y:0},this.target=e,this.direction=t,this.tooltip=document.getElementById(t+"TooltipTemplate").content.firstElementChild.cloneNode(!0),this.setText(a),document.body.append(this.tooltip),n&&d.showEvents.forEach(t=>{e.addEventListener(t,()=>{this.show()})}),r&&d.hideEvents.forEach(t=>{e.addEventListener(t,()=>{this.hide()})})}setText(e){this.tooltip.querySelector(".tooltip-inner").textContent=e}show(){let e=this.target.getBoundingClientRect(),t=e.x+e.width/2,a=e.y+e.height/2,n=this.tooltip.getBoundingClientRect(),r=n.height/2-this.tooltip.querySelector(".arrow").getBoundingClientRect().height/2;switch(this.direction){case"top":this.tooltip.style.left=t-n.width/2+this.offset.x,this.tooltip.style.bottom=e.y-n.height+this.offset.y;break;case"right":this.tooltip.style.left=e.right+this.offset.x,this.tooltip.style.top=a-n.height/2+this.offset.y,this.tooltip.querySelector(".arrow").style.top=r;break;case"bottom":this.tooltip.style.left=t-n.width/2+this.offset.x,this.tooltip.style.top=e.bottom+this.offset.y;break;case"left":this.tooltip.style.left=e.left-n.width+this.offset.x,this.tooltip.style.top=a-n.height/2+this.offset.y,this.tooltip.querySelector(".arrow").style.top=r}this.tooltip.classList.add("show"),this.tooltip.setAttribute("data-show","")}hide(){this.tooltip.classList.remove("show"),this.tooltip.removeAttribute("data-show")}}d.validDirections=["top","right","bottom","left"],d.showEvents=["mouseenter","focus"],d.hideEvents=["mouseleave","blur"];class c extends l{constructor(e){super(),this.tooltips=[],this.emulator=e,this.$partyInfo=document.querySelector(".partyInfoColumn .party"),this.$triggerInfo=document.querySelector(".triggerInfoColumn"),this.$triggerHideCheckbox=document.querySelector(".triggerHideSkipped"),this.$triggerBar=document.querySelector(".playerTriggers"),this.triggerBars=[],this.latestDisplayedState=0,this.displayedParty={},this.currentPerspective=null;for(let e=0;e<8;++e)this.triggerBars[e]=this.$triggerBar.querySelector(".player"+e);e.on("tick",(t,a)=>{a&&(this.updatePartyInfo(e,a),this.latestDisplayedState=Math.max(this.latestDisplayedState,a))}),e.on("currentEncounterChanged",e=>{this.resetPartyInfo(e)}),e.on("preSeek",e=>{this.latestDisplayedState=0}),e.on("postSeek",t=>{this.updatePartyInfo(e,t),this.latestDisplayedState=Math.max(this.latestDisplayedState,t)}),this.updateTriggerState=()=>{this.$triggerHideCheckbox.checked?this.hideNonExecutedTriggers():this.showNonExecutedTriggers()},this.$triggerHideCheckbox.addEventListener("change",this.updateTriggerState),this.$triggerItemTemplate=document.querySelector("template.triggerItem").content.firstElementChild,this.$playerInfoRowTemplate=document.querySelector("template.playerInfoRow").content.firstElementChild,this.$playerTriggerInfoTemplate=document.querySelector("template.playerTriggerInfo").content.firstElementChild,this.$jsonViewerTemplate=document.querySelector("template.jsonViewer").content.firstElementChild,this.$triggerLabelTemplate=document.querySelector("template.triggerLabel").content.firstElementChild,this.$wrapCollapseTemplate=document.querySelector("template.wrapCollapse").content.firstElementChild}hideNonExecutedTriggers(){this.$triggerInfo.querySelectorAll(".trigger-not-executed").forEach(e=>{e.classList.add("d-none")})}showNonExecutedTriggers(){this.$triggerInfo.querySelectorAll(".trigger-not-executed").forEach(e=>{e.classList.remove("d-none")})}updatePartyInfo(e,t){for(let a in this.displayedParty)this.updateCombatantInfo(e.currentEncounter,a,t)}resetPartyInfo(e){this.tooltips.map(e=>(e.tooltip.remove(),null)),this.tooltips=[],this.currentPerspective=null,this.displayedParty={},this.latestDisplayedState=0,this.$partyInfo.innerHTML="",this.$triggerBar.querySelectorAll(".triggerItem").forEach(e=>{e.remove()});let t=e.encounter.combatantTracker.partyMembers.sort((t,a)=>{let n=e.encounter.combatantTracker.combatants[t],r=e.encounter.combatantTracker.combatants[a];return c.jobOrder.indexOf(n.job)-c.jobOrder.indexOf(r.job)}).slice(0,8);document.querySelectorAll(".playerTriggerInfo").forEach(e=>{e.remove()});for(let a=0;a<t.length;++a){let r=t[a],i=this.getPartyInfoObjectFor(e,r);this.displayedParty[r]=i,this.updateCombatantInfo(e,r),this.$partyInfo.append(i.$rootElem),this.$triggerInfo.append(i.$triggerElem),this.triggerBars[a].classList.remove("tank"),this.triggerBars[a].classList.remove("healer"),this.triggerBars[a].classList.remove("dps"),e.encounter.combatantTracker.combatants[r].job&&this.triggerBars[a].classList.add(n.a.jobToRole(e.encounter.combatantTracker.combatants[r].job));for(let t in e.perspectives[r].triggers){let n=e.perspectives[r].triggers[t];if(!n.status.executed||n.resolvedOffset>e.encounter.duration)continue;let i=this.$triggerItemTemplate.cloneNode(!0);i.style.left=n.resolvedOffset/e.encounter.duration*100+"%",this.tooltips.push(new d(i,"bottom",n.triggerHelper.trigger.id)),this.triggerBars[a].append(i)}}this.updateTriggerState(),this.selectPerspective(t[0])}selectPerspective(e){e!==this.currentPerspective&&this.emulator.currentEncounter.encounter.combatantTracker.combatants[e].job&&(this.currentPerspective=e,this.$triggerInfo.querySelectorAll(".playerTriggerInfo").forEach(e=>e.classList.add("d-none")),this.displayedParty[e].$triggerElem.classList.remove("d-none"),this.$partyInfo.querySelectorAll(".playerInfoRow").forEach(e=>{e.classList.remove("border"),e.classList.remove("border-success")}),this.displayedParty[e].$rootElem.classList.add("border"),this.displayedParty[e].$rootElem.classList.add("border-success"),this.dispatch("selectPerspective",e))}updateCombatantInfo(e,t,a=null){if(a<=this.latestDisplayedState)return;let n=e.encounter.combatantTracker.combatants[t];if(!n)return;a=a||n.getState(0);let r=n.getState(a);if(void 0===r)return;let i=r.HP/r.maxHP*100,s=r.HP+"/"+r.maxHP;s=o.spacePadLeft(s,2*r.maxHP.toString().length+1),this.displayedParty[t].$hpProgElem.ariaValueNow=r.HP,this.displayedParty[t].$hpProgElem.ariaValueMax=r.maxHP,this.displayedParty[t].$hpProgElem.style.width=i+"%",this.displayedParty[t].$hpLabelElem.textContent=s;let l=r.MP/r.maxMP*100,d=r.MP+"/"+r.maxMP;d=o.spacePadLeft(d,2*r.maxMP.toString().length+1),this.displayedParty[t].$mpProgElem.ariaValueNow=r.MP,this.displayedParty[t].$mpProgElem.ariaValueMax=r.maxMP,this.displayedParty[t].$mpProgElem.style.width=l+"%",this.displayedParty[t].$mpLabelElem.textContent=d}getPartyInfoObjectFor(e,t){let a=this.$playerInfoRowTemplate.cloneNode(!0),n=a.querySelector(".hp"),r=a.querySelector(".mp"),i=a.querySelector(".playerName"),s={$rootElem:a,$iconElem:a.querySelector("jobicon"),$hpElem:n,$hpLabelElem:n.querySelector(".label"),$hpProgElem:n.querySelector(".progress-bar"),$mpElem:r,$mpLabelElem:r.querySelector(".label"),$mpProgElem:r.querySelector(".progress-bar"),$nameElem:i,id:t,$triggerElem:this.getTriggerInfoObjectFor(e,t)},o=e.encounter.combatantTracker.combatants[t];return s.$rootElem.classList.add((o.job||"").toUpperCase()),this.tooltips.push(new d(s.$rootElem,"left",o.name)),i.innerHTML=o.name,s.$rootElem.addEventListener("click",e=>{this.selectPerspective(t)}),s.$triggerElem.setAttribute("data-id",t),s}getTriggerInfoObjectFor(e,t){let a=this.$playerTriggerInfoTemplate.cloneNode(!0),n=a.querySelector(".d-flex.flex-column"),r=e.perspectives[t],i=this.$jsonViewerTemplate.cloneNode(!0);i.textContent=JSON.stringify(r.initialData,null,2),n.append(this._wrapCollapse("Initial Data",i,()=>{i.textContent=JSON.stringify(r.initialData,null,2)}));let s=n.querySelector(".d-flex.flex-column");for(let e in r.triggers.sort((e,t)=>e.resolvedOffset-t.resolvedOffset)){let t=this.$jsonViewerTemplate.cloneNode(!0),a=this.getTriggerFiredLabelTime(r.triggers[e])+" - "+r.triggers[e].triggerHelper.trigger.id,n=this._wrapCollapse(a,t,()=>{t.textContent=JSON.stringify(r.triggers[e],null,2)}),i=n.querySelector(".wrap-collapse-button"),o=this.$triggerLabelTemplate.cloneNode(!0),l=o.querySelector(".trigger-label-text"),d=o.querySelector(".trigger-label-time");l.textContent=this.getTriggerLabelText(r.triggers[e]),d.textContent=this.getTriggerResolvedLabelTime(r.triggers[e]),i.append(o),r.triggers[e].status.executed?n.classList.add("trigger-executed"):n.classList.add("trigger-not-executed"),s.append(n)}n.append(s);let o=this.$jsonViewerTemplate.cloneNode(!0);return o.textContent=JSON.stringify(r.finalData,null,2),n.append(this._wrapCollapse("Final Data",o,()=>{o.textContent=JSON.stringify(r.finalData,null,2)})),a}getTriggerLabelText(e){let t=e.status.result||e.status.response;return"object"==typeof t?t=e.triggerHelper.valueOrFunction(t):"boolean"==typeof t||void 0===t?t="":"string"!=typeof t&&(t="Invalid Result?"),t}getTriggerFiredLabelTime(e){return o.timeToString(e.logLine.offset-this.emulator.currentEncounter.encounter.initialOffset,!1)}getTriggerResolvedLabelTime(e){return o.timeToString(e.resolvedOffset-this.emulator.currentEncounter.encounter.initialOffset,!1)}_wrapCollapse(e,t,a){let n=this.$wrapCollapseTemplate.cloneNode(!0),r=n.querySelector(".btn");r.textContent=e;let i=n.querySelector(".wrap-collapse-wrapper");return r.addEventListener("click",()=>{i.classList.contains("d-none")?i.classList.remove("d-none"):i.classList.add("d-none"),a&&a()}),i.append(t),n}}c.jobOrder=["PLD","WAR","DRK","GNB","WHM","SCH","AST","MNK","DRG","NIN","SAM","BRD","MCH","DNC","BLM","SMN","RDM","BLU"];class u{constructor(e,t){this.id=e,this.name="",this.server="",this.setName(t),this.states={},this.significantStates=[],this.latestTimestamp=null,this.job=null,this.level=null}setName(e){if(""===e)return;let t=e.split("(");this.name=t[0],t.length>1&&(this.server=t[1].replace(/\)$/,""))}hasState(e){return void 0!==this.states[e]}pushState(e,t){this.states[e]=t,this.latestTimestamp=e,this.significantStates.includes(e)||this.significantStates.push(e)}nextSignificantState(e){let t=this.significantStates.indexOf(e),a=this.significantStates.length-1;if(t>=0&&t<a)return this.states[this.significantStates[t+1]];if(t===a||e>this.significantStates[a])return this.states[this.significantStates[a]];for(let t=0;t<this.significantStates.length;++t)if(this.significantStates[t]>e)return this.states[this.significantStates[t]];return this.states[this.significantStates[this.significantStates.length-1]]}pushPartialState(e,t){void 0!==this.states[e]?Object.keys(this.states[e]).filter(e=>void 0!==t[e]).forEach(a=>{this.states[e][a]="Visible"===a?t[a]:Number(t[a])}):(this.states[e]=this.states[this.latestTimestamp].partialClone(t),this.latestTimestamp=Math.max(this.latestTimestamp,e));let a=this.significantStates[this.significantStates.length-1],n=JSON.stringify(this.states[a]),r=JSON.stringify(this.states[e]);a!==e&&r!==n&&this.significantStates.push(e)}getState(e){if(void 0!==this.states[e])return this.states[e];if(e<this.significantStates[0])return this.states[this.significantStates[0]];let t=0;for(;t<this.significantStates.length;++t)if(this.significantStates[t]>e)return this.states[this.significantStates[t-1]];return this.states[this.significantStates[t-1]]}}class h{static getJob(e){if(!h.abilityMatchRegex.test(e))return null;e=Number("0x"+e);for(let t in h.abilities)if(h.abilities[t].includes(e))return t;return null}}h.abilities={PLD:[12959,12961,12964,12967,12968,12969,12970,12971,12972,12973,12974,12975,12976,12978,12980,12981,12982,12983,12984,12985,12986,12987,12988,12989,12991,12992,12993,12994,12996,13e3,13001,13006,14480,16457,16458,16459,16460,16461,17669,17671,17672,17691,17692,17693,17694,17866,18050,27,29,30,3538,3539,3540,3541,3542,4284,4285,4286,50207,50209,50246,50260,50261,50262,50263,50264,7382,7383,7384,7385,8746,8749,8750,8751,8752,8754,8755,8756],WAR:[16462,16463,16464,16465,17695,17696,17697,17698,17889,3549,3550,3551,3552,4289,4290,4291,49,50157,50218,50249,50265,50266,50267,50268,50269,51,52,7386,7387,7388,7389,8758,8761,8762,8763,8764,8765,8767,8768],DRK:[16466,16467,16468,16469,16470,16471,16472,17700,17701,17702,3617,3621,3623,3624,3625,3629,3632,3634,3636,3638,3639,3640,3641,3643,4303,4304,4305,4306,4307,4308,4309,4310,4311,4312,4680,50158,50159,50271,50272,50319,7390,7391,7392,7393,8769,8772,8773,8775,8776,8777,8778,8779],GNB:[17703,17704,17705,17706,17707,17708,17709,17710,17711,17712,17713,17714,17716,17717,17890,17891,16137,50320,16138,16139,16140,16141,16142,16143,16144,16145,16162,50257,16148,16149,16151,16152,50258,16153,16154,16146,16147,16150,16159,16160,16161,16155,16156,16157,16158,16163,16164,16165,50259],WHM:[12958,12962,12965,12997,13002,13003,13004,13005,131,136,137,139,140,14481,1584,16531,16532,16533,16534,16535,16536,17688,17689,17690,17789,17790,17791,17793,17794,17832,3568,3569,3570,3571,4296,4297,50181,50182,50196,50307,50308,50309,50310,7430,7431,7432,7433,8895,8896,8900,9621,127,133],SCH:[16537,16538,16539,16540,16541,16542,16543,16544,16545,16546,16547,16548,16550,16551,166,167,17215,17216,17795,17796,17797,17798,17802,17864,17865,17869,17870,17990,185,186,188,189,190,3583,3584,3585,3586,3587,4300,50184,50214,50311,50312,50313,50324,7434,7435,7436,7437,7438,7869,802,803,805,8904,8905,8909,9622],AST:[10027,10028,10029,16552,16553,16554,16555,16556,16557,16558,16559,17055,17151,17152,17804,17805,17806,17807,17809,17991,3590,3593,3594,3595,3596,3598,3599,3600,3601,3603,3604,3605,3606,3608,3610,3612,3613,3614,3615,4301,4302,4401,4402,4403,4404,4405,4406,4677,4678,4679,50122,50124,50125,50186,50187,50188,50189,50314,50315,50316,7439,7440,7441,7442,7443,7444,7445,7448,8324,8913,8914,8916,9629],MNK:[12960,12963,12966,12977,12979,12990,12995,12998,12999,14476,14478,16473,16474,16475,16476,17674,17675,17676,17677,17719,17720,17721,17722,17723,17724,17725,17726,3543,3545,3546,3547,4262,4287,4288,50160,50161,50245,50273,50274,63,70,71,7394,7395,7396,74,8780,8781,8782,8783,8784,8785,8787,8789,8925],DRG:[16477,16478,16479,16480,17728,17729,3553,3554,3555,3556,3557,4292,4293,50162,50163,50247,50275,50276,7397,7398,7399,7400,86,8791,8792,8793,8794,8795,8796,8797,8798,8799,8802,8803,8804,8805,8806,92,94,95,96,9640,75,78],NIN:[16488,16489,16491,16492,16493,17413,17414,17415,17416,17417,17418,17419,17420,17732,17733,17734,17735,17736,17737,17738,17739,2246,2259,2260,2261,2262,2263,2264,2265,2266,2267,2268,2269,2270,2271,2272,3563,3566,4295,50165,50166,50167,50250,50279,50280,7401,7402,7403,8807,8808,8809,8810,8812,8814,8815,8816,8820,9461],SAM:[16481,16482,16483,16484,16485,16486,16487,17740,17741,17742,17743,17744,50208,50215,50277,50278,7477,7478,7479,7480,7481,7482,7483,7484,7485,7486,7487,7488,7489,7490,7491,7492,7493,7494,7495,7496,7497,7498,7499,7501,7502,7855,7857,7867,8821,8822,8823,8824,8825,8826,8828,8829,8830,8831,8833],BRD:[10023,114,116,117,118,13007,14479,16494,16495,16496,17678,17679,17680,17681,17682,17745,17747,3558,3559,3560,3561,3562,4294,50168,50169,50282,50283,50284,50285,50286,50287,7404,7405,7406,7407,7408,7409,8836,8837,8838,8839,8841,8842,8843,8844,9625,106],MCH:[16497,16498,16499,16500,16501,16502,16503,16504,16766,16889,17206,17209,17749,17750,17751,17752,17753,17754,2864,2866,2868,2870,2872,2873,2874,2876,2878,2890,4276,4675,4676,50117,50119,50288,50289,50290,50291,50292,50293,50294,7410,7411,7412,7413,7414,7415,7416,7418,8848,8849,8850,8851,8853,8855],DNC:[17756,17757,17758,17759,17760,17761,17762,17763,17764,17765,17766,17767,17768,17769,17770,17771,17772,17773,17824,17825,17826,17827,17828,17829,18076,15989,15990,15993,15997,15999,16e3,16001,16002,16003,16191,16192,15991,15994,16007,50252,15995,15992,15996,16008,16010,50251,16015,16012,16006,18073,50253,16011,16009,50254,15998,16004,16193,16194,16195,16196,16013,16005,50255,50256,16014],BLM:[14477,153,154,158,159,162,16505,16506,16507,17683,17684,17685,17686,17687,17774,17775,3573,3574,3575,3576,3577,4298,50171,50172,50173,50174,50295,50296,50297,50321,50322,7419,7420,7421,7422,8858,8859,8860,8861,8862,8863,8864,8865,8866,8867,8869,9637,149,155,141,152],SMN:[16510,16511,16513,16514,16515,16516,16517,16518,16519,16522,16523,16549,16795,16796,16797,16798,16799,16800,16801,16802,16803,17777,17778,17779,17780,17781,17782,17783,17784,17785,180,184,3578,3579,3580,3581,3582,4299,50176,50177,50178,50213,50217,50298,50299,50300,50301,50302,7423,7424,7425,7426,7427,7428,7429,7449,7450,787,788,791,792,794,796,797,798,800,801,8872,8873,8874,8877,8878,8879,8880,8881,9014,9432],RDM:[10025,16524,16525,16526,16527,16528,16529,16530,17786,17787,17788,50195,50200,50201,50216,50303,50304,50305,50306,7503,7504,7505,7506,7507,7509,7510,7511,7512,7513,7514,7515,7516,7517,7518,7519,7520,7521,7523,7524,7525,7526,7527,7528,7529,7530,8882,8883,8884,8885,8887,8888,8889,8890,8891,8892,9433,9434],BLU:[11715,11383,11384,11385,11386,11387,11388,11389,11390,11391,11392,11393,11394,11395,11396,11397,11398,11399,11400,11401,11402,11403,11404,11405,11406,11407,11408,11409,11410,11411,11412,11413,11414,11415,11416,11417,11418,11419,11420,11421,11422,11423,11424,11425,11426,11427,11428,11429,11430,11431,50219,50220,50221,50222,50223,50224]},h.abilityMatchRegex=/[a-fA-F0-9]{1,4}/i;class p{constructor(e,t,a,n,r,i,s,o,l){this.posX=e,this.posY=t,this.posZ=a,this.heading=n,this.targetable=r,this.HP=i,this.maxHP=s,this.MP=o,this.maxMP=l}partialClone(e){return new p(Number(e.posX)||this.posX,Number(e.posY)||this.posY,Number(e.posZ)||this.posZ,Number(e.heading)||this.heading,e.targetable||this.targetable,Number(e.HP)||this.HP,Number(e.maxHP)||this.maxHP,Number(e.MP)||this.MP,Number(e.maxMP)||this.maxMP)}}var m={cn:["绿宝石兽","黄宝石兽","伊弗利特之灵","泰坦之灵","迦楼罗之灵","朝日小仙女","夕月小仙女","车式浮空炮塔","象式浮空炮塔","亚灵神巴哈姆特","亚灵神不死鸟","炽天使","月长宝石兽","英雄的掠影","后式自走人偶","分身"],de:["Smaragd-Karfunkel","Topas-Karfunkel","Ifrit-Egi","Titan-Egi","Garuda-Egi","Eos","Selene","Selbstschuss-Gyrocopter TURM","Selbstschuss-Gyrocopter LÄUFER","Demi-Bahamut","Demi-Phönix","Seraph","Mondstein-Karfunkel","Schattenschemen","Automaton DAME","Gedoppeltes Ich"],en:["Emerald Carbuncle","Topaz Carbuncle","Ifrit-Egi","Titan-Egi","Garuda-Egi","Eos","Selene","Rook Autoturret","Bishop Autoturret","Demi-Bahamut","Demi-Phoenix","Seraph","Moonstone Carbuncle","Esteem","Automaton Queen","Bunshin"],fr:["Carbuncle émeraude","Carbuncle topaze","Ifrit-Egi","Titan-Egi","Garuda-Egi","Eos","Selene","Auto-tourelle Tour","Auto-tourelle Fou","Demi-Bahamut","Demi-Phénix","Séraphin","Carbuncle hécatolite","Estime","Automate Reine","Ombre"],ja:["カーバンクル・エメラルド","カーバンクル・トパーズ","イフリート・エギ","タイタン・エギ","ガルーダ・エギ","フェアリー・エオス","フェアリー・セレネ","オートタレット・ルーク","オートタレット・ビショップ","デミ・バハムート","デミ・フェニックス","セラフィム","カーバンクル・ムーンストーン","英雄の影身","オートマトン・クイーン","分身"],ko:["카벙클 에메랄드","카벙클 토파즈","이프리트 에기","타이탄 에기","가루다 에기","요정 에오스","요정 셀레네","자동포탑 룩","자동포탑 비숍","데미바하무트","데미피닉스","세라핌","카벙클 문스톤","영웅의 환영","자동인형 퀸","분신"]};class g{constructor(e,t){this.language=t,this.firstTimestamp=Number.MAX_SAFE_INTEGER,this.lastTimestamp=0,this.combatants={},this.partyMembers=[],this.enemies=[],this.others=[],this.pets=[],this.mainCombatantID=null,this.initialStates={},this.initialize(e),delete this.initialStates}initialize(e){let t={};for(let a=0;a<e.length;++a){const n=e[a];switch(this.firstTimestamp=Math.min(this.firstTimestamp,n.timestamp),this.lastTimestamp=Math.max(this.lastTimestamp,n.timestamp),t[n.timestamp+"_"+a]=n,n.hexEvent){case"14":case"15":case"16":case"19":case"1A":case"1B":case"1E":case"22":case"23":this.addCombatantFromLine(n),this.addCombatantFromTargetLine(n);break;default:this.addCombatantFromLine(n)}}let a=Object.keys(t).sort();for(let e in this.initialStates){let t=this.initialStates[e];this.combatants[e].pushState(this.firstTimestamp,new p(Number(t.posX),Number(t.posY),Number(t.posZ),Number(t.heading),t.targetable,Number(t.HP),Number(t.maxHP),Number(t.MP),Number(t.maxMP)))}let n={};for(let e=0;e<a.length;++e){let r=t[a[e]],i=this.extractStateFromLine(r);i&&(n[r.id]=n[r.id]||0,++n[r.id],this.combatants[r.id].pushPartialState(r.timestamp,i)),i=this.extractStateFromTargetLine(r),i&&(n[r.targetId]=n[r.targetId]||0,++n[r.targetId],this.combatants[r.targetId].pushPartialState(r.timestamp,i))}let r=m[this.language];this.others=this.others.filter(e=>null!==this.combatants[e].job&&"NONE"!==this.combatants[e].job&&e.startsWith("1")?(this.partyMembers.push(e),!1):r.includes(this.combatants[e].name)?(this.pets.push(e),!1):!(n[e]>0)||(this.enemies.push(e),!1)),this.mainCombatantID=this.enemies.sort((e,t)=>n[t]-n[e])[0]||null}addCombatantFromLine(e){if(!e.id)return;this.initCombatant(e.id,e.name,e.timestamp);let t=this.initialStates[e.id],a=this.extractStateFromLine(e);t.timestamp=Math.min(t.timestamp,e.timestamp),t.posX=t.posX||a.posX||null,t.posY=t.posY||a.posY||null,t.posZ=t.posZ||a.posZ||null,t.heading=t.heading||a.heading||null,t.targetable=t.targetable||a.targetable||!1,t.HP=t.HP||a.HP||null,t.maxHP=t.maxHP||a.maxHP||null,t.MP=t.MP||a.MP||null,t.maxMP=t.maxMP||a.maxMP||null,this.combatants[e.id].job=this.combatants[e.id].job||a.job||null,this.combatants[e.id].level=this.combatants[e.id].level||a.level||null,!e.abilityId||this.combatants[e.id].job||e.id.startsWith("4")||(this.combatants[e.id].job=h.getJob(e.abilityId)),this.combatants[e.id].job&&(this.combatants[e.id].job=this.combatants[e.id].job.toUpperCase())}addCombatantFromTargetLine(e){if(!e.targetId)return;this.initCombatant(e.targetId,e.targetName,e.timestamp);let t=this.initialStates[e.targetId],a=this.extractStateFromTargetLine(e);t.posX=t.posX||a.posX||null,t.posY=t.posY||a.posY||null,t.posZ=t.posZ||a.posZ||null,t.heading=t.heading||a.heading||null,t.HP=t.HP||a.HP||null,t.maxHP=t.maxHP||a.maxHP||null,t.MP=t.MP||a.MP||null,t.maxMP=t.maxMP||a.maxMP||null}extractStateFromLine(e){if(!e.id)return!1;let t={};return void 0!==e.x&&(t.posX=e.x),void 0!==e.y&&(t.posY=e.y),void 0!==e.z&&(t.posZ=e.z),void 0!==e.heading&&(t.heading=e.heading),void 0!==e.targetable&&(t.targetable=e.targetable),void 0!==e.hp&&(t.HP=e.hp),void 0!==e.maxHp&&(t.maxHP=e.maxHp),void 0!==e.mp&&(t.MP=e.mp),void 0!==e.maxMp&&(t.maxMP=e.maxMp),void 0!==e.jobName&&(t.job=e.jobName),void 0!==e.level&&(t.level=e.level),t}extractStateFromTargetLine(e){if(!e.targetId)return!1;let t={};return void 0!==e.targetX&&(t.posX=e.targetX),void 0!==e.targetY&&(t.posY=e.targetY),void 0!==e.targetZ&&(t.posZ=e.targetZ),void 0!==e.targetHeading&&(t.heading=e.targetHeading),void 0!==e.targetHp&&(t.HP=e.targetHp),void 0!==e.targetMaxHp&&(t.maxHP=e.targetMaxHp),void 0!==e.targetMp&&(t.MP=e.targetMp),void 0!==e.targetMaxMp&&(t.maxMP=e.targetMaxMp),t}initCombatant(e,t,a){void 0===this.combatants[e]?(this.combatants[e]=new u(e,t),this.others.push(e),this.initialStates[e]={timestamp:a,posX:null,posY:null,posZ:null,heading:null,targetable:!0,HP:null,maxHP:null,MP:null,maxMP:null}):""===this.combatants[e].name&&(this.combatants[e].name=t)}getMainCombatantName(){return this.mainCombatantID?this.combatants[this.mainCombatantID].name:"Unknown"}}class f extends l{static doesLineMatch(e,t){for(let a in t){let n=t[a].exec(e);if(n)return i.a.areaSeal[a]&&(n.groups.language=a),n}return!1}static isMatchStart(e){let t;return t=f.doesLineMatch(e,o.countdownRegexes),t?(t.groups.StartIn=1e3*t.groups.time,t.groups.StartType="Countdown",t):(t=f.doesLineMatch(e,o.sealRegexes),t?(t.groups.StartIn=0,t.groups.StartType="Seal",t):(t=f.doesLineMatch(e,o.engageRegexes),!!t&&(t.groups.StartIn=0,t.groups.StartType="Engage",t)))}static isMatchEnd(e){let t;return t=f.doesLineMatch(e,[o.winRegex]),t?(t.groups.EndType="Win",t):(t=f.doesLineMatch(e,[o.wipeRegex]),t?(t.groups.EndType="Wipe",t):(t=f.doesLineMatch(e,[o.cactbotWipeRegex]),t?(t.groups.EndType="Cactbot Wipe",t):(t=f.doesLineMatch(e,o.unsealRegexes),!!t&&(t.groups.EndType="Unseal",t))))}constructor(){super(),this.currentZoneName=null,this.currentFight=[],this.currentZoneId=-1}parseLogs(e){for(let t=0;t<e.length;++t){let a=e[t];this.currentFight.push(a),a.offset=a.timestamp-this.currentFight[0].timestamp,f.isMatchEnd(a.networkLine)?this.endFight():a.zoneName&&(this.currentZoneId=a.zoneId,this.currentZoneName=a.zoneName,this.endFight())}}endFight(){if(this.currentFight.length<2)return;let e=new Date(this.currentFight[0].timestamp);this.currentZoneName=this.currentZoneName||"Unknown",this.currentZoneId=this.currentZoneId||-1,console.debug(`Dispatching new fight\nStart: ${e}\nEnd: ${new Date(this.currentFight[this.currentFight.length-1].timestamp)}\nZone: ${this.currentZoneName}\nLine Count: ${this.currentFight.length}\n`),this.dispatch("fight",e.toISOString().substr(0,10),this.currentZoneId,this.currentZoneName,this.currentFight),this.currentFight=[]}}class T{constructor(e,t,a,n){this.id=null,this.encounterZoneId=t,this.encounterZoneName=a,this.encounterDay=e,this.logLines=n,this.initialize()}initialize(){this.language="en",this.initialOffset=Number.MAX_SAFE_INTEGER,this.endStatus="Unknown",this.startStatus=new Set,this.engageAt=Number.MAX_SAFE_INTEGER,this.firstPlayerAbility=Number.MAX_SAFE_INTEGER,this.firstEnemyAbility=Number.MAX_SAFE_INTEGER;let e=m[this.language];this.firstLineIndex=0;for(let t=0;t<this.logLines.length;++t){let a=this.logLines[t],n=f.isMatchStart(a.networkLine);n?(this.firstLineIndex=t,this.startStatus.add(n.groups.StartType),n.groups.StartIn>=0&&(this.engageAt=Math.min(a.timestamp+n.groups.StartIn,this.engageAt))):(n=f.isMatchEnd(a.networkLine),n?this.endStatus=n.groups.EndType:a.id&&a.targetId&&(a.id.startsWith("1")||a.id.startsWith("4")&&e.includes(a.name)?a.targetId.startsWith("4")&&!e.includes(a.targetName)&&(this.firstPlayerAbility=Math.min(this.firstPlayerAbility,a.timestamp)):a.id.startsWith("4")&&!e.includes(a.name)&&(a.targetId.startsWith("1")||e.includes(a.targetName))&&(this.firstEnemyAbility=Math.min(this.firstEnemyAbility,a.timestamp)))),n&&n.groups&&n.groups.language&&(this.language=n.groups.language||this.language)}this.firstPlayerAbility===Number.MAX_SAFE_INTEGER&&(this.firstPlayerAbility=null),this.firstEnemyAbility===Number.MAX_SAFE_INTEGER&&(this.firstEnemyAbility=null),this.engageAt===Number.MAX_SAFE_INTEGER&&(this.engageAt=null),this.combatantTracker=new g(this.logLines,this.language),this.startTimestamp=this.combatantTracker.firstTimestamp,this.endTimestamp=this.combatantTracker.lastTimestamp,this.duration=this.endTimestamp-this.startTimestamp,this.initialOffset===Number.MAX_SAFE_INTEGER&&(null!==this.engageAt?this.initialOffset=this.engageAt-this.startTimestamp:null!==this.firstPlayerAbility?this.initialOffset=this.firstPlayerAbility-this.startTimestamp:null!==this.firstEnemyAbility?this.initialOffset=this.firstEnemyAbility-this.startTimestamp:this.initialOffset=0),this.playbackOffset=this.logLines[this.firstLineIndex].offset,this.startStatus=[...this.startStatus].sort().join(", ")}}class y extends l{constructor(e){super(),this.persistor=e,this.$zoneColumn=document.querySelector("#encountersTab .zoneList"),this.$dateColumn=document.querySelector("#encountersTab .dateList"),this.$encounterColumn=document.querySelector("#encountersTab .encounterList"),this.$infoColumn=document.querySelector("#encountersTab .encounterInfo"),this.$encounterTabRowTemplate=document.querySelector("template.encounterTabRow").content.firstElementChild,this.$encounterTabEncounterRowTemplate=document.querySelector("template.encounterTabEncounterRow").content.firstElementChild,this.$encounterInfoTemplate=document.querySelector("template.encounterInfo").content.firstElementChild}refresh(){this.encounters={},this.persistor.listEncounters().then(e=>{for(let t in e){let a=e[t],n=a.zoneName,r=o.timeToDateString(a.start),i=o.timeToTimeString(a.start),s=o.msToDuration(a.duration);this.encounters[n]=this.encounters[n]||{},this.encounters[n][r]=this.encounters[n][r]||[],this.encounters[n][r].push({start:i,name:a.name,duration:s,encounter:a})}this.refreshUI()})}refreshUI(){this.refreshZones(),this.refreshDates(),this.refreshEncounters(),this.refreshInfo()}refreshZones(){this.$zoneColumn.innerHTML="";let e=!0,t=new Set(Object.keys(this.encounters));for(let a of[...t].sort()){let t=this.$encounterTabRowTemplate.cloneNode(!0);t.innerText=a,a===this.currentZone&&(e=!1,t.classList.add("selected")),t.addEventListener("click",e=>{let t=e.currentTarget;t.parentElement.querySelectorAll(".selectorRow.selected").forEach(e=>{e.classList.remove("selected")}),t.classList.add("selected"),this.currentZone=t.textContent,this.refreshUI()}),this.$zoneColumn.append(t)}e&&(this.currentZone=void 0)}refreshDates(){this.$dateColumn.innerHTML="";let e=!0;if(void 0!==this.currentZone){let t=new Set(Object.keys(this.encounters[this.currentZone]));for(let a of[...t].sort()){let t=this.$encounterTabRowTemplate.cloneNode(!0);t.innerText=a,a===this.currentDate&&(e=!1,t.classList.add("selected")),t.addEventListener("click",e=>{let t=e.currentTarget;t.parentElement.querySelectorAll(".selectorRow.selected").forEach(e=>{e.classList.remove("selected")}),t.classList.add("selected"),this.currentDate=t.textContent,this.refreshUI()}),this.$dateColumn.append(t)}}e&&(this.currentDate=void 0)}refreshEncounters(){this.$encounterColumn.innerHTML="";let e=!0;if(void 0!==this.currentZone&&void 0!==this.currentDate){let t=this.encounters[this.currentZone][this.currentDate].sort((e,t)=>e.start.localeCompare(t.start));for(let a in t){let t=this.encounters[this.currentZone][this.currentDate][a],n=this.$encounterTabEncounterRowTemplate.cloneNode(!0);n.setAttribute("data-index",a),a===this.currentEncounter&&(e=!1,n.classList.add("selected")),n.querySelector(".encounterStart").innerText="["+t.start+"]",n.querySelector(".encounterName").innerText=t.name,n.querySelector(".encounterDuration").innerText="("+t.duration+")",n.addEventListener("click",e=>{let t=e.currentTarget;t.parentElement.querySelectorAll(".selectorRow.selected").forEach(e=>{e.classList.remove("selected")}),t.classList.add("selected"),this.currentEncounter=t.getAttribute("data-index"),this.refreshUI()}),this.$encounterColumn.append(n)}}e&&(this.currentEncounter=void 0)}refreshInfo(){if(this.$infoColumn.innerHTML="",void 0!==this.currentZone&&void 0!==this.currentDate&&void 0!==this.currentEncounter){let e=this.encounters[this.currentZone][this.currentDate][this.currentEncounter].encounter,t="N/A";isNaN(e.offset)||(t=o.timeToString(e.offset,!1));let a=this.$encounterInfoTemplate.cloneNode(!0);a.querySelector(".encounterLoad").addEventListener("click",()=>{this.dispatch("load",this.encounters[this.currentZone][this.currentDate][this.currentEncounter].encounter.id)}),a.querySelector(".encounterParse").addEventListener("click",()=>{this.dispatch("parse",this.encounters[this.currentZone][this.currentDate][this.currentEncounter].encounter.id)}),a.querySelector(".encounterPrune").addEventListener("click",()=>{this.dispatch("prune",this.encounters[this.currentZone][this.currentDate][this.currentEncounter].encounter.id)}),a.querySelector(".encounterDelete").addEventListener("click",()=>{this.dispatch("delete",this.encounters[this.currentZone][this.currentDate][this.currentEncounter].encounter.id)}),a.querySelector(".encounterZone .label").textContent=e.zoneName,a.querySelector(".encounterStart .label").textContent=o.dateTimeToString(e.start),a.querySelector(".encounterDuration .label").textContent=o.timeToString(e.duration,!1),a.querySelector(".encounterOffset .label").textContent=t,a.querySelector(".encounterName .label").textContent=e.name,a.querySelector(".encounterStartStatus .label").textContent=e.startStatus,a.querySelector(".encounterEndStatus .label").textContent=e.endStatus,this.$infoColumn.append(a)}}}class b{constructor(){this.Combatants={},this.firstTimestamp=Number.MAX_SAFE_INTEGER}updateTimestamp(e){this.firstTimestamp=Math.min(this.firstTimestamp,e)}updateCombatant(e,t={name:void 0,job:void 0,spawn:void 0,despawn:void 0}){if((e=e.toUpperCase())&&e.length){let a=this.Combatants[e];void 0===a?(a={name:t.name,job:t.job,spawn:t.spawn,despawn:t.despawn},this.Combatants[e]=a):(a.name=t.name||a.name,a.job=t.job||a.job,a.spawn=Math.min(a.spawn,t.spawn),a.despawn=Math.max(a.despawn,t.despawn))}}resolveName(e,t,a=null,n=null){let r=t;return null!==a&&"E0000000"===e&&""===r&&(r=a.startsWith("4")?n:"Unknown"),""===r&&(r=this.Combatants[e].name),r}}class S{constructor(e,t,a){this.offset=0,this.parts=a,this.decEvent=parseInt(this.parts[0]),this.hexEvent=o.zeroPad(this.decEvent.toString(16).toUpperCase()),this.timestamp=+new Date(this.parts[1]),this.networkLine=t,e.updateTimestamp(this.timestamp)}convert(){this.convertedLine=this.prefix()+this.parts.join(":").replace("|",":")}prefix(){return"["+o.timeToTimeString(this.timestamp,!0)+"] "+this.hexEvent+":"}static isDamageHallowed(e){return parseInt(e,16)&parseInt("1000",16)}static isDamageBig(e){return parseInt(e,16)&parseInt("4000",16)}static calculateDamage(e){if(S.isDamageHallowed(e))return 0;let t=[(e=o.zeroPad(e,8)).substr(0,2),e.substr(2,2),e.substr(4,2),e.substr(6,2)];return S.isDamageBig(e)?parseInt(t[3]+t[0]+(parseInt(t[1],16)-parseInt(t[3],16)).toString(16),16):parseInt(t.slice(0,2).reverse().join(""),16)}}class x extends S{constructor(e,t,a){super(e,t,a),this.parts.slice(4).join("|").split("").length>1&&(this.invalid=!0)}convert(){this.convertedLine=this.prefix()+this.parts[2]+":"+(""!==this.parts[3]?this.parts[3]+":":"")+this.parts.slice(4,this.parts.length-1).join("|").trim(),this.convertedLine=_.replaceChatSymbols(this.convertedLine)}static replaceChatSymbols(e){for(let t of _.chatSymbolReplacements)e=e.replace(t.Search,t.Replace);return e}}class _ extends x{}_.chatSymbolReplacements=[{Search:/:\uE06F/g,Replace:":⇒",Type:"Symbol"},{Search:/ \uE0BB\uE05C/g,Replace:" ",Type:"Positive Effect"},{Search:/ \uE0BB\uE05B/g,Replace:" ",Type:"Negative Effect"}];class v extends S{constructor(e,t,a){super(e,t,a),this.zoneId=a[2].toUpperCase(),this.zoneName=a[3],this.zoneNameProperCase=o.properCase(this.zoneName)}convert(){this.convertedLine=this.prefix()+"Changed Zone to "+this.zoneName+".",this.properCaseConvertedLine=this.prefix()+"Changed Zone to "+this.zoneNameProperCase+"."}}class E extends v{}class C extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3]}convert(){this.convertedLine=this.prefix()+"Changed primary player to "+this.name+"."}}class k extends C{}class O extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.server=a[8],this.jobIdHex=a[4].toUpperCase(),this.jobIdDec=parseInt(this.jobIdHex,16),this.jobName=n.a.jobEnumToJob(this.jobIdDec),this.level=parseInt(a[5],16),this.hp=parseInt(a[11]),this.maxHp=parseInt(a[12]),this.mp=parseInt(a[13]),this.maxMp=parseInt(a[14]),this.x=parseFloat(a[17]),this.y=parseFloat(a[18]),this.z=parseFloat(a[19]),this.heading=parseFloat(a[20]),e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp,job:this.jobIdHex})}convert(){let e=this.name;""!==this.server&&(e=e+"("+this.server+")"),this.convertedLine=this.prefix()+this.id.toUpperCase()+":Added new combatant "+e+".  Job: "+this.jobName+" Level: "+this.level+" Max HP: "+this.maxHp+" Max MP: "+this.maxMp+" Pos: ("+this.parts[17]+","+this.parts[18]+","+this.parts[19]+")";let t=this.parts[9]+o.zeroPad(this.parts[10],8+Math.max(0,6-this.parts[9].length));"00000000000000"!==t&&(this.convertedLine+=" ("+t+")"),this.convertedLine+="."}}class L extends O{}class w extends O{constructor(e,t,a){super(e,t,a)}convert(){this.convertedLine=this.prefix()+this.id.toUpperCase()+":Removing combatant "+this.name+".  Max HP: "+this.maxHp+". Pos: ("+this.parts[17]+","+this.parts[18]+","+this.parts[19]+")."}}class I extends w{}class A extends S{constructor(e,t,a){super(e,t,a)}convert(){this.convertedLine=this.prefix()+"Player Stats: "+this.parts.slice(2,this.parts.length-1).join(":").replace(/\|/g,":")}}class P extends A{}class D extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp}),this.abilityId=a[4].toUpperCase(),this.abilityName=a[5],this.targetId=a[6].toUpperCase(),this.targetName=a[7],e.updateCombatant(this.targetId,{name:this.targetName,spawn:this.timestamp,despawn:this.timestamp}),this.castTime=a[8]}convert(){let e=0===this.targetName.length?"Unknown":this.targetName;this.convertedLine=this.prefix()+this.abilityId+":"+this.name+" starts using "+this.abilityName+" on "+e+".",this.properCaseConvertedLine=this.prefix()+this.abilityId+":"+o.properCase(this.name)+" starts using "+this.abilityName+" on "+o.properCase(e)+"."}}class j extends D{}class F extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp}),this.abilityId=a[4].toUpperCase(),this.abilityName=a[5],this.targetId=a[6].toUpperCase(),this.targetName=a[7],e.updateCombatant(this.targetId,{name:this.targetName,spawn:this.timestamp,despawn:this.timestamp}),this.flags=a[8];let n=0;"3F"===this.flags&&(n=2),this.damage=S.calculateDamage(a[9+n]),this.targetHp=a[24+n],this.targetMaxHp=a[25+n],this.targetMp=a[26+n],this.targetMaxMp=a[27+n],this.targetX=a[30+n],this.targetY=a[31+n],this.targetZ=a[32+n],this.targetHeading=a[33+n],this.sourceHp=a[34+n],this.sourceMaxHp=a[35+n],this.sourceMp=a[36+n],this.sourceMaxMp=a[37+n],this.sourceX=a[40+n],this.sourceY=a[41+n],this.sourceZ=a[42+n],this.sourceHeading=a[43+n]}}class M extends F{}class R extends F{constructor(e,t,a){super(e,t,a)}}class N extends R{}class B extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.abilityId=a[4].toUpperCase(),this.abilityName=a[5]}}class U extends B{}class H extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp}),this.type=a[4],this.effectId=a[5].toUpperCase(),this.damage=parseInt(a[6],16),this.hp=parseInt(a[7]),this.maxHp=parseInt(a[8]),this.mp=parseInt(a[9]),this.maxMp=parseInt(a[10]),this.x=parseFloat(a[13]),this.y=parseFloat(a[14]),this.z=parseFloat(a[15]),this.heading=parseFloat(a[16]),this.resolvedName=e.resolveName(this.id,this.name)}convert(e){this.effectName=H.showEffectNamesFor[this.effectId.toUpperCase()];let t="";this.effectName&&(t=this.effectName+" "),this.convertedLine=this.prefix()+t+this.type+" Tick on "+this.resolvedName+" for "+this.damage+" damage.",this.properCaseConvertedLine=this.prefix()+t+this.type+" Tick on "+o.properCase(this.resolvedName)+" for "+this.damage+" damage."}}class $ extends H{}H.showEffectNamesFor={"4C4":"Excognition","35D":"Wildfire","1F5":"Doton","2ED":"Salted Earth","4B5":"Flamethrower","2E3":"Asylum",777:"Asylum",798:"Sacred Soil","4C7":"Fey Union",742:"Nascent Glint"};class z extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp}),this.targetId=a[4].toUpperCase(),this.targetName=a[5],e.updateCombatant(this.targetId,{name:this.targetName,spawn:this.timestamp,despawn:this.timestamp}),this.resolvedName=!1,"00"!==this.id&&(this.resolvedName=e.resolveName(this.id,this.name)),this.resolvedTargetName=!1,"00"!==this.targetId&&(this.resolvedTargetName=e.resolveName(this.targetId,this.targetName))}convert(){this.convertedLine=this.prefix()+this.resolvedName||this.name+" was defeated by "+this.resolvedTargetName||this.targetName+".",this.properCaseConvertedLine=this.prefix()+o.properCase(this.resolvedName||this.name)+" was defeated by "+o.properCase(this.resolvedTargetName||this.targetName)+"."}}class W extends z{}class q extends S{constructor(e,t,a){super(e,t,a),this.abilityId=a[2].toUpperCase(),this.abilityName=a[3],this.duration=parseFloat(a[4]),this.stacks=parseInt(a[9],16),this.id=a[5].toUpperCase(),this.name=a[6],e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp}),this.targetId=a[7].toUpperCase(),this.targetName=a[8],e.updateCombatant(this.targetId,{name:this.targetName,spawn:this.timestamp,despawn:this.timestamp}),this.resolvedName=e.resolveName(this.id,this.name),this.resolvedTargetName=e.resolveName(this.targetId,this.targetName),this.fallbackResolvedTargetName=e.resolveName(this.id,this.name,this.targetId,this.targetName)}convert(){let e="";this.stacks>0&&this.stacks<20&&q.showStackCountFor.includes(this.abilityId)&&(e=" ("+this.stacks+")"),this.convertedLine=this.prefix()+this.targetId+":"+this.targetName+" gains the effect of "+this.abilityName+" from "+this.fallbackResolvedTargetName+" for "+this.parts[4]+" Seconds."+e,this.properCaseConvertedLine=this.prefix()+this.targetId+":"+o.properCase(this.targetName)+" gains the effect of "+this.abilityName+" from "+o.properCase(this.fallbackResolvedTargetName)+" for "+this.parts[4]+" Seconds."+e}}class K extends q{}q.showStackCountFor=["130","196","15e","2ca","1f9","4d7","511"];class V extends S{constructor(e,t,a){super(e,t,a),this.targetId=a[2].toUpperCase(),this.targetName=a[3]}}class G extends V{}class Z extends S{constructor(e,t,a){super(e,t,a),this.id=a[4].toUpperCase(),this.name=a[5]}}class J extends Z{}class Y extends S{constructor(e,t,a){super(e,t,a)}}class X extends Y{}class Q extends q{constructor(e,t,a){super(e,t,a)}convert(){let e="";this.stacks>0&&this.stacks<20&&q.showStackCountFor.includes(this.abilityId)&&(e=" ("+this.stacks+")"),this.convertedLine=this.prefix()+this.targetId+":"+this.targetName+" loses the effect of "+this.abilityName+" from "+this.fallbackResolvedTargetName+"."+e,this.properCaseConvertedLine=this.prefix()+this.targetId+":"+o.properCase(this.targetName)+" loses the effect of "+this.abilityName+" from "+o.properCase(this.fallbackResolvedTargetName)+"."+e}}class ee extends Q{}class te extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase();let n=o.zeroPad(a[3],8),r=o.zeroPad(a[4],8),i=o.zeroPad(a[5],8),s=o.zeroPad(a[6],8),l=e=>[e.substr(6,2),e.substr(4,2),e.substr(2,2),e.substr(0,2)];this.jobGaugeBytes=[...l(n),...l(r),...l(i),...l(s)],e.updateCombatant(this.id,{spawn:this.timestamp,despawn:this.timestamp,job:this.jobGaugeBytes[0].toUpperCase()})}convert(e){this.name=e.Combatants[this.id].name,this.convertedLine=this.prefix()+this.id+":"+this.name+":"+this.parts[3]+":"+this.parts[4]+":"+this.parts[5]+":"+this.parts[6],this.properCaseConvertedLine=this.prefix()+this.id+":"+o.properCase(this.name)+":"+this.parts[3]+":"+this.parts[4]+":"+this.parts[5]+":"+this.parts[6]}}class ae extends te{}class ne extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.targetId=a[4].toUpperCase(),this.targetName=a[5],this.targetable=!!parseInt(a[6],16)}}class re extends ne{}class ie extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.targetId=a[4].toUpperCase(),this.targetName=a[5]}}class se extends ie{}class oe extends S{constructor(e,t,a){super(e,t,a),this.value=parseInt(a[2],16),this.bars=a[3]}convert(){this.convertedLine=this.prefix()+"Limit Break: "+this.parts[2]}}class le extends oe{}class de extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.hp=a[5],this.maxHp=a[6],this.mp=a[7],this.maxMp=a[8],this.x=a[11],this.y=a[12],this.z=a[13],this.heading=a[14]}}class ce extends de{}class ue extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3];let r=o.zeroPad(a[4],8);this.jobIdHex=r.substr(6,2).toUpperCase(),this.jobIdDec=parseInt(this.jobIdHex,16),this.jobName=n.a.jobEnumToJob(this.jobIdDec),this.level=parseInt(r.substr(4,2),16),this.hp=a[5],this.maxHp=a[6],this.mp=a[7],this.maxMp=a[8],this.x=a[11],this.y=a[12],this.z=a[13],this.heading=a[14]}}class he extends ue{}class pe extends S{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.hp=a[4],this.maxHp=a[5],this.mp=a[6],this.maxMp=a[7],this.x=a[10],this.y=a[11],this.z=a[12],this.heading=a[13]}}class me extends pe{}class ge{constructor(e){this.EnableProperCaseBug=!0;for(let t in e)this[t]=e[t]}async convertFile(e){return await this.convertLines(e.split(ge.lineSplitRegex).filter(e=>""!==e))}async convertLines(e){this.Combatants={};let t=new b;e=e.map(e=>class{static parse(e,t){let a,n=t.split("|"),r=n[0];if("252"===r)return!1;switch("LineEvent"+r){case"LineEvent00":a=new _(e,t,n);break;case"LineEvent01":a=new E(e,t,n);break;case"LineEvent02":a=new k(e,t,n);break;case"LineEvent03":a=new L(e,t,n);break;case"LineEvent04":a=new I(e,t,n);break;case"LineEvent12":a=new P(e,t,n);break;case"LineEvent20":a=new j(e,t,n);break;case"LineEvent21":a=new M(e,t,n);break;case"LineEvent22":a=new N(e,t,n);break;case"LineEvent23":a=new U(e,t,n);break;case"LineEvent24":a=new $(e,t,n);break;case"LineEvent25":a=new W(e,t,n);break;case"LineEvent26":a=new K(e,t,n);break;case"LineEvent27":a=new G(e,t,n);break;case"LineEvent28":a=new J(e,t,n);break;case"LineEvent29":a=new X(e,t,n);break;case"LineEvent30":a=new ee(e,t,n);break;case"LineEvent31":a=new ae(e,t,n);break;case"LineEvent34":a=new re(e,t,n);break;case"LineEvent35":a=new se(e,t,n);break;case"LineEvent36":a=new le(e,t,n);break;case"LineEvent37":a=new ce(e,t,n);break;case"LineEvent38":a=new he(e,t,n);break;case"LineEvent39":a=new me(e,t,n);break;default:a=new S(e,t,n)}return!(a&&a.timestamp<946684800)&&((!a||!a.invalid)&&a)}}.parse(t,e)).filter(e=>e);for(let a=0;a<e.length;++a)e[a].convert(t),e[a].index=a;return e.sort((e,t)=>(e.timestamp+"_"+e.index).localeCompare(t.timestamp+"_"+t.index))}}ge.lineSplitRegex=/\r?\n/gm;class fe{constructor(e){this.id=e.id,this.name=e.combatantTracker.getMainCombatantName(),this.start=e.startTimestamp,this.offset=e.initialOffset,this.startStatus=e.startStatus,this.endStatus=e.endStatus,this.zoneId=e.encounterZoneId,this.zoneName=e.encounterZoneName,this.duration=e.endTimestamp-e.startTimestamp}}class Te extends l{constructor(){super(),this.DB=null,this.initializeDB()}initializeDB(){let e=window.indexedDB.open("RaidEmulatorEncounters",Te.dbVersion);e.addEventListener("success",e=>{this.DB=e.target.result,this.dispatch("ready")}),e.addEventListener("upgradeneeded",e=>{let t,a,n=[];switch(e.oldVersion){case 0:t=e.target.result.createObjectStore("Encounters",{keyPath:"id",autoIncrement:!0}),a=e.target.result.createObjectStore("EncounterSummaries",{keyPath:"id",autoIncrement:!0}),a.createIndex("zoneName","zoneName"),a.createIndex("start","start"),a.createIndex("zoneName_start",["zoneName","start"])}n.push(new Promise(e=>{t.transaction.addEventListener("complete",t=>{e()})})),n.push(new Promise(e=>{a.transaction.addEventListener("complete",t=>{e()})}));let r=0;for(let t in n)n[t].then(()=>{++r,r===n.length&&(this.DB=e.target.result,this.dispatch("ready"))})})}persistEncounter(e){let t;if(null!==this.DB){let a;t=new Promise(e=>{a=e});let n=o.cloneData(e,[]);delete n.combatantTracker;let r,i=this.encountersStorage;null===n.id?(delete n.id,r=i.add(n)):r=i.put(n),r.addEventListener("success",t=>{e.id=n.id=t.target.result;let r=this.encounterSummariesStorage,i=new fe(e);r.put(i).addEventListener("success",e=>{a()})})}else t=new Promise(e=>e());return t}loadEncounter(e){return new Promise(t=>{if(null!==this.DB){let a=this.encountersStorage.get(e);a.addEventListener("success",e=>{let n=a.result,r=new T(n.encounterDay,n.encounterZoneId,n.encounterZoneName,n.logLines);r.id=n.id,t(r)})}else t(null)})}deleteEncounter(e){return new Promise(t=>{if(null!==this.DB){let a=this.encountersStorage.delete(e);a.addEventListener("success",a=>{let n=this.encounterSummariesStorage.delete(e);n.addEventListener("success",e=>{t(!0)}),n.addEventListener("error",e=>{t(!1)})}),a.addEventListener("error",e=>{t(!1)})}else t(null)})}listEncounters(e=null,t=null,a=null){return new Promise(n=>{if(null!==this.DB){let r,i=this.encounterSummariesStorage,s=null,o=null;null!==e?null!==t?(o=i.index("zoneName_start"),s=null!==a?IDBKeyRange.bound([e,t],[e,a],[!0,!0],[!0,!0]):IDBKeyRange.lowerBound([e,t],[!0,!0])):(o=i.index("zoneName"),s=IDBKeyRange.only(e)):null!==t&&(o=i.index("start"),s=null!==a?IDBKeyRange.bound(t,a,!0,!0):IDBKeyRange.lowerBound(t,!0)),r=null!==s?o.getAll(s):i.getAll(),r.addEventListener("success",e=>{n(r.result)})}else n([])})}async clearDB(){let e,t,a=new Promise(t=>{e=t}),n=new Promise(e=>{t=e});this.encountersStorage.clear().addEventListener("success",()=>{e()}),this.encounterSummariesStorage.clear().addEventListener("success",()=>{t()}),await a,await n}async exportDB(){let e={encounters:[]},t=await this.listEncounters();for(let a of t){let t=await this.loadEncounter(a.id);e.encounters.push({encounterDay:o.timeToDateString(a.Start),encounterZoneName:a.ZoneName,encounterZoneId:a.ZoneId,encounterLines:t.logLines})}return e}async importDB(e){e.encounters.forEach(e=>{this.persistEncounter(new T(e.encounterDay,e.encounterZoneId,e.encounterZoneName,e.encounterLines))})}get encountersStorage(){return this.DB.transaction("Encounters","readwrite").objectStore("Encounters")}get encounterSummariesStorage(){return this.DB.transaction("EncounterSummaries","readwrite").objectStore("EncounterSummaries")}}Te.dbVersion=3;var ye=a(12);class be{constructor(e){this.$progressBarTooltip=new d(".encounterProgressBar","bottom","",!1),this.$progressBarCurrent=document.querySelector(".current-timestamp"),this.$progressBarDuration=document.querySelector(".duration-timestamp"),this.$progress=document.querySelector(".encounterProgressBar"),this.$progressBar=document.querySelector(".encounterProgressBar .progress-bar"),this.$engageIndicator=document.querySelector(".progressBarRow .engageIndicator"),new d(this.$engageIndicator,"bottom","Fight Begins"),this.emulator=e,this.$progress.addEventListener("mousemove",e=>{if(this.emulator.currentEncounter){let t=e.offsetX/e.currentTarget.offsetWidth,a=Math.floor(this.emulator.currentEncounter.encounter.duration*t)-this.emulator.currentEncounter.encounter.initialOffset;this.$progressBarTooltip.offset.x=e.offsetX-e.currentTarget.offsetWidth/2,this.$progressBarTooltip.setText(o.timeToString(a)),this.$progressBarTooltip.show()}}),this.$progress.addEventListener("click",e=>{if(this.emulator.currentEncounter){let t=e.offsetX/e.currentTarget.offsetWidth,a=Math.floor(this.emulator.currentEncounter.encounter.duration*t);this.emulator.seek(a)}}),e.on("currentEncounterChanged",t=>{if(this.$progressBarCurrent.textContent=o.timeToString(0,!1),this.$progressBarDuration.textContent=o.timeToString(t.encounter.duration-t.encounter.initialOffset,!1),this.$progressBar.style.width="0%",this.$progressBar.setAttribute("ariaValueMax",t.encounter.duration),isNaN(t.encounter.initialOffset))this.$engageIndicator.classList.add("d-none");else{let a=t.encounter.initialOffset/e.currentEncounter.encounter.duration*100;this.$engageIndicator.classList.remove("d-none"),this.$engageIndicator.style.left=a+"%"}}),e.on("tick",t=>{let a=t/e.currentEncounter.encounter.duration*100;this.$progressBarCurrent.textContent=o.timeToString(t-e.currentEncounter.encounter.initialOffset,!1),this.$progressBar.setAttribute("ariaValueNow",t-e.currentEncounter.encounter.initialOffset),this.$progressBar.style.width=a+"%"});let t=document.querySelector(".progressBarRow button.play"),a=document.querySelector(".progressBarRow button.pause");t.addEventListener("click",()=>{this.emulator.play()&&(t.classList.add("d-none"),a.classList.remove("d-none"))}),a.addEventListener("click",()=>{this.emulator.pause()&&(a.classList.add("d-none"),t.classList.remove("d-none"))})}}var Se=a(11);class xe extends Se.a{constructor(e,t,a,n,r){super(e,t,a,n,r),this.emulatedTimeOffset=0,this.emulatedFightSync=0,this.emulatedFightSyncLastOffset=0,this.emulatedStatus="pause"}bindTo(e){e.on("tick",(e,t)=>{this.emulatedTimeOffset=e}),e.on("play",()=>{this.emulatedStatus="play"}),e.on("pause",()=>{this.emulatedStatus="pause"})}emulatedSync(e){this.emulatedFightSyncLastOffset&&(this.SyncTo(this.emulatedFightSync+(e-this.emulatedFightSyncLastOffset)/1e3),this._OnUpdateTimer())}_ScheduleUpdate(e){}SyncTo(e){super.SyncTo(e),this.emulatedFightSync=e,this.emulatedFightSyncLastOffset=this.emulatedTimeOffset}}class _e extends Se.b{bindTo(e){this.emulator=e,this.activeTimeline&&this.activeTimeline.bindTo(e)}SetActiveTimeline(e,t,a,n,r){this.activeTimeline=null;let i="";for(let t=0;t<e.length;++t){let a=e[t];a in this.timelines?i=i+"\n"+this.timelines[a]:console.warn("Timeline file not found: "+a)}for(let e=0;e<t.length;++e)i=i+"\n"+t[e];i&&(this.activeTimeline=new xe(i,a,n,r,this.options),this.emulator&&this.activeTimeline.bindTo(this.emulator)),this.ui.SetTimeline(this.activeTimeline)}OnLogEvent(e){this.activeTimeline&&e.detail.logs.forEach(e=>{this.activeTimeline.emulatedTimeOffset=e.offset,this.ui.emulatedTimeOffset=e.offset,this.activeTimeline.OnLogLine(e.properCaseConvertedLine||e.convertedLine)})}}class ve extends Se.d{constructor(e){super(e),this.emulatedTimerBars=[],this.emulatedTimeOffset=0,this.emulatedStatus="pause",this.$barContainer=document.querySelector(".timer-bar-container"),this.$progressTemplate=document.querySelector("template.progress").content.firstElementChild}bindTo(e){let t;e.on("tick",(e,t)=>{this.emulatedTimeOffset=e;for(let t in this.emulatedTimerBars){let a=this.emulatedTimerBars[t];this.updateBar(a,e)}let a=this.emulatedTimerBars.filter(t=>t.forceRemoveAt<=e);for(let e in a){a[e].$progress.remove()}this.emulatedTimerBars=this.emulatedTimerBars.filter(t=>t.forceRemoveAt>e),this.timeline&&this.timeline.timebase&&this.timeline._OnUpdateTimer()}),e.on("play",()=>{this.emulatedStatus="play",this.timeline&&this.timeline.emulatedSync(e.currentTimestamp)}),e.on("pause",()=>{this.emulatedStatus="pause"}),e.on("preSeek",e=>{this.timeline&&this.timeline.Stop(),this.emulatedTimeOffset=e;for(let e in this.emulatedTimerBars){this.emulatedTimerBars[e].$progress.remove()}this.emulatedTimerBars=[],this.timeline&&(t=this.timeline.popupText),this.timeline&&(this.timeline.popupText=null)}),e.on("postSeek",e=>{this.timeline&&(this.timeline.popupText=t),this.timeline&&this.timeline.emulatedSync(e);for(let t in this.emulatedTimerBars){let a=this.emulatedTimerBars[t];this.updateBar(a,e)}}),e.on("currentEncounterChanged",()=>{this.timeline&&this.timeline.Stop(),this.emulatedTimeOffset=0;for(let e in this.emulatedTimerBars){this.emulatedTimerBars[e].$progress.remove()}this.emulatedTimerBars=[]})}updateBar(e,t){let a=t-e.start,n=Math.min(a/e.duration*100,100);"empty"===e.style&&(n=100-n);let r=((e.duration-a)/1e3).toFixed(1);n>=100&&(r=""),e.$leftLabel.textContent=e.event.text,e.$rightLabel.textContent=r,e.$bar.ariaValueNow=a,e.$bar.style.width=n+"%"}Init(){this.init||(this.init=!0,this.timerlist={clear:()=>{}},this.activeBars={},this.expireTimers={})}AddDebugInstructions(){this.debugElement=document.createElement("div")}OnAddTimer(e,t,a){if(this.emulatedTimerBars.filter(e=>e.event.id===t.id).length)return;let n=1e3*(t.time-e)-1e3*this.options.ShowTimerBarsAtSeconds,r=this.$progressTemplate.cloneNode(!0),i={$progress:r,$bar:r.querySelector(".progress-bar"),$leftLabel:r.querySelector(".timer-bar-left-label"),$rightLabel:r.querySelector(".timer-bar-right-label"),start:this.emulatedTimeOffset+n,style:a?"empty":"fill",duration:1e3*(a?t.time-e:this.options.ShowTimerBarsAtSeconds),event:t,forceRemoveAt:0};i.forceRemoveAt=i.start+i.duration,this.options.KeepExpiredTimerBarsForSeconds&&(i.forceRemoveAt+=1e3*this.options.KeepExpiredTimerBarsForSeconds),i.$bar.ariaValueMax=i.duration,this.emulatedTimerBars.push(i),this.$barContainer.append(i.$progress),this.updateBar(i,this.emulatedTimeOffset)}OnRemoveTimer(e,t){let a=this.emulatedTimerBars.filter(t=>t.event.id===e.id);a.length<1||t&&(a[0].forceRemoveAt=this.emulatedTimeOffset,this.options.KeepExpiredTimerBarsForSeconds&&(a[0].forceRemoveAt+=1e3*this.options.KeepExpiredTimerBarsForSeconds))}}class Ee extends ye.a{constructor(e){super(e)}HookOverlays(){}OnDataFilesRead(e){null===Ee.globalTriggerSets?(super.OnDataFilesRead(e),Ee.globalTriggerSets=this.triggerSets):this.triggerSets=Ee.globalTriggerSets}}Ee.globalTriggerSets=null;class Ce extends Ee{OnTriggerInternal(e,t){this.currentTriggerStatus={initialData:o.cloneData(this.data),condition:void 0,response:!1,result:!1,delay:!1,suppressed:!1,executed:!1,promise:void 0},this.currentFunction="initial",super.OnTriggerInternal(e,t)}async OnLog(e){for(const t of e.detail.logs){const e=t.properCaseConvertedLine||t.convertedLine;e.includes("00:0038:cactbot wipe")&&this.SetInCombat(!1);for(const a of this.triggers){const n=e.match(a.localRegex);if(n){const e=new Promise(e=>{this.delayResolver=e}),r=new Promise(e=>{this.promiseResolver=e}),i=new Promise(e=>{this.runResolver=e});this.OnTrigger(a,n),await e,await r;const s=await i;this.currentTriggerStatus.finalData=o.cloneData(this.data),this.callback(t,s,this.currentTriggerStatus)}}}}async OnNetLog(e){for(const t of e.detail.logs){const e=t.networkLine;for(const a of this.netTriggers){const n=e.match(a.localNetRegex);if(n){const e=new Promise(e=>{this.delayResolver=e}),r=new Promise(e=>{this.promiseResolver=e}),i=new Promise(e=>{this.runResolver=e});this.OnTrigger(a,n),await e,await r;const s=await i;this.currentTriggerStatus.finalData=o.cloneData(this.data),this.callback(t,s,this.currentTriggerStatus,this.data)}}}}_onTriggerInternalCheckSuppressed(e,t){this.currentFunction="_onTriggerInternalCheckSuppressed";let a=super._onTriggerInternalCheckSuppressed(e,t);return this.currentTriggerStatus.suppressed=a,a&&(this.delayResolver(),this.promiseResolver(),this.runResolver({trigger:e})),a}_onTriggerInternalCondition(e){this.currentFunction="_onTriggerInternalCondition";let t=super._onTriggerInternalCondition(e);return this.currentTriggerStatus.condition=t,t||(this.delayResolver(),this.promiseResolver(),this.runResolver(e)),t}_onTriggerInternalHelperDefaults(e){this.currentFunction="_onTriggerInternalHelperDefaults",super._onTriggerInternalHelperDefaults(e)}_onTriggerInternalPreRun(e){this.currentFunction="_onTriggerInternalPreRun",super._onTriggerInternalPreRun(e)}_onTriggerInternalDelaySeconds(e){this.currentFunction="_onTriggerInternalDelaySeconds";let t="delaySeconds"in e.trigger?e.valueOrFunction(e.trigger.delaySeconds):0;return this.currentTriggerStatus.delay=t,new Promise(e=>{this.delayResolver(),e()})}_onTriggerInternalDurationSeconds(e){this.currentFunction="_onTriggerInternalDurationSeconds",super._onTriggerInternalDurationSeconds(e)}_onTriggerInternalSuppressSeconds(e){this.currentFunction="_onTriggerInternalSuppressSeconds",super._onTriggerInternalSuppressSeconds(e)}_onTriggerInternalPromise(e){this.currentFunction="_onTriggerInternalPromise";let t=super._onTriggerInternalPromise(e);return this.currentTriggerStatus.promise=t,(async()=>{await t,this.promiseResolver()})()}_onTriggerInternalSound(e){this.currentFunction="_onTriggerInternalSound",super._onTriggerInternalSound(e)}_onTriggerInternalSoundVolume(e){this.currentFunction="_onTriggerInternalSoundVolume",super._onTriggerInternalSoundVolume(e)}_onTriggerInternalResponse(e){this.currentFunction="_onTriggerInternalResponse",super._onTriggerInternalResponse(e),this.currentTriggerStatus.response=e.response}_onTriggerInternalAlarmText(e){this.currentFunction="_onTriggerInternalAlarmText",super._onTriggerInternalAlarmText(e)}_onTriggerInternalAlertText(e){this.currentFunction="_onTriggerInternalAlertText",super._onTriggerInternalAlertText(e)}_onTriggerInternalInfoText(e){this.currentFunction="_onTriggerInternalInfoText",super._onTriggerInternalInfoText(e)}_onTriggerInternalGroupTTS(e){this.currentFunction="_onTriggerInternalGroupTTS",super._onTriggerInternalGroupTTS(e)}_onTriggerInternalTTS(e){this.currentFunction="_onTriggerInternalTTS",super._onTriggerInternalTTS(e)}_onTriggerInternalPlayAudio(e){this.currentFunction="_onTriggerInternalPlayAudio",super._onTriggerInternalPlayAudio(e)}_onTriggerInternalRun(e){this.currentFunction="_onTriggerInternalRun",this.currentTriggerStatus.executed=!0,super._onTriggerInternalRun(e),this.runResolver(e)}_makeTextElement(e,t){return this.currentTriggerStatus.result=this.currentTriggerStatus.result||e,null}_createTextFor(e,t,a,n){}_playAudioFile(e,t){}_scheduleRemoveText(e,t,a){}}class ke extends l{constructor(e,t,a){super(),this.options=e,this.popupText=null,this.perspectives={},this.encounter=t,this.emulator=a}selectPerspective(e){let t=this.encounter.combatantTracker.combatants[e];this.popupText.OnPlayerChange({detail:{name:t.name,job:t.job,currentHP:t.getState(this.encounter.logLines[0].timestamp).HP}})}async analyze(e){this.popupText=e;for(const e in this.encounter.combatantTracker.partyMembers)await this.analyzeFor(this.encounter.combatantTracker.partyMembers[e]);this.dispatch("analyzed")}async analyzeFor(e){const t=this.encounter.combatantTracker.combatants[e];if(!t.job)return void(this.perspectives[e]={initialData:{},triggers:[]});const a=new Ce(this.popupText.options),r=new ve(this.options),i=new _e(this.options,r);i.SetPopupTextInterface(new ye.b(ye.c)),i.SetDataFiles(this.emulator.dataFilesEvent.detail.files),a.SetTimelineLoader(new Se.c(i)),a.OnDataFilesRead(this.emulator.dataFilesEvent),a.ReloadTimelines(),a.partyTracker.onPartyChanged({party:this.encounter.combatantTracker.partyMembers.map(e=>({name:this.encounter.combatantTracker.combatants[e].name,job:n.a.jobToJobEnum(this.encounter.combatantTracker.combatants[e].job),inParty:!0}))}),a.OnPlayerChange({detail:{name:t.name,job:t.job,currentHP:t.getState(this.encounter.logLines[0].timestamp).HP}}),a.OnChangeZone({zoneName:this.encounter.encounterZoneName,zoneID:parseInt(this.encounter.encounterZoneId,16)}),a.callback=(t,a,n,r)=>{this.perspectives[e].triggers.push({triggerHelper:a,status:n,logLine:t,resolvedOffset:t.timestamp-this.encounter.startTimestamp+1e3*n.delay})},this.perspectives[e]={initialData:o.cloneData(a.data,[]),triggers:[],finalData:a.data};for(const t of this.encounter.logLines){this.encounter.combatantTracker.combatants[e].hasState(t.timestamp)&&a.OnPlayerChange({detail:{name:this.encounter.combatantTracker.combatants[e].name,job:this.encounter.combatantTracker.combatants[e].job,currentHP:this.encounter.combatantTracker.combatants[e].getState(t.timestamp).HP}});const n={detail:{logs:[t]}};await a.OnLog(n),await a.OnNetLog(n)}}}class Oe extends l{constructor(e){super(),this.options=e,this.encounters=[],this.currentEncounter=null,this.playing=!1,this.currentTimestamp=null,this.currentLogLineIndex=null,this.lastLogTimestamp=null}addEncounter(e){this.encounters.push(e)}setCurrent(e){this.currentEncounter=new ke(this.options,this.encounters[e],this),this.currentEncounter.analyze(this.popupText).then(()=>{this.dispatch("currentEncounterChanged",this.currentEncounter)})}setCurrentByID(e){let t=this.encounters.findIndex(t=>t.id===e);return-1!==t&&(this.setCurrent(t),!0)}selectPerspective(e){this.currentEncounter.selectPerspective(e),this.seek(this.currentTimestamp)}play(){if(null===this.currentEncounter)return!1;let e=this.currentEncounter.encounter.firstLineIndex;return this.currentTimestamp=this.currentTimestamp||this.currentEncounter.encounter.logLines[e].timestamp,this.currentLogLineIndex=this.currentLogLineIndex||e-1,this.playing=window.setInterval(this.tick.bind(this),Oe.playbackSpeed),this.dispatch("play"),!0}pause(){return window.clearInterval(this.playing),this.playing=null,this.dispatch("pause"),!0}async seek(e){await this.dispatch("preSeek",e),this.currentLogLineIndex=-1;let t=[];for(let a=this.currentLogLineIndex+1;a<this.currentEncounter.encounter.logLines.length;++a){let n=this.currentEncounter.encounter.logLines[a];if(!(n.offset<=e))break;t.push(n),t.length>100&&(await this.dispatch("emitLogs",{logs:t}),t=[]),this.lastLogTimestamp=n.timestamp,++this.currentLogLineIndex,await this.dispatch("midSeek",n)}this.currentTimestamp=e,t.length&&(await this.dispatch("emitLogs",{logs:t}),await this.dispatch("midSeek",t.pop())),await this.dispatch("postSeek",e),await this.dispatch("tick",this.currentTimestamp,this.lastLogTimestamp)}async tick(){if(this.currentLogLineIndex+1>=this.currentEncounter.encounter.logLines.length)return void this.pause();let e=[],t=this.currentTimestamp+Oe.playbackSpeed;for(let a=this.currentLogLineIndex+1;a<this.currentEncounter.encounter.logLines.length&&this.currentEncounter.encounter.logLines[a].offset<=t;++a)e.push(this.currentEncounter.encounter.logLines[a]),this.lastLogTimestamp=this.currentEncounter.encounter.logLines[a].timestamp,++this.currentLogLineIndex;this.currentTimestamp+=Oe.playbackSpeed,e.length&&await this.dispatch("emitLogs",{logs:e}),await this.dispatch("tick",this.currentTimestamp,this.lastLogTimestamp)}setPopupText(e){this.popupText=e}}Oe.playbackSpeed=10;class Le{constructor(e){this.emulator=e,this.originalDispatch=window.dispatchOverlayEvent,this.originalAdd=window.addOverlayListener,this.originalRemove=window.removeOverlayListener,this.originalCall=window.callOverlayHandler,this.timestampOffset=0,window.dispatchOverlayEvent=this.dispatch.bind(this),window.addOverlayListener=this.add.bind(this),window.removeOverlayListener=this.remove.bind(this),window.callOverlayHandler=this.call.bind(this),e.on("tick",e=>{this.timestampOffset=e}),e.on("preSeek currentEncounterChanged",e=>{this.timestampOffset=0})}dispatch(e){return this.originalDispatch(e)}add(e,t){return this.originalAdd(e,t)}remove(e,t){return this.originalRemove(e,t)}call(e){return"getCombatants"===e.call?new Promise(t=>{let a=[],n=this.emulator.currentEncounter.encounter.combatantTracker,r=this.emulator.currentEncounter.encounter.startTimestamp+this.timestampOffset;for(let t in n.combatants){let i=n.combatants[t].nextSignificantState(r);(e.ids&&e.ids.includes(t)||e.names&&e.names.includes(n.combatants[t].name))&&a.push(i)}t({combatants:a})}):this.originalCall(e)}}class we extends Ee{constructor(e){super(e),this.$popupTextContainerWrapper=document.querySelector(".popup-text-container-outer"),this.emulatedOffset=0,this.emulator=null,this.displayedText=[],this.scheduledTriggers=[],this.seeking=!1,this.$textElementTemplate=document.querySelector("template.textElement").content.firstElementChild,this.audioDebugTextDuration=2e3}async doUpdate(e){this.emulatedOffset=e;for(let t of this.scheduledTriggers){t.expires-e<=0&&(t.resolver(),await t.promise)}this.scheduledTriggers=this.scheduledTriggers.filter(t=>t.expires-e>0),this.displayedText=this.displayedText.filter(t=>{let a=t.expires-e;return a>0?(t.element.querySelector(".popup-text-remaining").textContent="("+(a/1e3).toFixed(1)+")",!0):(t.element.remove(),!1)})}bindTo(e){this.emulator=e,e.on("emitLogs",e=>{this.OnLog({detail:{logs:e.logs.map(e=>e.properCaseConvertedLine||e.convertedLine)}}),e.logs.forEach(e=>{this.OnNetLog({rawLine:e.networkLine})})}),e.on("tick",async e=>{await this.doUpdate(e)}),e.on("midSeek",async e=>{await this.doUpdate(e.offset)}),e.on("preSeek",e=>{this.seeking=!0;for(let e of this.scheduledTriggers)e.rejecter();this.scheduledTriggers=[],this.displayedText=this.displayedText.filter(e=>(e.element.remove(),!1))}),e.on("postSeek",async e=>{window.setTimeout(()=>{this.seeking=!1},5)}),e.on("currentEncounterChanged",()=>{for(let e of this.scheduledTriggers)e.rejecter();this.scheduledTriggers=[],this.displayedText=this.displayedText.filter(e=>(e.element.remove(),!1)),this.OnChangeZone({zoneName:e.currentEncounter.encounter.encounterZoneName,zoneID:parseInt(e.currentEncounter.encounter.encounterZoneId,16)})})}_createTextFor(e,t,a,n){let r=t+"-text",i=this._makeTextElement(e,r);this.addDisplayText(i,this.emulatedOffset+1e3*n)}_onTriggerInternalDelaySeconds(e){let t,a,n="delaySeconds"in e.trigger?e.valueOrFunction(e.trigger.delaySeconds):0;if(!n||n<=0)return null;let r=new Promise((e,n)=>{t=e,a=n});return this.scheduledTriggers.push({expires:this.emulatedOffset+1e3*n,promise:r,resolver:t,rejecter:a}),r}_playAudioFile(e,t){if(![this.options.InfoSound,this.options.AlertSound,this.options.AlarmSound].includes(e)){let t=this._makeTextElement(e,"audio-file");this.addDisplayText(t,this.emulatedOffset+this.audioDebugTextDuration)}this.seeking||super._playAudioFile(e,t)}ttsSay(e){if(this.seeking)return;let t=this._makeTextElement(e,"tts-text");this.addDisplayText(t,this.emulatedOffset+this.audioDebugTextDuration),super.ttsSay(e)}_makeTextElement(e,t){let a=this.$textElementTemplate.cloneNode(!0);return a.classList.add(t),a.querySelector(".popup-text").textContent=e,a}addDisplayText(e,t){let a=(t-this.emulatedOffset)/1e3;e.querySelector(".popup-text-remaining").textContent="("+a.toFixed(1)+")",this.$popupTextContainerWrapper.append(e),this.displayedText.push({element:e,expires:t})}}var Ie=a(4);let Ae={PlayerNicks:{},InfoSound:"../../resources/sounds/freesound/percussion_hit.ogg",AlertSound:"../../resources/sounds/BigWigs/Alert.ogg",AlarmSound:"../../resources/sounds/BigWigs/Alarm.ogg",LongSound:"../../resources/sounds/BigWigs/Long.ogg",PullSound:"../../resources/sounds/PowerAuras/sonar.ogg",audioAllowed:!0,DisabledTriggers:{},PerTriggerOptions:{},Triggers:[],PlayerNameOverride:null,PlayerJobOverride:null};function Pe(e){let t=document.querySelector(e),a=document.body,n=document.querySelector(".modal-backdrop");a.classList.add("modal-open"),n.classList.add("show"),n.classList.remove("hide"),t.classList.add("show"),t.style.display="block"}function De(e=".modal.show"){let t=document.querySelector(e),a=document.body,n=document.querySelector(".modal-backdrop");a.classList.remove("modal-open"),n.classList.remove("show"),n.classList.add("hide"),t.classList.remove("show"),t.style.display=""}(()=>{let e,t,a,n,i,s,l,u,h,p,m,g;document.addEventListener("DOMContentLoaded",()=>{e=new Oe(Ae),t=new be(e),i=new Te,s=new f,l=new y(i),u=new c(e),h=new r(e),p=new Le(e),m=new ge,u.on("selectPerspective",t=>{e.selectPerspective(t)}),s.on("fight",(t,a,n,r)=>{let s=new T(t,a,n,r);s.firstPlayerAbility>0&&s.firstEnemyAbility>0&&(e.addEncounter(s),i.persistEncounter(s).then(()=>{l.refresh()}))}),l.on("load",t=>{let a;if(e.setCurrentByID(t))a=new Promise(e=>{e()});else{let n;a=new Promise(e=>{n=e}),i.loadEncounter(t).then(a=>{e.addEncounter(a),e.setCurrentByID(t),n()})}a.then(()=>{window.localStorage.setItem("currentEncounter",t),isNaN(e.currentEncounter.encounter.initialOffset)||e.seek(e.currentEncounter.encounter.initialOffset)})}),l.on("parse",e=>{i.loadEncounter(e).then(async e=>{e.initialize(),await i.persistEncounter(e),l.refresh()})}),l.on("prune",e=>{i.loadEncounter(e).then(async e=>{e.logLines=e.logLines.slice(e.firstLineIndex-1);let t=e.logLines[0].timestamp;for(let a=0;a<e.logLines.length;++a)e.logLines[a].offset=e.logLines[a].timestamp-t;e.firstLineIndex=0,e.initialize(),await i.persistEncounter(e),l.refresh()})}),l.on("delete",e=>{i.deleteEncounter(e).then(()=>{l.refresh()})}),e.on("emitLogs",e=>{a.OnLogEvent({type:"onLogEvent",detail:e})}),i.on("ready",()=>{Ie.a.getUserConfigLocation("raidboss",Ae,r=>{callOverlayHandler({call:"cactbotReadDataFiles",source:location.href}).then(t=>{document.querySelector(".websocketConnected").classList.remove("d-none"),document.querySelector(".websocketDisconnected").classList.add("d-none"),a.SetDataFiles(t.detail.files),n.OnDataFilesRead(t),n.ReloadTimelines(),e.dataFilesEvent=t,i.listEncounters().then(e=>{if(e.length>0){let t=window.localStorage.getItem("currentEncounter");if(void 0!==t&&void 0!==t){t=parseInt(t),e.filter(e=>e.id===t).length&&l.dispatch("load",t)}}})}),g=new ve(Ae),g.bindTo(e),a=new _e(Ae,g),a.bindTo(e),n=new we(Ae),n.bindTo(e),a.SetPopupTextInterface(new ye.b(n)),n.SetTimelineLoader(new Se.c(a)),e.setPopupText(n),l.refresh(),i.listEncounters().then(e=>{0===e.length&&Pe(".introModal")});let c=async t=>{"application/json"===t.type?t.text().then(e=>{let t=JSON.parse(e);i.importDB(t).then(()=>{l.refresh()})}):t.text().then(t=>{m.convertFile(t).then(t=>{let a=new f;a.currentDate=o.timeToDateString(t[0].timestamp);let n=[];a.on("fight",async(t,a,r,s)=>{let o=new T(t,a,r,s);o.firstPlayerAbility>0&&o.firstEnemyAbility>0&&(e.addEncounter(o),n.push(i.persistEncounter(o)))}),a.parseLogs(t),a.endFight(),Promise.all(n).then(()=>{l.refresh()})})})},y=e=>{e.preventDefault(),e.stopPropagation()};document.body.addEventListener("dragenter",y),document.body.addEventListener("dragover",y),document.body.addEventListener("drop",async e=>{e.preventDefault(),e.stopPropagation();let t=e.dataTransfer.files;for(let e=0;e<t.length;++e){let a=t[e];await c(a)}});let b=document.querySelector(".exportDBButton");new d(b,"bottom","Export DB is very slow and shows a 0 byte download, but it does work eventually."),document.querySelectorAll('[data-toggle="collapse"]').forEach(e=>{let t=document.querySelector(e.getAttribute("data-target"));e.addEventListener("click",()=>{"false"===e.getAttribute("aria-expanded")?(e.setAttribute("aria-expanded","true"),t.classList.add("show")):(e.setAttribute("aria-expanded","false"),t.classList.remove("show"))})}),b.addEventListener("click",e=>{i.exportDB().then(e=>{let t=new Blob([JSON.stringify(e)],{type:"application/json"});e=null;let a=document.createElement("a");a.href=URL.createObjectURL(t),a.setAttribute("download","RaidEmulator_DBExport_"+ +new Date+".json"),a.click(),window.setTimeout(()=>{URL.revokeObjectURL(a.href)},1e3)})});let S=document.querySelector(".loadFileInput");S.addEventListener("change",async e=>{for(let t=0;t<e.target.files.length;++t){let a=e.target.files[t];c(a)}}),document.querySelectorAll(".importDBButton, .loadNetworkLogButton").forEach(e=>{e.addEventListener("click",e=>{S.click()})}),document.querySelectorAll('.modal button.close, [data-dismiss="modal"]').forEach(e=>{e.addEventListener("click",e=>{let t=e.currentTarget;for(;!t.classList.contains("modal")&&t!==document.body;)t=t.parentElement;t!==document.body&&De("."+[...t.classList].join("."))})}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",t=>{t.target===e&&De()})}),document.querySelector(".clearDBButton").addEventListener("click",e=>{Pe(".deleteDBModal")}),document.querySelector(".deleteDBModal .btn-primary").addEventListener("click",e=>{i.clearDB().then(()=>{l.refresh(),De(".deleteDBModal")})}),window.raidEmulator={emulator:e,progressBar:t,timelineController:a,popupText:n,persistor:i,logEventHandler:s,encounterTab:l,emulatedPartyInfo:u,emulatedMap:h,emulatedWebSocket:p,logConverter:m,timelineUI:g}})})})})()}]);